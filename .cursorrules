# Workflow CLI - Cursor AI Rules

## âš ï¸ Important Notes

**Code and Document Generation Rules**:
- **Do not generate code or documents unless explicitly requested**
- Only execute code or document generation when explicitly requested by the user
- For analysis, explanation, or discussion questions, provide text-only answers without automatically generating code or document files
- If the user is only asking questions or needs explanations, do not proactively create files or modify code
- **Prohibition Rule**: **Without explicit user instruction to generate code or documents, AI is prohibited from automatically generating any code files or document files. Only provide analysis, explanations, suggestions, and other text responses.**
- **Analysis Question Rule**: **For analysis, discussion, or inquiry questions, only provide text answers and analysis without automatically generating analysis document files. Only create document files when the user explicitly requests document generation.**
- **Code Modification Rule**: **Prohibited from modifying existing code files without explicit user consent or instruction. If code modification is needed, user consent or explicit instruction must be obtained first.**
- **Document Modification Rule**: **Prohibited from modifying existing document files without explicit user consent or instruction. If document modification is needed, user consent or explicit instruction must be obtained first.**

## ğŸ“‹ Project Overview

This is a CLI tool written in Rust for automating development workflows, providing PR management, Jira integration, log processing, and other features.

### Architecture

The project adopts a three-layer architecture:
- **CLI Entry Layer** (`bin/`, `main.rs`): Command-line argument parsing and command dispatching
- **Command Wrapper Layer** (`commands/`): CLI command wrappers, handling user interactions
- **Core Business Logic Layer** (`lib/`): All business logic implementation

For detailed module architecture information, refer to `docs/architecture/architecture.md`.

## ğŸ“ Development Standards and Guidelines

**Important**: All development standards and guidelines must strictly follow the detailed descriptions in `docs/guidelines/development/README.md`.

### Development Guidelines Reference

**Mandatory Development Guidelines Document**: `docs/guidelines/development/README.md` (Development Guidelines Index)

This directory contains complete development guidelines, including:
- **Core Guidelines**: Code style, error handling, naming conventions, module organization
- **Process Guidelines**: Git workflow, commit standards, code review
- **Reference Documents**: Logging, documentation, configuration management, security, dependency management, performance optimization, development tools, etc.

### Quick Reference

The following are the most commonly used standards quick reference (**for detailed descriptions and complete standards, see `docs/guidelines/development/README.md`**):

- **Code Formatting**: `cargo fmt` (must run before commit)
- **Code Checking**: `cargo clippy -- -D warnings` (all warnings must be fixed)
- **Naming Conventions**: Modules/functions/variables `snake_case`, Types/Traits `PascalCase`, Constants `SCREAMING_SNAKE_CASE`
- **Import Order**: Standard library â†’ Third-party libraries â†’ Project internal
- **Error Handling**: Use `color_eyre::Result<T>` and add context to error messages
- **Documentation Comments**: All public APIs must have `///` documentation comments, including parameters, return values, errors, examples

### Code Generation Rules

**Important**: Only execute code generation operations when the user explicitly requests code generation.

When generating code, must strictly follow all development standards in `docs/guidelines/development/` directory, including:

- **Code Style**: Follow project naming conventions and code style, use `rustfmt` for formatting, pass `clippy` checks
- **Error Handling**: Use `color_eyre::Result<T>`, add context to error messages, consider all error cases
- **Documentation Comments**: Add complete documentation comments for new features (including parameters, return values, errors, examples)
- **Document Writing**: If generating documents, must reference `docs/guidelines/document.md` to select appropriate templates, and add "Last Updated" timestamp at the end of documents (reference `docs/guidelines/document-timestamp.md`)
- **API Design**: Follow public API design principles, maintain backward compatibility, use `#[deprecated]` for deprecated APIs, reference `docs/guidelines/development/references/documentation.md` for detailed documentation standards
- **Module Organization**: Follow three-layer architecture, correctly organize modules and dependencies
- **Testing**: Add unit tests and integration tests for new features (as applicable)
- **Commit Standards**: If involving Git commits, follow Conventional Commits format
- **Code Quality**: Keep code concise and readable, follow Rust best practices (e.g., use `Result` types, avoid `unwrap()`, etc.)
- **Code Review**: Ensure code meets review checklist requirements

### Adding New Features

1. Implement core business logic in `lib/`
2. Add CLI command wrappers in `commands/`
3. Register commands in `main.rs`
4. Add test cases (reference testing standards)
5. Update documentation
6. **Extending PR Platform Support**: To add new PR platforms (e.g., GitLab, Bitbucket), reference `docs/guidelines/pr-platform.md`

### Git Workflow and Commit Standards

**Must Follow**: Git workflow and commit standards in `docs/guidelines/development/git-workflow.md` and `docs/guidelines/development/commit.md`.

- **Branch Strategy**: Use `feature/*`, `fix/*`, `hotfix/*` branches
- **Commit Format**: Use Conventional Commits format (`<type>(<scope>): <subject>`)
- **Commit Types**: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`, `perf`, `ci`
- **Commit Message Requirements**: Subject line no more than 50 characters, use imperative mood

### Testing Standards

**Detailed Standards**: Reference `docs/guidelines/development/README.md` and `docs/guidelines/testing.md`.

- Unit tests placed in `#[cfg(test)]` modules of corresponding modules
- Integration tests placed in `tests/` directory
- Use `cargo test` to run tests
- Target coverage: > 80%, critical business logic: > 90%

### Code Review

**Review Checklist**: Reference `docs/guidelines/development/code-review.md` for code review standards.

**Code Review Workflow**:
- **Pre-commit Check** (5-15 minutes): Reference `docs/guidelines/workflows/pre-commit.md`
- **Comprehensive Deep Review** (2-4 hours): Reference `docs/guidelines/workflows/review.md` (after feature completion, periodic review, before major refactoring)

Before submitting PR, ensure:
- [ ] Code is formatted (`cargo fmt`)
- [ ] Passes Clippy checks (`cargo clippy`)
- [ ] All tests pass (`cargo test`)
- [ ] Added necessary documentation comments
- [ ] Followed error handling standards
- [ ] Commit messages meet standards

### Dependency Management

**Detailed Principles**: Reference `docs/guidelines/development/references/dependency-management.md` for dependency management standards.

- Use `cargo add <package-name>` to add dependencies
- Prefer stable versions of crates
- Avoid unnecessary dependencies
- Before adding new dependencies, consider if really needed, if there are lighter alternatives

### Development Tools

**Required Tools and Common Commands**: Reference `docs/guidelines/development/references/development-tools.md` for development tools standards (if created).

**CI/CD Configuration**:
- **CI Workflow Configuration**: Reference `docs/guidelines/ci-workflow.md`
- **GitHub Configuration**: Reference `docs/guidelines/github-setup.md` (Secrets, Variables, branch protection rules, etc.)

**Performance Analysis Tools**:
- **Binary Size Analysis**: Reference `docs/guidelines/cargo-bloat.md` (use `cargo-bloat` to analyze binary file size)

Install development tools: `make setup`

## ğŸ”„ File Synchronization Rules

**Important**: `.cursorrules` and `docs/cursorrules.md` must always be kept in sync.

### Synchronization Trigger

**Rule**: Whenever `.cursorrules` or `docs/cursorrules.md` is modified, the other file must be immediately updated to maintain consistency.

### Synchronization Direction

- **Modifying `.cursorrules` (English version)** â†’ Must immediately synchronize and update `docs/cursorrules.md` (Chinese version)
- **Modifying `docs/cursorrules.md` (Chinese version)** â†’ Must immediately synchronize and update `.cursorrules` (English version)

### Verification Methods

- **Manual Checklist**:
  1. Check that the chapter structure is consistent (heading levels, chapter order)
  2. Check that key rules exist in both files (e.g., code generation rules, document management rules)
  3. Check that the "Last Updated" timestamps are consistent
  4. Check that the directory structure is consistent
- **Automated Validation Script** (recommended):
  - Check that chapter headings are consistent (ignoring language differences)
  - Check that line counts are similar (considering Chinese/English length differences)
  - Check that key markers (e.g., `##`, `###`) have consistent counts
  - Check that "Last Updated" timestamps are consistent
- **Git Hooks Validation** (recommended):
  - In pre-commit hook: If `.cursorrules` or `docs/cursorrules.md` is modified, check if the other file is also modified in the same commit
  - If only one file is modified, prompt to synchronize and update the other file
- **CI/CD Validation** (recommended):
  - Check synchronization status of both files in CI pipeline
  - If out of sync is detected, fail CI build and prompt to synchronize

## ğŸ“ Document Management

**Core Principle**: **All generated document files are automatically categorized into corresponding directories based on document type; if the type cannot be determined, prioritize checking for keywords like "åˆ†æ" (analysis), matching then store in `analysis/`, otherwise default to `docs/requirements/`.**

**Important Rule**: Document files are stored in corresponding directories by type. Creating document files arbitrarily in the project root or other locations is prohibited.

### Document Classification Table

| Document Type | Directory | Naming Pattern | Keywords (ä¿ç•™ä¸­æ–‡å…³é”®è¯) |
|--------------|-----------|----------------|---------------------------|
| Architecture Documents | `docs/architecture/` | `{TOPIC}.md` | æ¶æ„ã€æ¶æ„è®¾è®¡ã€Architectureã€æ¨¡å—æ¶æ„ã€ç³»ç»Ÿè®¾è®¡ |
| Guidelines Documents | `docs/guidelines/` | `{TOPIC}.md` | æŒ‡å—ã€è§„èŒƒã€Guidelinesã€å¼€å‘è§„èŒƒã€æµ‹è¯•è§„èŒƒã€æ–‡æ¡£è§„èŒƒ |
| Migration Documents | `docs/migration/` | `{TOPIC}.md` | è¿ç§»ã€Migrationã€ç‰ˆæœ¬å‡çº§ã€é…ç½®è¿ç§» |
| TODO Documents | `docs/requirements/` | `{TOPIC}.md` | TODOã€å¾…åŠã€å¾…å®ç°ã€è®¡åˆ’ |
| Requirement Documents | `docs/requirements/` | `{TOPIC}.md` | éœ€æ±‚ã€éœ€æ±‚åˆ†æã€åŠŸèƒ½éœ€æ±‚ã€éœ€æ±‚æ–‡æ¡£ |
| Analysis Documents | `analysis/` | `{TOPIC}.md` | åˆ†æã€ANALYSISã€é—®é¢˜åˆ†æã€æŠ€æœ¯åˆ†æã€æµ‹è¯•åˆ†æã€ä»£ç åˆ†æã€æ€§èƒ½åˆ†æã€æ¶æ„åˆ†æã€è®¾è®¡åˆ†æã€ä»£ç å®¡æŸ¥åˆ†æã€é—®é¢˜è¯Šæ–­ |
| Implementation Documents | `analysis/impl/` | `{TOPIC}.md` | å®ç°ã€å®æ–½ã€IMPLEMENTATIONã€IMPLã€å®ç°æ–‡æ¡£ã€å®æ–½æ–‡æ¡£ã€å®ç°æ–¹æ¡ˆã€å®æ–½æ–¹æ¡ˆ |
| Report Documents | `report/` | `{TOPIC}.md` | åˆ†ææŠ¥å‘Šã€æ£€æŸ¥æŠ¥å‘Šã€ä»£ç åˆ†æã€è´¨é‡æŠ¥å‘Šï¼ˆfrom pre-commit.mdï¼‰ |

**Note**: Requirement analysis, feature descriptions, implementation plans, and other unclassified documents default to `docs/requirements/` directory.

### Document Storage Decision Process

1. Check if the user explicitly specified document type or storage location
2. If type is specified, automatically categorize according to the above classification rules
3. **Important Restrictions**:
   - **Analysis Documents** (`analysis/`): **Must** only generate when user explicitly requests analysis documents, cannot auto-judge based on keywords
   - **Requirement Documents** (`docs/requirements/`): **Must** only generate when user explicitly requests requirement documents, cannot auto-judge based on keywords
4. If type is not specified, check keywords in document content:
   - Contains "TODO", "å¾…åŠ", "å¾…å®ç°", "è®¡åˆ’" (plan), "éœ€æ±‚" (requirement), "éœ€æ±‚åˆ†æ", "åŠŸèƒ½éœ€æ±‚", "éœ€æ±‚æ–‡æ¡£" â†’ `docs/requirements/`
   - Other unclassified documents â†’ `docs/requirements/`
5. If type cannot be determined, default to `docs/requirements/`

### Document Naming Standards

All documents use the `{TOPIC}.md` format. Refer to the **Document Classification Table** above for document type classification and storage locations.

### Creating New Documents

- **Document Writing Guidelines**: Use templates to create new documents (reference `docs/guidelines/document.md`)
  - Select appropriate template based on document type (architecture, guidelines, requirements, review workflow, development workflow, review guide documents)
  - Follow document writing standards and chapter checklist
- **Document Timestamp**: Add "Last Updated" timestamp at the end of documents (reference `docs/guidelines/document-timestamp.md`)
  - Format: `**æœ€åæ›´æ–°**: YYYY-MM-DD`
  - Location: End of document, after separator line
  - **Important**: When updating document content, must update the timestamp at the end of the document to the current date
- **Document Index**: Update corresponding document index (as applicable):
  - TODO Documents: Only index in `docs/requirements/README.md`
  - Other Reference Documents: Index in `docs/README.md`
- **Document Standards**: Ensure documents follow project document writing standards

### Document Index Rules

- **Prohibited Indexing**: Documents in `analysis/`, `analysis/impl/`, and `report/` directories **must not** be indexed in `docs/README.md` or project root `README.md`
- These directories contain **temporary analysis and implementation documents**, not reference documents, and do not need to be displayed in document index
- **Requirement Document Index Restriction**: Requirement documents in `docs/requirements/` directory **only** need to be indexed in `docs/requirements/README.md`, **not** in `docs/README.md` or project root `README.md`
- **Reference Documents**: Other documents in `docs/` directory (architecture documents, guidelines documents, migration documents) are reference documents and should be indexed in `docs/README.md`

### Document Deletion Rules

- **Temporary Documents (can be deleted directly)**:
  - All documents in `analysis/` directory are temporary technical analysis and can be deleted at any time
  - All documents in `analysis/impl/` directory are temporary implementation documents and can be deleted at any time
  - All documents in `report/` directory are temporary analysis reports and can be deleted at any time
  - These documents are used for analysis, implementation, and recording during development and do not need long-term retention
- **Reference Documents (deletion requires caution)**:
  - Documents in `docs/` directory are **reference documents and architecture documents**, deletion requires great care
  - Including: architecture documents (`docs/architecture/`), guidelines documents (`docs/guidelines/`), migration documents (`docs/migration/`), TODO documents (`docs/requirements/`)
  - These documents are the project's knowledge base and reference materials, must confirm no longer needed before deletion
  - **Special Note**: TODO documents, although reference documents, are only indexed in `docs/requirements/README.md`, not in the main document index

## âš™ï¸ Notes

1. **Cross-platform Support**: Project supports macOS, Linux, Windows, pay attention to platform-specific code. For platform-specific code organization and testing requirements, reference `docs/guidelines/development/module-organization.md` (Platform-specific Code Organization section)
2. **Clipboard Functionality**: Linux ARM64 and musl static linking versions do not support clipboard functionality
3. **Configuration Files**: Configuration files stored in `~/.workflow/config/workflow.toml` (macOS/Linux) or `%APPDATA%\workflow\config\workflow.toml` (Windows)
4. **Error Handling**: All errors should provide clear error messages and context
5. **Logging**: Use `tracing` for logging, supports different log levels
6. **GitHub Configuration**: When setting up the project for the first time, need to configure GitHub Secrets, Variables, and branch protection rules, reference `docs/guidelines/github-setup.md`

---

**æœ€åæ›´æ–°**: 2025-12-23
