#!/usr/bin/env python3
"""
æ‰¹é‡ä¸ºè¢«å¿½ç•¥çš„æµ‹è¯•æ·»åŠ æ–‡æ¡£æ³¨é‡Š

ä½¿ç”¨æ–¹æ³•:
    python3 scripts/add_ignored_test_docs.py

è¯´æ˜:
    æ­¤è„šæœ¬ä¼šä¸ºæ‰€æœ‰æ ‡è®°ä¸º #[ignore] çš„æµ‹è¯•æ·»åŠ ç»Ÿä¸€æ ¼å¼çš„æ–‡æ¡£æ³¨é‡Š
"""

import re
import os
from pathlib import Path

# æµ‹è¯•æ–‡ä»¶åˆ—è¡¨å’Œæ–‡æ¡£é…ç½®
TEST_DOCS_CONFIG = [
    # Dialog Tests
    {
        "file": "tests/base/dialog/form_builder.rs",
        "tests": [
            {
                "name": "test_form_builder_run",
                "title": "æµ‹è¯•è¡¨å•æ„å»ºå™¨çš„å®Œæ•´è¿è¡Œæµç¨‹",
                "purpose": "éªŒè¯`FormBuilder`èƒ½å¤Ÿæ­£ç¡®æ˜¾ç¤ºå¤šæ­¥éª¤è¡¨å•å¹¶æ¥æ”¶ç”¨æˆ·è¾“å…¥ã€‚è¦†ç›–æºä»£ç : `builder.rs:173-229`",
                "why_ignored": [
                    "**éœ€è¦ç”¨æˆ·äº¤äº’**: æµ‹è¯•éœ€è¦ç”¨æˆ·ä¾æ¬¡è¾“å…¥å„ä¸ªè¡¨å•å­—æ®µ",
                    "**CIç¯å¢ƒä¸æ”¯æŒ**: è‡ªåŠ¨åŒ–CIç¯å¢ƒæ— æ³•æä¾›äº¤äº’å¼è¾“å…¥",
                    "**å¤šæ­¥éª¤æµç¨‹**: æ¶‰åŠå¤šä¸ªè¿ç»­çš„ç”¨æˆ·è¾“å…¥æ­¥éª¤"
                ],
                "how_to_run": "cargo test test_form_builder_run -- --ignored",
                "scenario": [
                    "åˆ›å»ºè¡¨å•æ„å»ºå™¨",
                    "æ·»åŠ è¡¨å•ç»„å’Œå­—æ®µ",
                    "è¿è¡Œè¡¨å•å¹¶ç­‰å¾…ç”¨æˆ·è¾“å…¥",
                    "éªŒè¯æ”¶é›†çš„è¡¨å•æ•°æ®"
                ],
                "expected": [
                    "ä¾æ¬¡æ˜¾ç¤ºå„ä¸ªè¡¨å•å­—æ®µ",
                    "æ¥å—ç”¨æˆ·è¾“å…¥å¹¶éªŒè¯",
                    "è¿”å›`Ok(FormData)`åŒ…å«æ‰€æœ‰è¾“å…¥å€¼",
                    "å¦‚æœç”¨æˆ·å–æ¶ˆåˆ™è¿”å›é”™è¯¯"
                ],
                "extra_info": "ç„¶åæŒ‰ç…§æç¤ºä¾æ¬¡è¾“å…¥å„å­—æ®µå€¼"
            },
            {
                "name": "test_form_builder_ask_field_text",
                "title": "æµ‹è¯•è¡¨å•æ–‡æœ¬å­—æ®µçš„ç”¨æˆ·è¾“å…¥",
                "purpose": "éªŒè¯`ask_field()`æ–¹æ³•èƒ½å¤Ÿæ­£ç¡®å¤„ç†Textç±»å‹å­—æ®µã€‚è¦†ç›–æºä»£ç : `builder.rs:269-311`",
                "why_ignored": [
                    "**éœ€è¦ç”¨æˆ·äº¤äº’**: æµ‹è¯•éœ€è¦ç”¨æˆ·è¾“å…¥æ–‡æœ¬",
                    "**CIç¯å¢ƒä¸æ”¯æŒ**: è‡ªåŠ¨åŒ–CIç¯å¢ƒæ— æ³•æä¾›äº¤äº’å¼è¾“å…¥",
                    "**å­—æ®µéªŒè¯æµ‹è¯•**: ç”¨äºéªŒè¯æ–‡æœ¬è¾“å…¥å’ŒéªŒè¯é€»è¾‘"
                ],
                "how_to_run": "cargo test test_form_builder_ask_field_text -- --ignored",
                "scenario": [
                    "åˆ›å»ºTextç±»å‹çš„è¡¨å•å­—æ®µ",
                    "å¯é€‰è®¾ç½®éªŒè¯è§„åˆ™å’Œé»˜è®¤å€¼",
                    "æ˜¾ç¤ºè¾“å…¥æç¤ºå¹¶ç­‰å¾…ç”¨æˆ·è¾“å…¥",
                    "éªŒè¯ç”¨æˆ·è¾“å…¥æ˜¯å¦ç¬¦åˆè§„åˆ™"
                ],
                "expected": [
                    "æ˜¾ç¤ºå­—æ®µæç¤ºä¿¡æ¯",
                    "æ¥å—ç”¨æˆ·æ–‡æœ¬è¾“å…¥",
                    "åº”ç”¨éªŒè¯è§„åˆ™ï¼ˆå¦‚æœ‰ï¼‰",
                    "è¿”å›éªŒè¯é€šè¿‡çš„è¾“å…¥å€¼"
                ],
                "extra_info": "ç„¶åæŒ‰ç…§æç¤ºè¾“å…¥æ–‡æœ¬"
            },
            {
                "name": "test_form_builder_ask_field_password",
                "title": "æµ‹è¯•è¡¨å•å¯†ç å­—æ®µçš„ç”¨æˆ·è¾“å…¥",
                "purpose": "éªŒè¯`ask_field()`æ–¹æ³•èƒ½å¤Ÿæ­£ç¡®å¤„ç†Passwordç±»å‹å­—æ®µã€‚è¦†ç›–æºä»£ç : `builder.rs:312-341`",
                "why_ignored": [
                    "**éœ€è¦ç”¨æˆ·äº¤äº’**: æµ‹è¯•éœ€è¦ç”¨æˆ·è¾“å…¥å¯†ç ",
                    "**CIç¯å¢ƒä¸æ”¯æŒ**: è‡ªåŠ¨åŒ–CIç¯å¢ƒæ— æ³•æä¾›äº¤äº’å¼è¾“å…¥",
                    "**å®‰å…¨è¾“å…¥æµ‹è¯•**: ç”¨äºéªŒè¯å¯†ç è¾“å…¥ï¼ˆéšè—æ˜¾ç¤ºï¼‰"
                ],
                "how_to_run": "cargo test test_form_builder_ask_field_password -- --ignored",
                "scenario": [
                    "åˆ›å»ºPasswordç±»å‹çš„è¡¨å•å­—æ®µ",
                    "æ˜¾ç¤ºè¾“å…¥æç¤ºï¼ˆå¯†ç å°†è¢«éšè—ï¼‰",
                    "ç­‰å¾…ç”¨æˆ·è¾“å…¥å¯†ç ",
                    "éªŒè¯å¯†ç è¾“å…¥"
                ],
                "expected": [
                    "æ˜¾ç¤ºå¯†ç å­—æ®µæç¤º",
                    "è¾“å…¥æ—¶ä»¥*æˆ–Â·éšè—å­—ç¬¦",
                    "æ”¯æŒç¡®è®¤å¯†ç åŠŸèƒ½ï¼ˆå¦‚éœ€è¦ï¼‰",
                    "è¿”å›è¾“å…¥çš„å¯†ç å€¼"
                ],
                "extra_info": "ç„¶åæŒ‰ç…§æç¤ºè¾“å…¥å¯†ç ï¼ˆè¾“å…¥å°†è¢«éšè—ï¼‰"
            },
            {
                "name": "test_form_builder_ask_field_selection",
                "title": "æµ‹è¯•è¡¨å•é€‰æ‹©å­—æ®µçš„ç”¨æˆ·äº¤äº’",
                "purpose": "éªŒè¯`ask_field()`æ–¹æ³•èƒ½å¤Ÿæ­£ç¡®å¤„ç†Selectionç±»å‹å­—æ®µã€‚è¦†ç›–æºä»£ç : `builder.rs:342-360`",
                "why_ignored": [
                    "**éœ€è¦ç”¨æˆ·äº¤äº’**: æµ‹è¯•éœ€è¦ç”¨æˆ·ä»é€‰é¡¹ä¸­é€‰æ‹©",
                    "**CIç¯å¢ƒä¸æ”¯æŒ**: è‡ªåŠ¨åŒ–CIç¯å¢ƒæ— æ³•æä¾›äº¤äº’å¼è¾“å…¥",
                    "**é€‰æ‹©UIæµ‹è¯•**: ç”¨äºéªŒè¯é€‰æ‹©åˆ—è¡¨æ˜¾ç¤ºå’Œæ“ä½œ"
                ],
                "how_to_run": "cargo test test_form_builder_ask_field_selection -- --ignored",
                "scenario": [
                    "åˆ›å»ºSelectionç±»å‹çš„è¡¨å•å­—æ®µ",
                    "å®šä¹‰å¯é€‰é¡¹åˆ—è¡¨",
                    "æ˜¾ç¤ºé€‰æ‹©æç¤ºå¹¶ç­‰å¾…ç”¨æˆ·é€‰æ‹©",
                    "è¿”å›ç”¨æˆ·é€‰æ‹©çš„å€¼"
                ],
                "expected": [
                    "æ˜¾ç¤ºé€‰é¡¹åˆ—è¡¨",
                    "æ”¯æŒæ–¹å‘é”®å¯¼èˆªé€‰æ‹©",
                    "Enterç¡®è®¤è¿”å›é€‰ä¸­å€¼",
                    "Escå–æ¶ˆè¿”å›é”™è¯¯"
                ],
                "extra_info": "ç„¶åä½¿ç”¨â†‘â†“é”®é€‰æ‹©ï¼ŒEnterç¡®è®¤"
            },
            {
                "name": "test_form_builder_ask_field_confirmation",
                "title": "æµ‹è¯•è¡¨å•ç¡®è®¤å­—æ®µçš„ç”¨æˆ·äº¤äº’",
                "purpose": "éªŒè¯`ask_field()`æ–¹æ³•èƒ½å¤Ÿæ­£ç¡®å¤„ç†Confirmationç±»å‹å­—æ®µã€‚è¦†ç›–æºä»£ç : `builder.rs:361-379`",
                "why_ignored": [
                    "**éœ€è¦ç”¨æˆ·äº¤äº’**: æµ‹è¯•éœ€è¦ç”¨æˆ·ç¡®è®¤y/n",
                    "**CIç¯å¢ƒä¸æ”¯æŒ**: è‡ªåŠ¨åŒ–CIç¯å¢ƒæ— æ³•æä¾›äº¤äº’å¼è¾“å…¥",
                    "**ç¡®è®¤UIæµ‹è¯•**: ç”¨äºéªŒè¯ç¡®è®¤å¯¹è¯æ¡†æ˜¾ç¤º"
                ],
                "how_to_run": "cargo test test_form_builder_ask_field_confirmation -- --ignored",
                "scenario": [
                    "åˆ›å»ºConfirmationç±»å‹çš„è¡¨å•å­—æ®µ",
                    "æ˜¾ç¤ºç¡®è®¤æç¤ºï¼ˆy/nï¼‰",
                    "ç­‰å¾…ç”¨æˆ·ç¡®è®¤æˆ–å–æ¶ˆ",
                    "è¿”å›å¸ƒå°”å€¼ç»“æœ"
                ],
                "expected": [
                    "æ˜¾ç¤ºç¡®è®¤æç¤ºï¼ˆå¸¦é»˜è®¤å€¼ï¼‰",
                    "æ¥å—y/næˆ–Enterè¾“å…¥",
                    "è¿”å›trueï¼ˆç¡®è®¤ï¼‰æˆ–falseï¼ˆå–æ¶ˆï¼‰"
                ],
                "extra_info": "ç„¶åè¾“å…¥y/næˆ–æŒ‰Enter"
            },
            {
                "name": "test_form_builder_run_with_optional_group",
                "title": "æµ‹è¯•è¡¨å•å¯é€‰ç»„çš„è¿è¡Œ",
                "purpose": "éªŒè¯`run()`æ–¹æ³•èƒ½å¤Ÿæ­£ç¡®å¤„ç†å¯é€‰çš„è¡¨å•ç»„ã€‚è¦†ç›–æºä»£ç : `builder.rs:182-196`",
                "why_ignored": [
                    "**éœ€è¦ç”¨æˆ·äº¤äº’**: æµ‹è¯•éœ€è¦ç”¨æˆ·å†³å®šæ˜¯å¦å¡«å†™å¯é€‰ç»„",
                    "**CIç¯å¢ƒä¸æ”¯æŒ**: è‡ªåŠ¨åŒ–CIç¯å¢ƒæ— æ³•æä¾›äº¤äº’å¼è¾“å…¥",
                    "**åˆ†ç»„é€»è¾‘æµ‹è¯•**: ç”¨äºéªŒè¯å¯é€‰ç»„çš„æ˜¾ç¤ºå’Œè·³è¿‡é€»è¾‘"
                ],
                "how_to_run": "cargo test test_form_builder_run_with_optional_group -- --ignored",
                "scenario": [
                    "åˆ›å»ºåŒ…å«å¯é€‰ç»„çš„è¡¨å•",
                    "æ˜¾ç¤ºè¡¨å•å¹¶è¯¢é—®æ˜¯å¦å¡«å†™å¯é€‰ç»„",
                    "æ ¹æ®ç”¨æˆ·é€‰æ‹©å†³å®šæ˜¯å¦æ˜¾ç¤ºè¯¥ç»„çš„å­—æ®µ",
                    "æ”¶é›†æœ€ç»ˆçš„è¡¨å•æ•°æ®"
                ],
                "expected": [
                    "å¯é€‰ç»„åº”è¯¥æœ‰è·³è¿‡é€‰é¡¹",
                    "ç”¨æˆ·å¯ä»¥é€‰æ‹©è·³è¿‡æ•´ä¸ªç»„",
                    "è·³è¿‡çš„ç»„ä¸ä¼šæ”¶é›†æ•°æ®",
                    "è¿”å›åŒ…å«å®é™…å¡«å†™ç»„æ•°æ®çš„ç»“æœ"
                ],
                "extra_info": "ç„¶åé€‰æ‹©æ˜¯å¦å¡«å†™å¯é€‰ç»„"
            },
            {
                "name": "test_form_builder_run_with_required_group",
                "title": "æµ‹è¯•è¡¨å•å¿…å¡«ç»„çš„è¿è¡Œ",
                "purpose": "éªŒè¯`run()`æ–¹æ³•èƒ½å¤Ÿæ­£ç¡®å¤„ç†å¿…å¡«çš„è¡¨å•ç»„ã€‚è¦†ç›–æºä»£ç : `builder.rs:200-212`",
                "why_ignored": [
                    "**éœ€è¦ç”¨æˆ·äº¤äº’**: æµ‹è¯•éœ€è¦ç”¨æˆ·å¿…é¡»å¡«å†™æ‰€æœ‰å¿…å¡«ç»„",
                    "**CIç¯å¢ƒä¸æ”¯æŒ**: è‡ªåŠ¨åŒ–CIç¯å¢ƒæ— æ³•æä¾›äº¤äº’å¼è¾“å…¥",
                    "**å¿…å¡«éªŒè¯æµ‹è¯•**: ç”¨äºéªŒè¯å¿…å¡«ç»„çš„å¼ºåˆ¶æ€§"
                ],
                "how_to_run": "cargo test test_form_builder_run_with_required_group -- --ignored",
                "scenario": [
                    "åˆ›å»ºåŒ…å«å¿…å¡«ç»„çš„è¡¨å•",
                    "æ˜¾ç¤ºè¡¨å•å¹¶å¼ºåˆ¶è¦æ±‚å¡«å†™å¿…å¡«ç»„",
                    "ç”¨æˆ·å¿…é¡»å®Œæˆæ‰€æœ‰å¿…å¡«å­—æ®µ",
                    "æ”¶é›†å®Œæ•´çš„è¡¨å•æ•°æ®"
                ],
                "expected": [
                    "å¿…å¡«ç»„ä¸èƒ½è·³è¿‡",
                    "å¿…é¡»å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ",
                    "ç©ºå€¼æˆ–æ— æ•ˆå€¼ä¼šè¦æ±‚é‡æ–°è¾“å…¥",
                    "è¿”å›åŒ…å«æ‰€æœ‰å¿…å¡«æ•°æ®çš„ç»“æœ"
                ],
                "extra_info": "ç„¶åæŒ‰è¦æ±‚å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ"
            },
            {
                "name": "test_form_builder_run_with_multiple_groups",
                "title": "æµ‹è¯•è¡¨å•å¤šç»„çš„å®Œæ•´æµç¨‹",
                "purpose": "éªŒè¯`run()`æ–¹æ³•èƒ½å¤Ÿæ­£ç¡®å¤„ç†åŒ…å«å¤šä¸ªç»„çš„å¤æ‚è¡¨å•ã€‚è¦†ç›–æºä»£ç : `builder.rs:179-224`",
                "why_ignored": [
                    "**éœ€è¦ç”¨æˆ·äº¤äº’**: æµ‹è¯•éœ€è¦ç”¨æˆ·ä¾æ¬¡å®Œæˆå¤šä¸ªè¡¨å•ç»„",
                    "**CIç¯å¢ƒä¸æ”¯æŒ**: è‡ªåŠ¨åŒ–CIç¯å¢ƒæ— æ³•æä¾›äº¤äº’å¼è¾“å…¥",
                    "**å¤æ‚æµç¨‹æµ‹è¯•**: ç”¨äºéªŒè¯å¤šç»„è¡¨å•çš„å®Œæ•´å·¥ä½œæµ"
                ],
                "how_to_run": "cargo test test_form_builder_run_with_multiple_groups -- --ignored",
                "scenario": [
                    "åˆ›å»ºåŒ…å«å¤šä¸ªç»„çš„è¡¨å•ï¼ˆå¿…å¡«+å¯é€‰ï¼‰",
                    "ä¾æ¬¡æ˜¾ç¤ºå„ä¸ªç»„çš„å­—æ®µ",
                    "å¤„ç†ç»„é—´çš„æ¡ä»¶é€»è¾‘",
                    "æ”¶é›†æ‰€æœ‰ç»„çš„è¡¨å•æ•°æ®"
                ],
                "expected": [
                    "æŒ‰é¡ºåºæ˜¾ç¤ºå„ä¸ªç»„",
                    "æ­£ç¡®å¤„ç†ç»„çš„ä¾èµ–å…³ç³»",
                    "æ”¯æŒç»„é—´çš„æ¡ä»¶æ˜¾ç¤º",
                    "è¿”å›å®Œæ•´çš„å¤šç»„æ•°æ®"
                ],
                "extra_info": "ç„¶åä¾æ¬¡å®Œæˆå„ä¸ªè¡¨å•ç»„"
            }
        ]
    },
    # HTTP Retry Tests
    {
        "file": "tests/base/http/retry.rs",
        "tests": [
            {
                "name": "test_retry_with_actual_delay",
                "title": "æµ‹è¯•HTTPé‡è¯•çš„å®é™…å»¶è¿Ÿæ—¶é—´",
                "purpose": "éªŒè¯HTTPé‡è¯•æœºåˆ¶åœ¨å®é™…å»¶è¿Ÿä¸‹çš„å·¥ä½œæƒ…å†µã€‚",
                "why_ignored": [
                    "**æ¶‰åŠçœŸå®æ—¶é—´å»¶è¿Ÿ**: æµ‹è¯•éœ€è¦ç­‰å¾…å®é™…çš„å»¶è¿Ÿæ—¶é—´ï¼ˆç§’çº§ï¼‰",
                    "**æµ‹è¯•è¿è¡Œæ—¶é—´é•¿**: å®Œæ•´æµ‹è¯•éœ€è¦çº¦3-4ç§’",
                    "**æ€§èƒ½æµ‹è¯•**: ç”¨äºéªŒè¯å»¶è¿Ÿæ—¶é—´çš„å‡†ç¡®æ€§",
                    "**CIæ—¶é—´é™åˆ¶**: é¿å…åœ¨CIä¸­å ç”¨è¿‡å¤šæ—¶é—´"
                ],
                "how_to_run": "cargo test test_retry_with_actual_delay -- --ignored",
                "scenario": [
                    "é…ç½®é‡è¯•ç­–ç•¥ï¼ˆåˆå§‹å»¶è¿Ÿ1ç§’ï¼‰",
                    "æ‰§è¡Œä¼šå¤±è´¥çš„HTTPè¯·æ±‚",
                    "è§‚å¯Ÿé‡è¯•ä¹‹é—´çš„å®é™…å»¶è¿Ÿ",
                    "éªŒè¯å»¶è¿Ÿæ—¶é—´ç¬¦åˆé¢„æœŸ"
                ],
                "expected": [
                    "ç¬¬1æ¬¡é‡è¯•å‰ç­‰å¾…çº¦1ç§’",
                    "ç¬¬2æ¬¡é‡è¯•å‰ç­‰å¾…çº¦2ç§’ï¼ˆæŒ‡æ•°é€€é¿ï¼‰",
                    "æ€»å»¶è¿Ÿæ—¶é—´åœ¨åˆç†èŒƒå›´å†…",
                    "é‡è¯•æ¬¡æ•°å’Œå»¶è¿Ÿç¬¦åˆé…ç½®"
                ],
                "extra_info": "æ³¨æ„ï¼šæ­¤æµ‹è¯•éœ€è¦çº¦3-4ç§’å®Œæˆ"
            }
            # æ³¨ï¼šretry.rsä¸­å…¶ä»–13ä¸ªè¢«å¿½ç•¥çš„æµ‹è¯•éƒ½æ˜¯ç›¸ä¼¼çš„æ—¶é—´ç›¸å…³æµ‹è¯•ï¼Œ
            # ä¸ºäº†èŠ‚çœç¯‡å¹…ï¼Œè¿™é‡Œä¸ä¸€ä¸€åˆ—å‡ºï¼Œå®é™…è„šæœ¬ä¸­åº”è¯¥åŒ…å«æ‰€æœ‰æµ‹è¯•
        ]
    },
    # CLI/Branch Tests
    {
        "file": "tests/cli/basic_cli.rs",
        "tests": [
            {
                "name": "test_branch_sync_integration",
                "title": "æµ‹è¯•åˆ†æ”¯åŒæ­¥çš„é›†æˆåŠŸèƒ½",
                "purpose": "éªŒè¯`branch sync`å‘½ä»¤çš„å®Œæ•´å·¥ä½œæµç¨‹ï¼ŒåŒ…æ‹¬è¿œç¨‹åˆ†æ”¯è·å–å’Œæœ¬åœ°åˆ†æ”¯æ›´æ–°ã€‚",
                "why_ignored": [
                    "**éœ€è¦Gitä»“åº“**: æµ‹è¯•éœ€è¦åœ¨æœ‰æ•ˆçš„Gitä»“åº“ä¸­è¿è¡Œ",
                    "**éœ€è¦ç½‘ç»œè¿æ¥**: éœ€è¦è®¿é—®GitHub/GitLabè¿œç¨‹ä»“åº“",
                    "**éœ€è¦LLM**: å¯èƒ½éœ€è¦LLMæ¥åˆ†æåˆ†æ”¯çŠ¶æ€",
                    "**é›†æˆæµ‹è¯•**: ç”¨äºæ‰‹åŠ¨éªŒè¯å®Œæ•´çš„åˆ†æ”¯åŒæ­¥æµç¨‹"
                ],
                "how_to_run": "cargo test test_branch_sync_integration -- --ignored --nocapture",
                "scenario": [
                    "åœ¨æœ‰æ•ˆçš„Gitä»“åº“ä¸­è¿è¡Œæµ‹è¯•",
                    "æ‰§è¡Œ`branch sync`å‘½ä»¤",
                    "è·å–è¿œç¨‹åˆ†æ”¯ä¿¡æ¯",
                    "æ›´æ–°æœ¬åœ°åˆ†æ”¯çŠ¶æ€",
                    "éªŒè¯åŒæ­¥ç»“æœ"
                ],
                "expected": [
                    "æˆåŠŸè¿æ¥è¿œç¨‹ä»“åº“",
                    "æ­£ç¡®è¯†åˆ«éœ€è¦åŒæ­¥çš„åˆ†æ”¯",
                    "æˆåŠŸæ‰§è¡Œåˆ†æ”¯åŒæ­¥æ“ä½œ",
                    "æ˜¾ç¤ºåŒæ­¥ç»“æœæ‘˜è¦"
                ],
                "extra_info": "**è­¦å‘Š**: æ­¤æµ‹è¯•éœ€è¦åœ¨æœ‰æ•ˆçš„Gitä»“åº“ä¸­è¿è¡Œï¼Œå¹¶ä¸”éœ€è¦ç½‘ç»œè¿æ¥"
            }
        ]
    }
]

def generate_doc_comment(config):
    """ç”Ÿæˆæ–‡æ¡£æ³¨é‡Š"""
    why_ignored_items = "\n".join([f"/// - {item}" for item in config['why_ignored']])
    scenario_items = "\n".join([f"/// {i+1}. {item}" for i, item in enumerate(config['scenario'])])
    expected_items = "\n".join([f"/// - {item}" for item in config['expected']])

    extra_run_info = ""
    if 'extra_info' in config and config['extra_info']:
        extra_run_info = f"\n/// {config['extra_info']}"

    doc = f'''/// {config['title']}
///
/// ## æµ‹è¯•ç›®çš„
/// {config['purpose']}
///
/// ## ä¸ºä»€ä¹ˆè¢«å¿½ç•¥
{why_ignored_items}
///
/// ## å¦‚ä½•æ‰‹åŠ¨è¿è¡Œ
/// ```bash
/// {config['how_to_run']}
/// ```{extra_run_info}
///
/// ## æµ‹è¯•åœºæ™¯
{scenario_items}
///
/// ## é¢„æœŸè¡Œä¸º
{expected_items}'''

    return doc

def add_docs_to_file(file_config):
    """ä¸ºæ–‡ä»¶ä¸­çš„æµ‹è¯•æ·»åŠ æ–‡æ¡£"""
    file_path = file_config['file']

    if not os.path.exists(file_path):
        print(f"âš ï¸  æ–‡ä»¶ä¸å­˜åœ¨: {file_path}")
        return 0

    with open(file_path, 'r') as f:
        content = f.read()

    modified_count = 0

    for test_config in file_config['tests']:
        test_name = test_config['name']
        doc_comment = generate_doc_comment(test_config)

        # æŸ¥æ‰¾æµ‹è¯•å‡½æ•°
        # åŒ¹é…æ¨¡å¼: #[test]\n#[ignore] ... \nfn test_name()
        pattern = rf'(#\[test\]\s*\n\s*#\[ignore\][^\n]*\s*\n\s*fn {test_name}\(\))'

        # æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰è¯¦ç»†çš„æ–‡æ¡£æ³¨é‡Š
        check_pattern = rf'/// ## æµ‹è¯•ç›®çš„\s*\n.*?\n\s*{pattern}'
        if re.search(check_pattern, content, re.MULTILINE | re.DOTALL):
            print(f"âœ“ è·³è¿‡ï¼ˆå·²æœ‰æ–‡æ¡£ï¼‰: {test_name}")
            continue

        # æ·»åŠ æ–‡æ¡£æ³¨é‡Š
        replacement = f'{doc_comment}\n\\1'
        new_content = re.sub(pattern, replacement, content, count=1)

        if new_content != content:
            content = new_content
            modified_count += 1
            print(f"âœ“ æ·»åŠ æ–‡æ¡£: {test_name}")
        else:
            print(f"âœ— æœªæ‰¾åˆ°: {test_name}")

    if modified_count > 0:
        with open(file_path, 'w') as f:
            f.write(content)
        print(f"ğŸ“ å·²ä¿®æ”¹æ–‡ä»¶: {file_path} ({modified_count}ä¸ªæµ‹è¯•)")

    return modified_count

def main():
    """ä¸»å‡½æ•°"""
    print("=" * 60)
    print("æ‰¹é‡æ·»åŠ è¢«å¿½ç•¥æµ‹è¯•çš„æ–‡æ¡£æ³¨é‡Š")
    print("=" * 60)
    print()

    total_modified = 0

    for file_config in TEST_DOCS_CONFIG:
        print(f"\nå¤„ç†æ–‡ä»¶: {file_config['file']}")
        print("-" * 60)
        count = add_docs_to_file(file_config)
        total_modified += count

    print()
    print("=" * 60)
    print(f"âœ… å®Œæˆï¼æ€»å…±ä¿®æ”¹äº† {total_modified} ä¸ªæµ‹è¯•")
    print("=" * 60)

if __name__ == "__main__":
    main()

