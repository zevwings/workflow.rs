# Workflow æ¶æ„è®¾è®¡

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

Workflow æ˜¯ä¸€ä¸ª Rust ç¼–å†™çš„ CLI å·¥å…·ï¼Œç”¨äºè‡ªåŠ¨åŒ–å¼€å‘å·¥ä½œæµï¼Œæä¾› PR ç®¡ç†ã€Jira é›†æˆã€æ—¥å¿—å¤„ç†ç­‰åŠŸèƒ½ã€‚

---

## ğŸ—ï¸ æ¨¡å—åˆ’åˆ†

```
src/
â”œâ”€â”€ main.rs                 # CLI å…¥å£å’Œå‘½ä»¤åˆ†å‘
â”œâ”€â”€ lib.rs                  # åº“å…¥å£å’Œæ¨¡å—å£°æ˜
â”œâ”€â”€ commands/               # å‘½ä»¤å®ç°æ¨¡å—
â”‚   â”œâ”€â”€ pr/                 # PR ç›¸å…³å‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ create.rs
â”‚   â”‚   â”œâ”€â”€ merge.rs
â”‚   â”‚   â”œâ”€â”€ show.rs
â”‚   â”‚   â”œâ”€â”€ list.rs
â”‚   â”‚   â””â”€â”€ update.rs
â”‚   â”œâ”€â”€ logs/               # æ—¥å¿—ç›¸å…³å‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ download.rs
â”‚   â”‚   â”œâ”€â”€ find.rs
â”‚   â”‚   â””â”€â”€ search.rs
â”‚   â”œâ”€â”€ jira/               # Jira ç›¸å…³å‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ status.rs
â”‚   â”‚   â””â”€â”€ show.rs
â”‚   â”œâ”€â”€ qk/                 # å¿«é€Ÿæ“ä½œ
â”‚   â”‚   â””â”€â”€ qk.rs
â”‚   â”œâ”€â”€ check.rs            # ç»¼åˆæ£€æŸ¥
â”‚   â”œâ”€â”€ proxy.rs            # ä»£ç†æ£€æŸ¥
â”‚   â”œâ”€â”€ config.rs           # é…ç½®ç®¡ç†å‘½ä»¤
â”‚   â””â”€â”€ setup.rs            # åˆå§‹åŒ–è®¾ç½®
â””â”€â”€ lib/                    # æ ¸å¿ƒåŠŸèƒ½åº“
    â”œâ”€â”€ git/                # Git æ“ä½œæ¨¡å—
    â”‚   â”œâ”€â”€ commands.rs
    â”‚   â”œâ”€â”€ repo.rs
    â”‚   â””â”€â”€ types.rs
    â”œâ”€â”€ jira/               # Jira API é›†æˆ
    â”‚   â”œâ”€â”€ api.rs
    â”‚   â”œâ”€â”€ commands.rs
    â”‚   â””â”€â”€ status.rs       # çŠ¶æ€é…ç½®å’Œå·¥ä½œå†å²
    â”œâ”€â”€ pr/                 # PR ç›¸å…³åŠŸèƒ½
    â”‚   â”œâ”€â”€ github.rs
    â”‚   â”œâ”€â”€ codeup.rs
    â”‚   â”œâ”€â”€ provider.rs
    â”‚   â”œâ”€â”€ helpers.rs
    â”‚   â””â”€â”€ constants.rs
    â”œâ”€â”€ llm/                # LLM é›†æˆï¼ˆAI åŠŸèƒ½ï¼‰
    â”‚   â”œâ”€â”€ llm.rs
    â”‚   â”œâ”€â”€ translator.rs
    â”‚   â””â”€â”€ config.rs
    â”œâ”€â”€ log/                # æ—¥å¿—å¤„ç†
    â”‚   â””â”€â”€ logs.rs
    â”œâ”€â”€ settings/           # é…ç½®ç®¡ç†
    â”‚   â””â”€â”€ settings.rs     # ç¯å¢ƒå˜é‡å•ä¾‹
    â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
        â”œâ”€â”€ browser.rs
        â”œâ”€â”€ clipboard.rs
        â”œâ”€â”€ logger.rs
        â”œâ”€â”€ string.rs
        â”œâ”€â”€ proxy.rs
        â””â”€â”€ env.rs
```

---

## ğŸ§  æ ¸å¿ƒæ¨¡å—è®¾è®¡

### AI æ¨¡å— (`lib::ai`)

#### æ¦‚è¿°
AI æ¨¡å—è´Ÿè´£ä» Jira ticket è·å–æè¿°å¹¶ç”Ÿæˆ PR æ ‡é¢˜ï¼Œé‡‡ç”¨ Rust åŸç”Ÿå®ç°ï¼Œæ— éœ€ Python ä¾èµ–ã€‚

#### åŠŸèƒ½ç‰¹æ€§
- ä» Jira ticket è·å–æè¿°å¹¶ç”Ÿæˆ PR æ ‡é¢˜
- è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦ç¿»è¯‘ï¼ˆéè‹±æ–‡æˆ–æè¿°å¤ªé•¿ï¼‰
- ä½¿ç”¨ LLMï¼ˆOpenAI/DeepSeek/Proxyï¼‰ç¿»è¯‘ä¸ºç®€æ´çš„è‹±æ–‡ PR æ ‡é¢˜
- æ”¯æŒå¤š LLM æä¾›å•†ï¼ˆOpenAIã€DeepSeekã€Proxyï¼‰

#### é…ç½®

**ç¯å¢ƒå˜é‡**ï¼š
- `LLM_PROVIDER` - LLM æä¾›å•†ï¼ˆå¯é€‰ï¼Œé»˜è®¤ `openai`ï¼‰
- `LLM_OPENAI_KEY` - OpenAI API Key
- `LLM_DEEPSEEK_KEY` - DeepSeek API Key
- `LLM_PROXY_URL` - Proxy API URL
- `LLM_PROXY_KEY` - Proxy API Key

æ”¯æŒçš„å€¼ï¼š`openai`ã€`deepseek`ã€`proxy`

#### é”™è¯¯å¤„ç†
PR åˆ›å»ºå‘½ä»¤çš„é”™è¯¯å¤„ç†ï¼šå°è¯•ä½¿ç”¨ AI ç”Ÿæˆæ ‡é¢˜ï¼Œå¦‚æœå¤±è´¥åˆ™å›é€€åˆ°æ‰‹åŠ¨è¾“å…¥ã€‚

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
# åˆ›å»º PRï¼ˆè‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜ï¼‰
workflow pr create PROJ-123

# æ‰‹åŠ¨æŒ‡å®šæ ‡é¢˜ï¼ˆè·³è¿‡ AI ç”Ÿæˆï¼‰
workflow pr create PROJ-123 --title "Fix bug"
```

#### ç›¸å…³æ–‡ä»¶
- `src/lib/llm/` - LLM é›†æˆæ¨¡å—
- `src/commands/pr/create.rs` - PR åˆ›å»ºå‘½ä»¤ï¼ˆå·²é›†æˆ AI åŠŸèƒ½ï¼‰

---

## ğŸ’¾ æ•°æ®å­˜å‚¨

### é…ç½®æ–‡ä»¶ä½ç½®

æ‰€æœ‰é…ç½®æ–‡ä»¶å­˜å‚¨åœ¨ `${HOME}/.workflow/` ç›®å½•ä¸‹ï¼š

- `jira-status.json` - Jira é¡¹ç›®çŠ¶æ€æ˜ å°„é…ç½®
- `work-history.json` - PR å’Œ Jira ticket çš„å…³è”å†å²

### Jira Status é…ç½® (`jira-status.json`)

å­˜å‚¨æ¯ä¸ª Jira é¡¹ç›®åœ¨åˆ›å»º PR å’Œåˆå¹¶ PR æ—¶çš„çŠ¶æ€æ˜ å°„å…³ç³»ã€‚

**æ ¼å¼**ï¼š
```json
{
  "WEW": {
    "created-pr": "In Progress",
    "merged-pr": "Done"
  },
  "PROJ": {
    "created-pr": "In Review",
    "merged-pr": "Done"
  }
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- åˆ›å»º PR æ—¶è‡ªåŠ¨æ›´æ–° Jira ticket çŠ¶æ€ä¸º `created-pr` é…ç½®çš„çŠ¶æ€
- åˆå¹¶ PR æ—¶è‡ªåŠ¨æ›´æ–° Jira ticket çŠ¶æ€ä¸º `merged-pr` é…ç½®çš„çŠ¶æ€

### Work History (`work-history.json`)

å­˜å‚¨ PR ID åˆ° Jira ticket çš„æ˜ å°„å…³ç³»ï¼Œç”¨äºåœ¨åˆå¹¶ PR æ—¶è‡ªåŠ¨æŸ¥æ‰¾å¯¹åº”çš„ Jira ticketã€‚

**æ ¼å¼**ï¼š
```json
{
  "456": {
    "jira_ticket": "PROJ-123",
    "pr_url": "https://github.com/xxx/pull/456",
    "created_at": "2024-01-15T10:30:00Z",
    "merged_at": null,
    "repository": "github.com/xxx/yyy",
    "branch": "feature/PROJ-123-add-feature"
  }
}
```

**ä½¿ç”¨æµç¨‹**ï¼š
1. **å†™å…¥æ—¶æœº**ï¼šåˆ›å»º PR æ—¶è‡ªåŠ¨è®°å½•æ˜ å°„å…³ç³»
2. **è¯»å–æ—¶æœº**ï¼šåˆå¹¶ PR æ—¶æŸ¥æ‰¾å¯¹åº”çš„ Jira ticketï¼Œè‡ªåŠ¨æ›´æ–°çŠ¶æ€
3. **å®¹é”™æœºåˆ¶**ï¼šå¦‚æœå†å²è®°å½•ä¸­æ²¡æœ‰ï¼Œä¼šå°è¯•ä» PR æ ‡é¢˜ä¸­æå– Jira ticket ID

**ç›¸å…³æ–‡ä»¶**ï¼š
- `src/lib/jira/status.rs` - å·¥ä½œå†å²çš„è¯»å†™é€»è¾‘

---

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼
- ä½¿ç”¨ `rustfmt` æ ¼å¼åŒ–ä»£ç 
- ä½¿ç”¨ `clippy` è¿›è¡Œ lint æ£€æŸ¥
- éµå¾ª Rust å‘½åçº¦å®š

### é”™è¯¯å¤„ç†
- ä½¿ç”¨ `anyhow::Result` ä½œä¸ºè¿”å›ç±»å‹
- æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- ä½¿ç”¨ `Context` æ·»åŠ ä¸Šä¸‹æ–‡ä¿¡æ¯

### æ–‡æ¡£
- æ‰€æœ‰å…¬å…±å‡½æ•°æ·»åŠ æ–‡æ¡£æ³¨é‡Š
- ä½¿ç”¨ `///` ç¼–å†™æ–‡æ¡£
- åŒ…å«ä½¿ç”¨ç¤ºä¾‹

### æäº¤è§„èŒƒ
- ä½¿ç”¨ Conventional Commits æ ¼å¼
- ä¿æŒæäº¤å†å²æ¸…æ™°

---
