# PR æµ‹è¯•åŠŸèƒ½å®æ–½è®¡åˆ’

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æ˜¯ PR æµ‹è¯•åŠŸèƒ½çš„**æœ€ä½³å®æ–½è®¡åˆ’**ï¼Œæ•´åˆäº†æ‰€æœ‰éœ€æ±‚æ–‡æ¡£ï¼Œæä¾›ï¼š
- âœ… æ¸…æ™°çš„å®æ–½è·¯å¾„å’Œä¼˜å…ˆçº§
- âœ… è¯¦ç»†çš„å®ç°æ­¥éª¤å’Œä»£ç ç»“æ„
- âœ… ä¾èµ–å…³ç³»å’ŒæŠ€æœ¯é€‰å‹
- âœ… æµ‹è¯•ç­–ç•¥å’ŒéªŒæ”¶æ ‡å‡†
- âœ… é£é™©è¯„ä¼°å’Œåº”å¯¹æ–¹æ¡ˆ

## ğŸ¯ å®æ–½ç›®æ ‡

### æ ¸å¿ƒç›®æ ‡
ä¸º PR ä¿®æ”¹æä¾›å…¨é¢çš„æµ‹è¯•æ”¯æŒï¼ŒåŒ…æ‹¬ï¼š
1. **æµ‹è¯•éœ€æ±‚åˆ†æ**ï¼šè‡ªåŠ¨è¯†åˆ«éœ€è¦æµ‹è¯•çš„å†…å®¹
2. **æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šè‡ªåŠ¨æ‰§è¡Œæ¥å£æµ‹è¯•å¹¶ç”ŸæˆæŠ¥å‘Š
3. **æµ‹è¯•å»ºè®®ç”Ÿæˆ**ï¼šåŸºäºä»£ç å˜æ›´ç”Ÿæˆæµ‹è¯•å»ºè®®

### æˆåŠŸæ ‡å‡†
- âœ… èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ« PR ä¿®æ”¹çš„æ¥å£å’Œç»„ä»¶
- âœ… èƒ½å¤Ÿæœç´¢ä»£ç åº“æ‰¾åˆ°è°ƒç”¨ç‚¹
- âœ… èƒ½å¤Ÿè‡ªåŠ¨æ‰§è¡Œæ¥å£æµ‹è¯•
- âœ… èƒ½å¤Ÿç”Ÿæˆæ¸…æ™°çš„æµ‹è¯•æŠ¥å‘Šå’Œå»ºè®®

## ğŸ“Š å®æ–½ä¼˜å…ˆçº§

### ä¼˜å…ˆçº§ P0ï¼ˆå¿…é¡»å®ç° - MVPï¼‰
1. **ä»£ç åº“æœç´¢æ¨¡å—** - åŸºç¡€è®¾æ–½ï¼Œå…¶ä»–åŠŸèƒ½ä¾èµ–
2. **æ¥å£è¯†åˆ«æ¨¡å—** - æ ¸å¿ƒåŠŸèƒ½ï¼Œè¯†åˆ«ä¿®æ”¹çš„æ¥å£
3. **æµ‹è¯•éœ€æ±‚åˆ†æå‘½ä»¤** - åŸºç¡€åˆ†æåŠŸèƒ½

### ä¼˜å…ˆçº§ P1ï¼ˆé‡è¦åŠŸèƒ½ï¼‰
4. **æ¥å£æµ‹è¯•å‚æ•°ç”Ÿæˆ** - åŸºç¡€æµ‹è¯•æ•°æ®ç”Ÿæˆ
5. **æ¥å£æµ‹è¯•æ‰§è¡Œ** - åŸºç¡€ HTTP è¯·æ±‚å’ŒéªŒè¯
6. **æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ** - ç»“æœå±•ç¤º

### ä¼˜å…ˆçº§ P2ï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰
7. **è°ƒç”¨ç‚¹æŸ¥æ‰¾** - æŸ¥æ‰¾å‰ç«¯è°ƒç”¨ã€å…¶ä»–æœåŠ¡è°ƒç”¨
8. **é«˜çº§å‚æ•°ç”Ÿæˆ** - æ”¯æŒå¤æ‚ç±»å‹ï¼ˆObjectã€Arrayï¼‰
9. **å“åº”éªŒè¯å¢å¼º** - ç»“æ„éªŒè¯ã€ä¸šåŠ¡é€»è¾‘éªŒè¯

### ä¼˜å…ˆçº§ P3ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰
10. **AST è§£ææ”¯æŒ** - æé«˜è¯†åˆ«å‡†ç¡®åº¦
11. **ç´¢å¼•æœºåˆ¶** - æ€§èƒ½ä¼˜åŒ–
12. **CI/CD é›†æˆ** - è‡ªåŠ¨åŒ–é›†æˆ

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ¨¡å—ç»“æ„

```
src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ codebase/              # ä»£ç åº“è®¿é—®æ¨¡å—ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ search.rs          # ä»£ç åº“æœç´¢ï¼ˆGitHub MCPã€Git grepã€ripgrepï¼‰
â”‚   â”‚   â””â”€â”€ filter.rs          # æ™ºèƒ½è¿‡æ»¤
â”‚   â”‚
â”‚   â””â”€â”€ pr/
â”‚       â””â”€â”€ test/              # PR æµ‹è¯•æ¨¡å—ï¼ˆæ–°å¢ï¼‰
â”‚           â”œâ”€â”€ mod.rs
â”‚           â”œâ”€â”€ endpoint.rs    # æ¥å£è¯†åˆ«
â”‚           â”œâ”€â”€ analysis.rs    # æµ‹è¯•éœ€æ±‚åˆ†æ
â”‚           â”œâ”€â”€ api.rs         # æ¥å£æµ‹è¯•æ‰§è¡Œ
â”‚           â”œâ”€â”€ generator.rs   # æµ‹è¯•å‚æ•°ç”Ÿæˆ
â”‚           â””â”€â”€ report.rs      # æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
â”‚
â””â”€â”€ commands/
    â””â”€â”€ pr/
        â”œâ”€â”€ test_analysis.rs   # test-analysis å‘½ä»¤ï¼ˆæ–°å¢ï¼‰
        â””â”€â”€ test_api.rs        # test-api å‘½ä»¤ï¼ˆæ–°å¢ï¼‰
```

### æ•°æ®æµ

```
PR Diff
  â†“
[æ¥å£è¯†åˆ«æ¨¡å—] â†’ è¯†åˆ«æ¥å£è·¯å¾„å’Œæ–¹æ³•
  â†“
[ä»£ç åº“æœç´¢æ¨¡å—] â†’ æœç´¢æ¥å£å®šä¹‰å’Œè°ƒç”¨ç‚¹
  â†“
[æµ‹è¯•éœ€æ±‚åˆ†ææ¨¡å—] â†’ ç”Ÿæˆæµ‹è¯•å»ºè®®
  â†“
[æ¥å£æµ‹è¯•æ¨¡å—] â†’ ç”Ÿæˆå‚æ•° â†’ æ‰§è¡Œæµ‹è¯• â†’ éªŒè¯å“åº”
  â†“
[æµ‹è¯•æŠ¥å‘Šæ¨¡å—] â†’ ç”ŸæˆæŠ¥å‘Š
```

## ğŸš€ å®æ–½æ­¥éª¤

### é˜¶æ®µä¸€ï¼šåŸºç¡€è®¾æ–½ï¼ˆP0 - 2-3 å¤©ï¼‰

#### 1.1 ä»£ç åº“æœç´¢æ¨¡å—

**æ–‡ä»¶**ï¼š`src/lib/codebase/search.rs`

**åŠŸèƒ½**ï¼š
- æ”¯æŒå¤šç§æœç´¢ç­–ç•¥ï¼ˆGitHub MCPã€Git grepã€ripgrepã€æ–‡ä»¶ç³»ç»Ÿï¼‰
- è‡ªåŠ¨æ£€æµ‹æœ€ä¼˜ç­–ç•¥
- æ™ºèƒ½è¿‡æ»¤å’Œç¼“å­˜

**å®ç°æ­¥éª¤**ï¼š

```rust
// 1. å®šä¹‰æœç´¢ç­–ç•¥æšä¸¾
pub enum SearchStrategy {
    GitHubMCP,
    GitGrep,
    RipGrep,
    FileSystem,
}

// 2. å®ç°ç­–ç•¥æ£€æµ‹
impl SearchStrategy {
    pub fn detect() -> Self {
        // æ£€æŸ¥æ˜¯å¦æ˜¯ GitHub ä»“åº“ä¸” MCP å¯ç”¨
        if Self::is_github_repo() && Self::is_mcp_available() {
            return SearchStrategy::GitHubMCP;
        }
        // ... å…¶ä»–æ£€æµ‹é€»è¾‘
    }
}

// 3. å®ç°æœç´¢æ¥å£
pub struct CodebaseSearcher {
    strategy: SearchStrategy,
    cache: SearchCache,
}

impl CodebaseSearcher {
    pub fn search(&self, pattern: &str) -> Result<Vec<SearchResult>> {
        // æ£€æŸ¥ç¼“å­˜
        if let Some(cached) = self.cache.get(pattern) {
            return Ok(cached);
        }

        // æ‰§è¡Œæœç´¢
        let results = match self.strategy {
            SearchStrategy::GitHubMCP => self.search_via_github_mcp(pattern)?,
            SearchStrategy::GitGrep => self.search_via_git_grep(pattern)?,
            SearchStrategy::RipGrep => self.search_via_ripgrep(pattern)?,
            SearchStrategy::FileSystem => self.search_via_filesystem(pattern)?,
        };

        // ç¼“å­˜ç»“æœ
        self.cache.set(pattern, results.clone());
        Ok(results)
    }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… èƒ½å¤Ÿæ£€æµ‹å¹¶é€‰æ‹©æœ€ä¼˜æœç´¢ç­–ç•¥
- âœ… èƒ½å¤Ÿæœç´¢ä»£ç åº“æ‰¾åˆ°åŒ¹é…é¡¹
- âœ… æ”¯æŒç¼“å­˜æœºåˆ¶
- âœ… æ”¯æŒæ™ºèƒ½è¿‡æ»¤ï¼ˆç›®å½•ã€æ–‡ä»¶ç±»å‹ï¼‰

#### 1.2 æ¥å£è¯†åˆ«æ¨¡å—

**æ–‡ä»¶**ï¼š`src/lib/pr/test/endpoint.rs`

**åŠŸèƒ½**ï¼š
- ä» PR diff è¯†åˆ«æ¥å£è·¯å¾„å’Œæ–¹æ³•
- æ”¯æŒå¤šç§æ¡†æ¶æ¨¡å¼
- ä½¿ç”¨ LLM è§£ææ¥å£å®šä¹‰

**å®ç°æ­¥éª¤**ï¼š

```rust
// 1. å®šä¹‰æ¥å£ä¿¡æ¯ç»“æ„
pub struct ApiEndpoint {
    pub path: String,
    pub method: HttpMethod,
    pub file_path: String,
    pub line_number: Option<u32>,
}

// 2. å®ç°æ¥å£è¯†åˆ«
pub struct EndpointIdentifier;

impl EndpointIdentifier {
    pub fn identify_from_diff(diff: &str) -> Result<Vec<ApiEndpoint>> {
        let file_changes = parse_diff_to_file_changes(diff)?;
        let mut endpoints = Vec::new();

        for (file_path, content) in file_changes {
            // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¯†åˆ«å¸¸è§æ¨¡å¼
            let found = Self::identify_by_patterns(&file_path, &content)?;
            endpoints.extend(found);
        }

        Ok(endpoints)
    }

    fn identify_by_patterns(file_path: &str, content: &str) -> Result<Vec<ApiEndpoint>> {
        // Rust: #[get("/api/users")]
        // Spring Boot: @GetMapping("/api/users")
        // Express: router.get('/api/users')
        // ... å…¶ä»–æ¨¡å¼
    }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… èƒ½å¤Ÿè¯†åˆ«å¸¸è§æ¡†æ¶çš„æ¥å£å®šä¹‰
- âœ… èƒ½å¤Ÿæå–æ¥å£è·¯å¾„å’Œæ–¹æ³•
- âœ… æ”¯æŒ Rustã€Spring Bootã€Express ç­‰æ¡†æ¶

### é˜¶æ®µäºŒï¼šæµ‹è¯•éœ€æ±‚åˆ†æï¼ˆP0 - 2-3 å¤©ï¼‰

#### 2.1 æµ‹è¯•éœ€æ±‚åˆ†ææ¨¡å—

**æ–‡ä»¶**ï¼š`src/lib/pr/test/analysis.rs`

**åŠŸèƒ½**ï¼š
- åˆ†æ PR ä¿®æ”¹
- è¯†åˆ«æµ‹è¯•éœ€æ±‚
- ç”Ÿæˆæµ‹è¯•å»ºè®®

**å®ç°æ­¥éª¤**ï¼š

```rust
pub struct TestAnalysis;

impl TestAnalysis {
    pub fn analyze(pr_diff: &str) -> Result<TestAnalysisResult> {
        // 1. è¯†åˆ«ä¿®æ”¹çš„æ¥å£/ç»„ä»¶
        let endpoints = EndpointIdentifier::identify_from_diff(pr_diff)?;
        let components = ComponentIdentifier::identify_from_diff(pr_diff)?;

        // 2. æŸ¥æ‰¾è°ƒç”¨ç‚¹
        let searcher = CodebaseSearcher::new()?;
        let mut call_sites = Vec::new();

        for endpoint in &endpoints {
            let calls = searcher.search(&endpoint.path)?;
            call_sites.extend(calls);
        }

        // 3. ä½¿ç”¨ LLM ç”Ÿæˆæµ‹è¯•å»ºè®®
        let suggestions = Self::generate_suggestions_with_llm(
            &endpoints,
            &components,
            &call_sites,
        )?;

        Ok(TestAnalysisResult {
            endpoints,
            components,
            call_sites,
            suggestions,
        })
    }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… èƒ½å¤Ÿè¯†åˆ«ä¿®æ”¹çš„æ¥å£å’Œç»„ä»¶
- âœ… èƒ½å¤ŸæŸ¥æ‰¾è°ƒç”¨ç‚¹
- âœ… èƒ½å¤Ÿç”Ÿæˆæµ‹è¯•å»ºè®®

#### 2.2 æµ‹è¯•éœ€æ±‚åˆ†æå‘½ä»¤

**æ–‡ä»¶**ï¼š`src/commands/pr/test_analysis.rs`

**åŠŸèƒ½**ï¼š
- å®ç° `workflow pr test-analysis` å‘½ä»¤
- ç”Ÿæˆæµ‹è¯•éœ€æ±‚æ–‡æ¡£

**å®ç°æ­¥éª¤**ï¼š

```rust
pub struct TestAnalysisCommand;

impl TestAnalysisCommand {
    pub fn run(pr_id: Option<String>) -> Result<String> {
        // 1. è·å– PR diff
        let provider = create_provider()?;
        let pr_id = resolve_pr_id(pr_id)?;
        let pr_diff = provider.get_pull_request_diff(&pr_id)?;

        // 2. æ‰§è¡Œåˆ†æ
        let analysis = TestAnalysis::analyze(&pr_diff)?;

        // 3. ç”ŸæˆæŠ¥å‘Š
        let report = TestReport::generate_analysis_report(&analysis)?;

        // 4. ä¿å­˜æŠ¥å‘Š
        let output_path = Self::save_report(&pr_id, &report)?;

        Ok(output_path)
    }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… å‘½ä»¤èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œ
- âœ… èƒ½å¤Ÿç”Ÿæˆ Markdown æ ¼å¼çš„æµ‹è¯•éœ€æ±‚æ–‡æ¡£
- âœ… æ–‡æ¡£åŒ…å«æ¥å£åˆ—è¡¨ã€è°ƒç”¨ç‚¹ã€æµ‹è¯•å»ºè®®

### é˜¶æ®µä¸‰ï¼šæ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆP1 - 3-4 å¤©ï¼‰

#### 3.1 æµ‹è¯•å‚æ•°ç”Ÿæˆæ¨¡å—

**æ–‡ä»¶**ï¼š`src/lib/pr/test/generator.rs`

**åŠŸèƒ½**ï¼š
- æ ¹æ®å‚æ•°ç±»å‹ç”Ÿæˆæµ‹è¯•æ•°æ®
- æ”¯æŒåŸºç¡€ç±»å‹ï¼ˆStringã€Numberã€Booleanï¼‰
- ä»é…ç½®æ–‡ä»¶è¯»å–å…¬å…±å‚æ•°

**å®ç°æ­¥éª¤**ï¼š

```rust
pub struct TestDataGenerator;

impl TestDataGenerator {
    pub fn generate_for_endpoint(
        endpoint: &ApiEndpoint,
        definition: &EndpointDefinition,
    ) -> Result<TestRequest> {
        // 1. ç”Ÿæˆè·¯å¾„å‚æ•°
        let path_params = Self::generate_path_params(&definition.path_params)?;

        // 2. ç”ŸæˆæŸ¥è¯¢å‚æ•°
        let query_params = Self::generate_query_params(&definition.query_params)?;

        // 3. ç”Ÿæˆè¯·æ±‚ä½“
        let body = if let Some(body_def) = &definition.body {
            Some(Self::generate_body(&body_def)?)
        } else {
            None
        };

        // 4. è¯»å–å…¬å…±å‚æ•°
        let settings = Settings::get();
        let common_headers = settings.pr_test.api.common_headers.clone();

        Ok(TestRequest {
            path_params,
            query_params,
            body,
            headers: common_headers,
        })
    }

    fn generate_path_params(params: &[Param]) -> Result<HashMap<String, String>> {
        // æ ¹æ®å‚æ•°ç±»å‹ç”Ÿæˆæµ‹è¯•å€¼
    }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… èƒ½å¤Ÿæ ¹æ®ç±»å‹ç”Ÿæˆæµ‹è¯•æ•°æ®
- âœ… æ”¯æŒ Stringã€Numberã€Boolean
- âœ… èƒ½å¤Ÿè¯»å–å…¬å…±å‚æ•°é…ç½®

#### 3.2 æ¥å£æµ‹è¯•æ‰§è¡Œæ¨¡å—

**æ–‡ä»¶**ï¼š`src/lib/pr/test/api.rs`

**åŠŸèƒ½**ï¼š
- æ‰§è¡Œæ¥å£æµ‹è¯•
- éªŒè¯å“åº”ç»“æœ
- ç”Ÿæˆæµ‹è¯•ç»“æœ

**å®ç°æ­¥éª¤**ï¼š

```rust
pub struct ApiTester;

impl ApiTester {
    pub async fn test_endpoint(
        endpoint: &ApiEndpoint,
        request: &TestRequest,
    ) -> Result<TestResult> {
        // 1. æ„å»ºå®Œæ•´ URL
        let url = Self::build_url(&endpoint.path, &request.path_params)?;

        // 2. æ„å»ºè¯·æ±‚é…ç½®
        let client = HttpClient::global()?;
        let mut config = RequestConfig::new()
            .headers(&request.headers);

        // 3. å‘é€è¯·æ±‚
        let start = Instant::now();
        let response = match endpoint.method {
            HttpMethod::Get => client.get(&url, config)?,
            HttpMethod::Post => {
                config = config.body(&request.body);
                client.post(&url, config)?
            },
            // ... å…¶ä»–æ–¹æ³•
        };
        let duration = start.elapsed();

        // 4. éªŒè¯å“åº”
        let validation = Self::validate_response(&response, &endpoint)?;

        Ok(TestResult {
            endpoint: endpoint.clone(),
            request: request.clone(),
            response: TestResponse {
                status_code: response.status(),
                body: response.as_json().ok(),
                duration,
            },
            validation,
        })
    }

    fn validate_response(
        response: &HttpResponse,
        endpoint: &ApiEndpoint,
    ) -> Result<ValidationResult> {
        // åŸºç¡€éªŒè¯ï¼šçŠ¶æ€ç 
        // TODO: å¢å¼ºéªŒè¯ï¼ˆå“åº”ä½“ç»“æ„ã€å­—æ®µç±»å‹ç­‰ï¼‰
        Ok(ValidationResult {
            passed: response.status().is_success(),
            checks: vec![],
        })
    }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… èƒ½å¤Ÿå‘é€ HTTP è¯·æ±‚
- âœ… èƒ½å¤ŸéªŒè¯å“åº”çŠ¶æ€ç 
- âœ… èƒ½å¤Ÿè®°å½•è¯·æ±‚å’Œå“åº”ä¿¡æ¯

#### 3.3 æ¥å£æµ‹è¯•å‘½ä»¤

**æ–‡ä»¶**ï¼š`src/commands/pr/test_api.rs`

**åŠŸèƒ½**ï¼š
- å®ç° `workflow pr test-api` å‘½ä»¤
- è‡ªåŠ¨è¯†åˆ«å¹¶æµ‹è¯•ä¿®æ”¹çš„æ¥å£

**å®ç°æ­¥éª¤**ï¼š

```rust
pub struct TestApiCommand;

impl TestApiCommand {
    pub async fn run(pr_id: Option<String>, env: Option<String>) -> Result<String> {
        // 1. è·å– PR diff
        let provider = create_provider()?;
        let pr_id = resolve_pr_id(pr_id)?;
        let pr_diff = provider.get_pull_request_diff(&pr_id)?;

        // 2. è¯†åˆ«æ¥å£
        let endpoints = EndpointIdentifier::identify_from_diff(&pr_diff)?;

        // 3. æœç´¢æ¥å£å®šä¹‰
        let searcher = CodebaseSearcher::new()?;
        let mut results = Vec::new();

        for endpoint in &endpoints {
            // æœç´¢æ¥å£å®šä¹‰
            let definition = Self::find_endpoint_definition(&searcher, endpoint)?;

            // ç”Ÿæˆæµ‹è¯•å‚æ•°
            let request = TestDataGenerator::generate_for_endpoint(endpoint, &definition)?;

            // æ‰§è¡Œæµ‹è¯•
            let result = ApiTester::test_endpoint(endpoint, &request).await?;
            results.push(result);
        }

        // 4. ç”ŸæˆæŠ¥å‘Š
        let report = TestReport::generate_api_report(&results)?;

        // 5. ä¿å­˜æŠ¥å‘Š
        let output_path = Self::save_report(&pr_id, &report)?;

        Ok(output_path)
    }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… å‘½ä»¤èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œ
- âœ… èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å¹¶æµ‹è¯•ä¿®æ”¹çš„æ¥å£
- âœ… èƒ½å¤Ÿç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

### é˜¶æ®µå››ï¼šå¢å¼ºåŠŸèƒ½ï¼ˆP2 - 2-3 å¤©ï¼‰

#### 4.1 è°ƒç”¨ç‚¹æŸ¥æ‰¾å¢å¼º

**åŠŸèƒ½**ï¼š
- æŸ¥æ‰¾å‰ç«¯è°ƒç”¨ç‚¹
- æŸ¥æ‰¾å…¶ä»–æœåŠ¡è°ƒç”¨ç‚¹
- åŒºåˆ†ä¸åŒç±»å‹çš„è°ƒç”¨

#### 4.2 é«˜çº§å‚æ•°ç”Ÿæˆ

**åŠŸèƒ½**ï¼š
- æ”¯æŒ Objectã€Array ç±»å‹
- ä½¿ç”¨ LLM ç”Ÿæˆæ›´åˆç†çš„æµ‹è¯•æ•°æ®
- æ”¯æŒæµ‹è¯•æ•°æ®æ¨¡æ¿

#### 4.3 å“åº”éªŒè¯å¢å¼º

**åŠŸèƒ½**ï¼š
- éªŒè¯å“åº”ä½“ç»“æ„
- éªŒè¯å­—æ®µç±»å‹
- ä¸šåŠ¡é€»è¾‘éªŒè¯

## ğŸ”§ æŠ€æœ¯é€‰å‹

### ä»£ç åº“æœç´¢

**ä¼˜å…ˆçº§**ï¼š
1. **GitHub MCP**ï¼ˆGitHub ä»“åº“ä¼˜å…ˆï¼‰
2. **Git grep**ï¼ˆæœ¬åœ° Git ä»“åº“ï¼‰
3. **ripgrep**ï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰
4. **æ–‡ä»¶ç³»ç»Ÿæœç´¢**ï¼ˆfallbackï¼‰

### æ¥å£è¯†åˆ«

**æ–¹æ¡ˆ**ï¼š
- **é˜¶æ®µä¸€**ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¸¸è§æ¨¡å¼
- **é˜¶æ®µäºŒ**ï¼šä½¿ç”¨ LLM è§£ææ¥å£å®šä¹‰
- **é˜¶æ®µä¸‰**ï¼šAST è§£æï¼ˆå¯é€‰ï¼Œæé«˜å‡†ç¡®åº¦ï¼‰

### æµ‹è¯•å‚æ•°ç”Ÿæˆ

**æ–¹æ¡ˆ**ï¼š
- **é˜¶æ®µä¸€**ï¼šåŸºäºç±»å‹æ¨¡æ¿ç”Ÿæˆ
- **é˜¶æ®µäºŒ**ï¼šä½¿ç”¨ LLM ç”Ÿæˆæ›´åˆç†çš„æµ‹è¯•æ•°æ®
- **é˜¶æ®µä¸‰**ï¼šæ”¯æŒæµ‹è¯•æ•°æ®æ¨¡æ¿å’Œé…ç½®æ–‡ä»¶

## ğŸ“ é…ç½®è®¾è®¡

### Settings æ‰©å±•

```rust
// src/lib/base/settings/settings.rs

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct Settings {
    // ... ç°æœ‰å­—æ®µ

    #[serde(default)]
    pub pr_test: PrTestSettings,
}

#[derive(Debug, Clone, Serialize, Deserialize, Default)]
pub struct PrTestSettings {
    /// ä»£ç åº“æœç´¢é…ç½®
    #[serde(default)]
    pub search: SearchSettings,

    /// æ¥å£æµ‹è¯•é…ç½®
    #[serde(default)]
    pub api: ApiTestSettings,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct SearchSettings {
    /// æœç´¢ç­–ç•¥ï¼šgithub_mcp, git_grep, ripgrep, filesystem, auto
    #[serde(default = "default_search_strategy")]
    pub strategy: String,

    /// åŒ…å«çš„ç›®å½•
    #[serde(default)]
    pub include_dirs: Vec<String>,

    /// æ’é™¤çš„ç›®å½•
    #[serde(default = "default_exclude_dirs")]
    pub exclude_dirs: Vec<String>,

    /// æ˜¯å¦å¯ç”¨ç¼“å­˜
    #[serde(default = "default_true")]
    pub enable_cache: bool,

    /// ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
    #[serde(default = "default_cache_ttl")]
    pub cache_ttl: u64,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ApiTestSettings {
    /// API åŸºç¡€ URL
    pub base_url: String,

    /// API Token
    pub token: Option<String>,

    /// Locationï¼ˆåœ°ç†ä½ç½®å‚æ•°ï¼‰
    pub location: Option<String>,

    /// å…¬å…±è¯·æ±‚å¤´
    #[serde(default)]
    pub common_headers: HashMap<String, String>,

    /// æµ‹è¯•æ•°æ®æ¨¡æ¿ç›®å½•
    pub test_data_dir: Option<String>,

    /// ç¯å¢ƒï¼ˆdevã€testã€prodï¼‰
    pub environment: Option<String>,
}
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

- ä»£ç åº“æœç´¢æ¨¡å—ï¼šæµ‹è¯•å„ç§æœç´¢ç­–ç•¥
- æ¥å£è¯†åˆ«æ¨¡å—ï¼šæµ‹è¯•å„ç§æ¡†æ¶æ¨¡å¼è¯†åˆ«
- æµ‹è¯•å‚æ•°ç”Ÿæˆï¼šæµ‹è¯•å„ç§ç±»å‹çš„æ•°æ®ç”Ÿæˆ

### é›†æˆæµ‹è¯•

- æµ‹è¯•éœ€æ±‚åˆ†æï¼šç«¯åˆ°ç«¯æµ‹è¯•åˆ†ææµç¨‹
- æ¥å£æµ‹è¯•ï¼šç«¯åˆ°ç«¯æµ‹è¯•æ‰§è¡Œæµç¨‹

### éªŒæ”¶æµ‹è¯•

- ä½¿ç”¨çœŸå® PR è¿›è¡Œæµ‹è¯•
- éªŒè¯ç”Ÿæˆçš„æŠ¥å‘Šè´¨é‡

## âš ï¸ é£é™©è¯„ä¼°

### é£é™© 1ï¼šGitHub MCP ä¸å¯ç”¨

**å½±å“**ï¼šé«˜
**æ¦‚ç‡**ï¼šä½
**åº”å¯¹**ï¼š
- æä¾› fallback åˆ° Git grep
- æ£€æµ‹ MCP å¯ç”¨æ€§ï¼Œè‡ªåŠ¨åˆ‡æ¢ç­–ç•¥

### é£é™© 2ï¼šæ¥å£è¯†åˆ«å‡†ç¡®åº¦ä½

**å½±å“**ï¼šé«˜
**æ¦‚ç‡**ï¼šä¸­
**åº”å¯¹**ï¼š
- ä½¿ç”¨ LLM æé«˜è¯†åˆ«å‡†ç¡®åº¦
- æ”¯æŒç”¨æˆ·æ‰‹åŠ¨æŒ‡å®šæ¥å£
- æä¾›è¯†åˆ«ç»“æœé¢„è§ˆå’Œç¡®è®¤

### é£é™© 3ï¼šæµ‹è¯•å‚æ•°ç”Ÿæˆä¸ç¬¦åˆä¸šåŠ¡é€»è¾‘

**å½±å“**ï¼šä¸­
**æ¦‚ç‡**ï¼šä¸­
**åº”å¯¹**ï¼š
- æ”¯æŒæµ‹è¯•æ•°æ®æ¨¡æ¿
- ä½¿ç”¨ LLM ç”Ÿæˆæ›´åˆç†çš„æµ‹è¯•æ•°æ®
- å…è®¸ç”¨æˆ·è‡ªå®šä¹‰æµ‹è¯•æ•°æ®

### é£é™© 4ï¼šæ€§èƒ½é—®é¢˜ï¼ˆå¤§ä»£ç åº“ï¼‰

**å½±å“**ï¼šä¸­
**æ¦‚ç‡**ï¼šä½
**åº”å¯¹**ï¼š
- ä½¿ç”¨ç¼“å­˜æœºåˆ¶
- æ™ºèƒ½è¿‡æ»¤ç›¸å…³ç›®å½•
- æ”¯æŒå¢é‡æœç´¢

## ğŸ“… æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | æ—¶é—´ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| é˜¶æ®µä¸€ | ä»£ç åº“æœç´¢æ¨¡å— | 2-3 å¤© | P0 |
| é˜¶æ®µä¸€ | æ¥å£è¯†åˆ«æ¨¡å— | 2-3 å¤© | P0 |
| é˜¶æ®µäºŒ | æµ‹è¯•éœ€æ±‚åˆ†ææ¨¡å— | 2-3 å¤© | P0 |
| é˜¶æ®µäºŒ | æµ‹è¯•éœ€æ±‚åˆ†æå‘½ä»¤ | 1-2 å¤© | P0 |
| é˜¶æ®µä¸‰ | æµ‹è¯•å‚æ•°ç”Ÿæˆæ¨¡å— | 2-3 å¤© | P1 |
| é˜¶æ®µä¸‰ | æ¥å£æµ‹è¯•æ‰§è¡Œæ¨¡å— | 2-3 å¤© | P1 |
| é˜¶æ®µä¸‰ | æ¥å£æµ‹è¯•å‘½ä»¤ | 1-2 å¤© | P1 |
| é˜¶æ®µå›› | å¢å¼ºåŠŸèƒ½ | 2-3 å¤© | P2 |

**æ€»è®¡**ï¼š14-22 å¤©ï¼ˆçº¦ 3-4 å‘¨ï¼‰

## âœ… éªŒæ”¶æ ‡å‡†

### MVP éªŒæ”¶æ ‡å‡†

- âœ… èƒ½å¤Ÿè¯†åˆ« PR ä¿®æ”¹çš„æ¥å£
- âœ… èƒ½å¤Ÿæœç´¢ä»£ç åº“æ‰¾åˆ°è°ƒç”¨ç‚¹
- âœ… èƒ½å¤Ÿç”Ÿæˆæµ‹è¯•éœ€æ±‚æ–‡æ¡£
- âœ… èƒ½å¤Ÿæ‰§è¡ŒåŸºç¡€æ¥å£æµ‹è¯•
- âœ… èƒ½å¤Ÿç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

### å®Œæ•´åŠŸèƒ½éªŒæ”¶æ ‡å‡†

- âœ… æ”¯æŒå¤šç§æ¡†æ¶çš„æ¥å£è¯†åˆ«
- âœ… æ”¯æŒå¤šç§æœç´¢ç­–ç•¥
- âœ… æ”¯æŒå¤æ‚ç±»å‹çš„æµ‹è¯•å‚æ•°ç”Ÿæˆ
- âœ… æ”¯æŒå“åº”éªŒè¯å¢å¼º
- âœ… æ”¯æŒ CI/CD é›†æˆ

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [ä»£ç åº“è®¿é—®ç­–ç•¥](./CODEBASE_ACCESS_STRATEGY.md)
- [PR æµ‹è¯•éœ€æ±‚åˆ†æ](./PR_TEST_ANALYSIS_REQUIREMENTS.md)
- [PR æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•](./PR_API_TEST_REQUIREMENTS.md)
- [PR æµ‹è¯•åŠŸèƒ½æ€»è§ˆ](./PR_TEST_OVERVIEW.md)

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**ï¼šé˜¶æ®µä¸€ - ä»£ç åº“æœç´¢æ¨¡å—
2. **å¹¶è¡Œè¿›è¡Œ**ï¼šæ¥å£è¯†åˆ«æ¨¡å—ï¼ˆå¯ä»¥å¹¶è¡Œå¼€å‘ï¼‰
3. **å®Œæˆå**ï¼šé˜¶æ®µäºŒ - æµ‹è¯•éœ€æ±‚åˆ†æ
4. **æœ€å**ï¼šé˜¶æ®µä¸‰ - æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**æœ€åæ›´æ–°**ï¼š2024
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ

