# HTTP è¯·æ±‚è®°å½•æ–¹æ¡ˆåˆ†æ

## ğŸ“‹ éœ€æ±‚åˆ†æ

**æ ¸å¿ƒéœ€æ±‚**ï¼šä»ç»ˆç«¯è·å–å’ŒæŸ¥çœ‹é€šè¿‡ `workflow` å‘½ä»¤å‘é€çš„ HTTP è¯·æ±‚è®°å½•ã€‚

**å…³é”®çº¦æŸ**ï¼š
- éœ€è¦ä»ç»ˆç«¯è®¿é—®ï¼ˆå‘½ä»¤è¡Œå·¥å…·ï¼‰
- éœ€è¦è®°å½•è¯·æ±‚å’Œå“åº”
- éœ€è¦æ”¯æŒæœç´¢å’ŒæŸ¥çœ‹
- æœ€å¥½ä¸éœ€è¦å¤–éƒ¨ä¾èµ–ï¼ˆå¦‚ mitmproxyï¼‰

## ğŸ¯ æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆä¸€ï¼šåœ¨ HttpClient å±‚é¢æ·»åŠ æ‹¦æˆªå™¨ï¼ˆæ¨è â­ï¼‰

**åŸç†**ï¼šåœ¨ `HttpClient` çš„è¯·æ±‚/å“åº”å¤„ç†æµç¨‹ä¸­ï¼Œæ·»åŠ è®°å½•åŠŸèƒ½ã€‚

#### å®ç°æ€è·¯

```
HttpClient::get/post/put/delete/patch
  â†“
build_request() - æ„å»ºè¯·æ±‚
  â†“
[æ‹¦æˆªç‚¹ 1] è®°å½•è¯·æ±‚ï¼ˆURLã€æ–¹æ³•ã€Headersã€Bodyï¼‰
  â†“
client.send() - å‘é€è¯·æ±‚
  â†“
[æ‹¦æˆªç‚¹ 2] è®°å½•å“åº”ï¼ˆçŠ¶æ€ç ã€Headersã€Bodyï¼‰
  â†“
HttpResponse::from_reqwest_response()
```

#### ä¼˜ç‚¹

âœ… **é›¶å¤–éƒ¨ä¾èµ–**ï¼šå®Œå…¨åœ¨é¡¹ç›®å†…éƒ¨å®ç°ï¼Œä¸éœ€è¦å®‰è£…é¢å¤–å·¥å…·
âœ… **å®Œå…¨æ§åˆ¶**ï¼šå¯ä»¥ç²¾ç¡®æ§åˆ¶è®°å½•çš„å†…å®¹å’Œæ ¼å¼
âœ… **æ€§èƒ½å¥½**ï¼šä¸éœ€è¦é¢å¤–çš„ç½‘ç»œè·³è½¬ï¼Œç›´æ¥è®°å½•
âœ… **æ˜“äºé›†æˆ**ï¼šä¸ç°æœ‰ä»£ç ç»“æ„å®Œç¾èåˆ
âœ… **ç±»å‹å®‰å…¨**ï¼šRust ç±»å‹ç³»ç»Ÿä¿è¯æ•°æ®æ­£ç¡®æ€§
âœ… **å¯é…ç½®**ï¼šå¯ä»¥é€šè¿‡é…ç½®å¼€å¯/å…³é—­è®°å½•åŠŸèƒ½

#### ç¼ºç‚¹

âŒ **åªè®°å½•è‡ªå·±çš„è¯·æ±‚**ï¼šåªèƒ½è®°å½•é€šè¿‡ `HttpClient` å‘é€çš„è¯·æ±‚
âŒ **æ— æ³•è®°å½•ç¬¬ä¸‰æ–¹åº“çš„è¯·æ±‚**ï¼šå¦‚æœå…¶ä»–ä»£ç ç›´æ¥ä½¿ç”¨ `reqwest`ï¼Œæ— æ³•è®°å½•
âŒ **éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç **ï¼šéœ€è¦åœ¨ `HttpClient` ä¸­æ·»åŠ è®°å½•é€»è¾‘

#### å®ç°å¤æ‚åº¦

- **å¼€å‘æ—¶é—´**ï¼š1-2 å¤©
- **ä»£ç é‡**ï¼š~300-500 è¡Œ
- **ç»´æŠ¤æˆæœ¬**ï¼šä½ï¼ˆä»£ç ç®€å•ï¼Œé€»è¾‘æ¸…æ™°ï¼‰

#### æŠ€æœ¯è¦ç‚¹

1. **è¯·æ±‚è®°å½•ç»“æ„**ï¼š
   ```rust
   struct RequestRecord {
       timestamp: DateTime<Utc>,
       method: String,
       url: String,
       headers: HashMap<String, String>,
       body: Option<String>,
   }
   ```

2. **å“åº”è®°å½•ç»“æ„**ï¼š
   ```rust
   struct ResponseRecord {
       timestamp: DateTime<Utc>,
       status_code: u16,
       headers: HashMap<String, String>,
       body: Option<String>,
   }
   ```

3. **å­˜å‚¨æ–¹å¼**ï¼š
   - JSON æ–‡ä»¶ï¼ˆ`~/.workflow/http_records/`ï¼‰
   - æŒ‰æ—¶é—´æˆ³å‘½åï¼š`request_20240101_120000.json`
   - æ”¯æŒç´¢å¼•æ–‡ä»¶åŠ é€Ÿæœç´¢

4. **è®°å½•æ—¶æœº**ï¼š
   - è¯·æ±‚ï¼šåœ¨ `build_request()` ä¹‹åï¼Œ`send()` ä¹‹å‰
   - å“åº”ï¼šåœ¨ `send()` ä¹‹åï¼Œè¿”å›ä¹‹å‰

5. **æ€§èƒ½è€ƒè™‘**ï¼š
   - å¼‚æ­¥å†™å…¥ï¼ˆä½¿ç”¨ channel æˆ– spawn threadï¼‰
   - æ‰¹é‡å†™å…¥ï¼ˆå‡å°‘ I/O æ“ä½œï¼‰
   - å¯é€‰çš„å‹ç¼©å­˜å‚¨

---

### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ Rust ä»£ç†åº“ï¼ˆå¦‚ hyper-proxyï¼‰

**åŸç†**ï¼šä½¿ç”¨ç°æœ‰çš„ Rust HTTP ä»£ç†åº“ï¼Œåœ¨åº”ç”¨å’ŒæœåŠ¡å™¨ä¹‹é—´æ’å…¥ä»£ç†å±‚ã€‚

#### å®ç°æ€è·¯

```
åº”ç”¨ä»£ç 
  â†“
HttpClient (é…ç½®ä»£ç†)
  â†“
hyper-proxy (æœ¬åœ°ä»£ç†æœåŠ¡å™¨ï¼Œç›‘å¬ 127.0.0.1:8080)
  â†“
è®°å½•è¯·æ±‚/å“åº”
  â†“
è½¬å‘åˆ°çœŸå®æœåŠ¡å™¨
```

#### ä¼˜ç‚¹

âœ… **å¯ä»¥è®°å½•æ‰€æœ‰è¯·æ±‚**ï¼šåŒ…æ‹¬ç¬¬ä¸‰æ–¹åº“çš„è¯·æ±‚ï¼ˆå¦‚æœé…ç½®äº†ä»£ç†ï¼‰
âœ… **åŠŸèƒ½å®Œæ•´**ï¼šå¯ä»¥ä¿®æ”¹è¯·æ±‚/å“åº”
âœ… **æ ‡å‡†åŒ–**ï¼šä½¿ç”¨æ ‡å‡†çš„ HTTP ä»£ç†åè®®

#### ç¼ºç‚¹

âŒ **éœ€è¦é¢å¤–ä¾èµ–**ï¼šéœ€è¦æ·»åŠ  `hyper`ã€`hyper-proxy` ç­‰ä¾èµ–
âŒ **éœ€è¦å¯åŠ¨ä»£ç†æœåŠ¡**ï¼šéœ€è¦å•ç‹¬è¿è¡Œä»£ç†æœåŠ¡å™¨è¿›ç¨‹
âŒ **æ€§èƒ½å¼€é”€**ï¼šé¢å¤–çš„ç½‘ç»œè·³è½¬
âŒ **é…ç½®å¤æ‚**ï¼šéœ€è¦é…ç½®ä»£ç†ç¯å¢ƒå˜é‡
âŒ **HTTPS å¤„ç†å¤æ‚**ï¼šéœ€è¦å¤„ç†è¯ä¹¦å’Œ SSL è§£å¯†

#### å®ç°å¤æ‚åº¦

- **å¼€å‘æ—¶é—´**ï¼š3-5 å¤©
- **ä»£ç é‡**ï¼š~800-1200 è¡Œ
- **ç»´æŠ¤æˆæœ¬**ï¼šä¸­ï¼ˆéœ€è¦å¤„ç†ä»£ç†åè®®ã€SSL ç­‰å¤æ‚é€»è¾‘ï¼‰

#### æŠ€æœ¯è¦ç‚¹

1. **ä¾èµ–åº“**ï¼š
   - `hyper` - HTTP åº“
   - `hyper-proxy` - ä»£ç†æ”¯æŒ
   - `tokio` - å¼‚æ­¥è¿è¡Œæ—¶ï¼ˆå¦‚æœä½¿ç”¨å¼‚æ­¥ç‰ˆæœ¬ï¼‰

2. **ä»£ç†æœåŠ¡å™¨**ï¼š
   - ç›‘å¬æœ¬åœ°ç«¯å£ï¼ˆå¦‚ 8080ï¼‰
   - å¤„ç† CONNECT æ–¹æ³•ï¼ˆHTTPSï¼‰
   - è®°å½•æ‰€æœ‰ç»è¿‡çš„è¯·æ±‚

3. **é›†æˆæ–¹å¼**ï¼š
   - å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ä»£ç†æœåŠ¡å™¨
   - æˆ–æä¾›å•ç‹¬çš„å‘½ä»¤å¯åŠ¨ä»£ç†

---

### æ–¹æ¡ˆä¸‰ï¼šè‡ªå·±å®ç°ç®€å•çš„ HTTP ä»£ç†æœåŠ¡å™¨

**åŸç†**ï¼šå®Œå…¨è‡ªå·±å®ç°ä¸€ä¸ª HTTP ä»£ç†æœåŠ¡å™¨ï¼Œç±»ä¼¼äºæ–¹æ¡ˆäºŒï¼Œä½†å®Œå…¨è‡ªä¸»æ§åˆ¶ã€‚

#### å®ç°æ€è·¯

```
åº”ç”¨ä»£ç 
  â†“
HttpClient (é…ç½®ä»£ç†)
  â†“
è‡ªå®šä¹‰ä»£ç†æœåŠ¡å™¨ (ç›‘å¬ 127.0.0.1:8080)
  â†“
è§£æ HTTP è¯·æ±‚
  â†“
è®°å½•è¯·æ±‚/å“åº”
  â†“
è½¬å‘åˆ°çœŸå®æœåŠ¡å™¨
```

#### ä¼˜ç‚¹

âœ… **å®Œå…¨æ§åˆ¶**ï¼šå¯ä»¥è‡ªå®šä¹‰æ‰€æœ‰åŠŸèƒ½
âœ… **è½»é‡çº§**ï¼šåªå®ç°éœ€è¦çš„åŠŸèƒ½ï¼Œä¸éœ€è¦å®Œæ•´ä»£ç†åº“
âœ… **å­¦ä¹ ä»·å€¼**ï¼šæ·±å…¥ç†è§£ HTTP åè®®å’Œä»£ç†æœºåˆ¶

#### ç¼ºç‚¹

âŒ **å¼€å‘å·¥ä½œé‡å¤§**ï¼šéœ€è¦å®ç°å®Œæ•´çš„ HTTP ä»£ç†åè®®
âŒ **å®¹æ˜“å‡ºé”™**ï¼šHTTP åè®®å¤æ‚ï¼Œå®¹æ˜“æœ‰ bug
âŒ **ç»´æŠ¤æˆæœ¬é«˜**ï¼šéœ€è¦å¤„ç†å„ç§è¾¹ç•Œæƒ…å†µ
âŒ **HTTPS æ”¯æŒå¤æ‚**ï¼šéœ€è¦å®ç° SSL éš§é“å’Œè¯ä¹¦å¤„ç†
âŒ **æ€§èƒ½è€ƒè™‘**ï¼šéœ€è¦ä¼˜åŒ–è§£æå’Œè½¬å‘æ€§èƒ½

#### å®ç°å¤æ‚åº¦

- **å¼€å‘æ—¶é—´**ï¼š5-10 å¤©
- **ä»£ç é‡**ï¼š~1500-2500 è¡Œ
- **ç»´æŠ¤æˆæœ¬**ï¼šé«˜ï¼ˆéœ€è¦å¤„ç†å„ç§ HTTP åè®®ç»†èŠ‚ï¼‰

#### æŠ€æœ¯è¦ç‚¹

1. **HTTP åè®®è§£æ**ï¼š
   - è¯·æ±‚è¡Œè§£æ
   - Headers è§£æ
   - Body è§£æ
   - åˆ†å—ä¼ è¾“ç¼–ç å¤„ç†

2. **ä»£ç†åè®®**ï¼š
   - HTTP ä»£ç†ï¼ˆGET/POST ç­‰ï¼‰
   - HTTPS ä»£ç†ï¼ˆCONNECT æ–¹æ³•ï¼‰
   - ä»£ç†è®¤è¯ï¼ˆå¦‚æœéœ€è¦ï¼‰

3. **ç½‘ç»œç¼–ç¨‹**ï¼š
   - TCP ç›‘å¬
   - è¿æ¥ç®¡ç†
   - å¼‚æ­¥ I/Oï¼ˆæ¨èä½¿ç”¨ `tokio`ï¼‰

---

### æ–¹æ¡ˆå››ï¼šä½¿ç”¨ reqwest çš„ä¸­é—´ä»¶åŠŸèƒ½ï¼ˆå¦‚æœæ”¯æŒï¼‰

**åŸç†**ï¼šå¦‚æœ `reqwest` æ”¯æŒä¸­é—´ä»¶æˆ–æ‹¦æˆªå™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚/å“åº”å¤„ç†é“¾ä¸­æ’å…¥è®°å½•é€»è¾‘ã€‚

#### ç°çŠ¶åˆ†æ

**reqwest 0.11 (blocking)**ï¼š
- âŒ ä¸æ”¯æŒä¸­é—´ä»¶
- âŒ ä¸æ”¯æŒæ‹¦æˆªå™¨
- âœ… æ”¯æŒè‡ªå®šä¹‰ `Client` å’Œ `RequestBuilder`

**reqwest 0.11 (async)**ï¼š
- âŒ ä¸æ”¯æŒä¸­é—´ä»¶ï¼ˆéœ€è¦ `reqwest-middleware` crateï¼‰
- âœ… å¯ä»¥é€šè¿‡ `tower` ç­‰åº“å®ç°ä¸­é—´ä»¶

#### ç»“è®º

ç”±äºé¡¹ç›®ä½¿ç”¨çš„æ˜¯ `reqwest::blocking`ï¼Œ**æ— æ³•ä½¿ç”¨ä¸­é—´ä»¶æ–¹æ¡ˆ**ã€‚

å¦‚æœåˆ‡æ¢åˆ°å¼‚æ­¥ç‰ˆæœ¬ï¼Œå¯ä»¥è€ƒè™‘ï¼š
- `reqwest-middleware` - reqwest ä¸­é—´ä»¶æ”¯æŒ
- `tower` - ä¸­é—´ä»¶æ¡†æ¶

ä½†åˆ‡æ¢æˆæœ¬è¾ƒé«˜ï¼Œéœ€è¦é‡æ„å¤§é‡ä»£ç ã€‚

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”æ€»ç»“

| æ–¹æ¡ˆ | å¼€å‘æ—¶é—´ | ä»£ç é‡ | ç»´æŠ¤æˆæœ¬ | æ€§èƒ½ | åŠŸèƒ½å®Œæ•´æ€§ | æ¨èåº¦ |
|------|---------|--------|---------|------|-----------|--------|
| **æ–¹æ¡ˆä¸€ï¼šHttpClient æ‹¦æˆªå™¨** | 1-2 å¤© | ~300-500 è¡Œ | ä½ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ |
| **æ–¹æ¡ˆäºŒï¼šRust ä»£ç†åº“** | 3-5 å¤© | ~800-1200 è¡Œ | ä¸­ | â­â­â­ | â­â­â­â­â­ | â­â­â­ |
| **æ–¹æ¡ˆä¸‰ï¼šè‡ªå®ç°ä»£ç†** | 5-10 å¤© | ~1500-2500 è¡Œ | é«˜ | â­â­â­ | â­â­â­â­â­ | â­â­ |
| **æ–¹æ¡ˆå››ï¼šä¸­é—´ä»¶** | N/A | N/A | N/A | N/A | N/A | âŒ |

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### é¦–é€‰ï¼šæ–¹æ¡ˆä¸€ï¼ˆHttpClient æ‹¦æˆªå™¨ï¼‰

**ç†ç”±**ï¼š
1. âœ… **æœ€ç®€å•é«˜æ•ˆ**ï¼šå¼€å‘æ—¶é—´çŸ­ï¼Œä»£ç é‡å°‘
2. âœ… **å®Œå…¨æ»¡è¶³éœ€æ±‚**ï¼šå¯ä»¥è®°å½•æ‰€æœ‰é€šè¿‡ `HttpClient` çš„è¯·æ±‚
3. âœ… **é›¶å¤–éƒ¨ä¾èµ–**ï¼šä¸éœ€è¦å®‰è£…é¢å¤–å·¥å…·
4. âœ… **æ€§èƒ½æœ€ä¼˜**ï¼šæ²¡æœ‰é¢å¤–çš„ç½‘ç»œè·³è½¬
5. âœ… **æ˜“äºç»´æŠ¤**ï¼šä»£ç ç®€å•æ¸…æ™°

**é€‚ç”¨åœºæ™¯**ï¼š
- ä¸»è¦è®°å½• `workflow` å‘½ä»¤å‘é€çš„è¯·æ±‚
- ä¸éœ€è¦è®°å½•ç¬¬ä¸‰æ–¹åº“çš„è¯·æ±‚
- å¸Œæœ›ç®€å•å¿«é€Ÿçš„å®ç°

### å¤‡é€‰ï¼šæ–¹æ¡ˆäºŒï¼ˆRust ä»£ç†åº“ï¼‰

**ç†ç”±**ï¼š
1. âœ… **åŠŸèƒ½å®Œæ•´**ï¼šå¯ä»¥è®°å½•æ‰€æœ‰ HTTP è¯·æ±‚ï¼ˆåŒ…æ‹¬ç¬¬ä¸‰æ–¹åº“ï¼‰
2. âœ… **æ ‡å‡†åŒ–**ï¼šä½¿ç”¨æ ‡å‡†ä»£ç†åè®®
3. âœ… **å¯æ‰©å±•**ï¼šå¯ä»¥æ·»åŠ æ›´å¤šåŠŸèƒ½ï¼ˆä¿®æ”¹è¯·æ±‚ã€é‡æ”¾ç­‰ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- éœ€è¦è®°å½•æ‰€æœ‰ HTTP è¯·æ±‚ï¼ˆåŒ…æ‹¬ç¬¬ä¸‰æ–¹åº“ï¼‰
- éœ€è¦ä¿®æ”¹è¯·æ±‚/å“åº”
- éœ€è¦é‡æ”¾è¯·æ±‚ç­‰åŠŸèƒ½

### ä¸æ¨èï¼šæ–¹æ¡ˆä¸‰ï¼ˆè‡ªå®ç°ä»£ç†ï¼‰

**ç†ç”±**ï¼š
1. âŒ **å¼€å‘æˆæœ¬é«˜**ï¼šéœ€è¦å®ç°å®Œæ•´çš„ HTTP ä»£ç†åè®®
2. âŒ **ç»´æŠ¤æˆæœ¬é«˜**ï¼šéœ€è¦å¤„ç†å„ç§è¾¹ç•Œæƒ…å†µ
3. âŒ **å®¹æ˜“å‡ºé”™**ï¼šHTTP åè®®å¤æ‚ï¼Œå®¹æ˜“æœ‰ bug
4. âŒ **æ€§ä»·æ¯”ä½**ï¼šåŠŸèƒ½ä¸æ–¹æ¡ˆäºŒç±»ä¼¼ï¼Œä½†å¼€å‘æˆæœ¬æ›´é«˜

---

## ğŸ”§ æ–¹æ¡ˆä¸€è¯¦ç»†è®¾è®¡

### æ¶æ„è®¾è®¡

```
src/lib/base/http/
â”œâ”€â”€ client.rs          # HttpClientï¼ˆæ·»åŠ è®°å½•åŠŸèƒ½ï¼‰
â”œâ”€â”€ recorder.rs        # è¯·æ±‚è®°å½•å™¨ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ RequestRecorder
â”‚   â”œâ”€â”€ RequestRecord
â”‚   â””â”€â”€ ResponseRecord
â””â”€â”€ records/           # è®°å½•ç®¡ç†ï¼ˆæ–°å¢ï¼‰
    â”œâ”€â”€ mod.rs
    â”œâ”€â”€ storage.rs     # å­˜å‚¨ç®¡ç†
    â”œâ”€â”€ search.rs      # æœç´¢åŠŸèƒ½
    â””â”€â”€ query.rs       # æŸ¥è¯¢æ¥å£
```

### æ•°æ®æµ

```
ç”¨æˆ·ä»£ç 
  â†“
HttpClient::get/post/...
  â†“
RequestRecorder::record_request()  # è®°å½•è¯·æ±‚
  â†“
reqwest::Client::send()
  â†“
RequestRecorder::record_response()  # è®°å½•å“åº”
  â†“
è¿”å› HttpResponse
```

### æ ¸å¿ƒç»„ä»¶

#### 1. RequestRecorder

```rust
pub struct RequestRecorder {
    enabled: bool,
    storage: RecordStorage,
}

impl RequestRecorder {
    pub fn record_request(&self, req: &RequestInfo) -> Result<()>;
    pub fn record_response(&self, resp: &ResponseInfo) -> Result<()>;
    pub fn search(&self, query: &str) -> Result<Vec<RequestRecord>>;
}
```

#### 2. RecordStorage

```rust
pub struct RecordStorage {
    base_dir: PathBuf,
}

impl RecordStorage {
    pub fn save_request(&self, record: &RequestRecord) -> Result<()>;
    pub fn save_response(&self, record: &ResponseRecord) -> Result<()>;
    pub fn load_requests(&self) -> Result<Vec<RequestRecord>>;
    pub fn search(&self, query: &str) -> Result<Vec<RequestRecord>>;
}
```

#### 3. é›†æˆåˆ° HttpClient

```rust
impl HttpClient {
    fn new() -> Result<Self> {
        let client = Client::builder().build()?;
        let recorder = RequestRecorder::new()?;  // åˆå§‹åŒ–è®°å½•å™¨
        Ok(Self { client, recorder })
    }

    pub fn get<Q>(&self, url: &str, config: RequestConfig<Value, Q>) -> Result<HttpResponse> {
        // è®°å½•è¯·æ±‚
        self.recorder.record_request(&RequestInfo {
            method: "GET",
            url,
            headers: config.headers,
            body: None,
        })?;

        // å‘é€è¯·æ±‚
        let response = self.client.get(url).send()?;

        // è®°å½•å“åº”
        let status = response.status();
        let body = response.text()?;
        self.recorder.record_response(&ResponseInfo {
            status_code: status.as_u16(),
            headers: response.headers().clone(),
            body: Some(body),
        })?;

        // è¿”å›å“åº”
        HttpResponse::from_reqwest_response(response)
    }
}
```

### é…ç½®é¡¹

```toml
[http_recorder]
# æ˜¯å¦å¯ç”¨è¯·æ±‚è®°å½•
enabled = true

# è®°å½•å­˜å‚¨ç›®å½•
record_dir = "~/.workflow/http_records"

# æœ€å¤§è®°å½•æ•°ï¼ˆ0 è¡¨ç¤ºä¸é™åˆ¶ï¼‰
max_records = 1000

# è®°å½•ä¿ç•™å¤©æ•°ï¼ˆ0 è¡¨ç¤ºæ°¸ä¹…ä¿ç•™ï¼‰
retention_days = 30

# æ˜¯å¦è®°å½•è¯·æ±‚ä½“
record_request_body = true

# æ˜¯å¦è®°å½•å“åº”ä½“
record_response_body = true

# æœ€å¤§è¯·æ±‚ä½“å¤§å°ï¼ˆå­—èŠ‚ï¼Œè¶…è¿‡ä¸è®°å½•ï¼‰
max_request_body_size = 1048576  # 1MB

# æœ€å¤§å“åº”ä½“å¤§å°ï¼ˆå­—èŠ‚ï¼Œè¶…è¿‡ä¸è®°å½•ï¼‰
max_response_body_size = 10485760  # 10MB
```

### å‘½ä»¤è¡Œå·¥å…·

```bash
# åˆ—å‡ºæ‰€æœ‰è¯·æ±‚
workflow http-records list

# æœç´¢è¯·æ±‚
workflow http-records search "api.github.com"

# æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…
workflow http-records show <record_id>

# æ¸…ç†æ—§è®°å½•
workflow http-records clean [--days 30]

# å¯¼å‡ºè®°å½•
workflow http-records export [--format json|har]
```

---

## ğŸš€ å®æ–½å»ºè®®

### é˜¶æ®µä¸€ï¼šMVPï¼ˆæœ€å°å¯è¡Œäº§å“ï¼‰

1. **å®ç°åŸºç¡€è®°å½•åŠŸèƒ½**
   - åœ¨ `HttpClient` ä¸­æ·»åŠ è¯·æ±‚/å“åº”è®°å½•
   - ä¿å­˜ä¸º JSON æ–‡ä»¶
   - æ”¯æŒåˆ—å‡ºå’ŒæŸ¥çœ‹è®°å½•

2. **æ—¶é—´ä¼°ç®—**ï¼š1-2 å¤©

### é˜¶æ®µäºŒï¼šå¢å¼ºåŠŸèƒ½

1. **æœç´¢åŠŸèƒ½**
   - æŒ‰ URLã€æ–¹æ³•ã€çŠ¶æ€ç æœç´¢
   - æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼

2. **æ€§èƒ½ä¼˜åŒ–**
   - å¼‚æ­¥å†™å…¥
   - ç´¢å¼•æ–‡ä»¶åŠ é€Ÿæœç´¢

3. **æ—¶é—´ä¼°ç®—**ï¼š1-2 å¤©

### é˜¶æ®µä¸‰ï¼šé«˜çº§åŠŸèƒ½

1. **å¯¼å‡ºåŠŸèƒ½**
   - å¯¼å‡ºä¸º HAR æ ¼å¼
   - å¯¼å‡ºä¸º curl å‘½ä»¤

2. **é‡æ”¾åŠŸèƒ½**
   - é‡æ”¾è¯·æ±‚
   - ä¿®æ”¹åé‡æ”¾

3. **æ—¶é—´ä¼°ç®—**ï¼š2-3 å¤©

---

## âœ… æ€»ç»“

**æ¨èæ–¹æ¡ˆ**ï¼š**æ–¹æ¡ˆä¸€ï¼ˆHttpClient æ‹¦æˆªå™¨ï¼‰**

**ç†ç”±**ï¼š
- âœ… æœ€ç®€å•é«˜æ•ˆ
- âœ… å®Œå…¨æ»¡è¶³éœ€æ±‚
- âœ… é›¶å¤–éƒ¨ä¾èµ–
- âœ… æ€§èƒ½æœ€ä¼˜
- âœ… æ˜“äºç»´æŠ¤

**å®æ–½æ­¥éª¤**ï¼š
1. åˆ›å»º `RequestRecorder` æ¨¡å—
2. åœ¨ `HttpClient` ä¸­é›†æˆè®°å½•åŠŸèƒ½
3. å®ç°è®°å½•å­˜å‚¨å’ŒæŸ¥è¯¢åŠŸèƒ½
4. æ·»åŠ å‘½ä»¤è¡Œå·¥å…·

**é¢„è®¡æ—¶é—´**ï¼š2-4 å¤©ï¼ˆåŒ…æ‹¬æµ‹è¯•å’Œæ–‡æ¡£ï¼‰


