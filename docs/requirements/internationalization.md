# 国际化支持待办事项

> 本文档列出国际化（i18n）支持相关的待办功能，包括多语言支持、时区和日期格式处理、以及国际化相关的代码规范和最佳实践。

---

## 📋 目录

- [概述](#-概述)
- [待实现功能](#-待实现功能)
- [实施计划](#-实施计划)
- [优先级](#-优先级)
- [实现建议](#-实现建议)
- [相关文档](#-相关文档)

---

## 📋 概述

本文档列出国际化（i18n）支持相关的待办功能，包括多语言支持、时区和日期格式处理、以及国际化相关的代码规范和最佳实践。

### 当前状态

- **状态**: ⏳ 待实施
- **实现度**: 0%
- **优先级**: 低（当前项目可能不需要）
- **分类**: 国际化支持模块

### 目标

为项目添加国际化支持，提供：
- 多语言支持（文本外部化、资源文件组织、语言切换机制）
- 时区和日期格式处理（时区处理、日期格式标准化、本地化显示）
- 国际化相关的代码规范和最佳实践

### 已完成

- ❌ 暂无已完成项

### 待实现

- ⏳ 多语言支持规则（文本外部化、资源文件组织、语言切换机制）
- ⏳ 时区和日期格式处理规则（时区处理、日期格式标准化、本地化显示）
- ⏳ 国际化相关的代码规范和最佳实践
- ⏳ Cursor Rules 国际化规则补充

---

## ❌ 待实现功能

### 1. 多语言支持规则

**当前状态**：完全缺失

**需要实现的功能**：

#### 1.1 文本外部化要求

- [ ] 定义文本外部化规范（将所有用户可见的文本提取到资源文件）
- [ ] 建立文本提取工具或脚本
- [ ] 定义文本键命名规范（如：`module.feature.message`）
- [ ] 实现文本占位符和参数化支持

**实现建议**：
- 使用 Rust 的 `fluent` 或 `gettext` 等国际化库
- 定义统一的文本资源文件格式（如：`locales/{lang}/messages.ftl`）
- 建立文本提取和验证工具

#### 1.2 多语言资源文件组织

- [ ] 定义资源文件目录结构（如：`locales/{lang}/`）
- [ ] 建立资源文件命名规范
- [ ] 实现资源文件加载机制
- [ ] 支持资源文件热重载（开发环境）

**实现建议**：
- 目录结构：`locales/{lang}/messages.ftl`
- 支持的语言：`en`（英文）、`zh-CN`（简体中文）、`zh-TW`（繁体中文）等
- 使用 `fluent-rs` 或类似库进行资源文件管理

#### 1.3 语言切换机制

- [ ] 实现语言检测机制（系统语言、环境变量、配置文件）
- [ ] 实现运行时语言切换功能
- [ ] 实现语言设置持久化（保存到配置文件）
- [ ] 提供命令行参数支持（如：`--lang en`）

**实现建议**：
- 优先级：命令行参数 > 配置文件 > 环境变量 > 系统语言
- 配置文件路径：`~/.workflow/config/workflow.toml`
- 支持的语言代码：ISO 639-1（如：`en`、`zh`）

---

### 2. 时区和日期格式处理

**当前状态**：完全缺失

**需要实现的功能**：

#### 2.1 时区处理规则

- [ ] 定义时区处理规范（统一使用 UTC 存储，显示时转换为本地时区）
- [ ] 实现时区检测机制（系统时区、环境变量、配置文件）
- [ ] 实现时区转换工具函数
- [ ] 处理夏令时（DST）变化

**实现建议**：
- 使用 `chrono-tz` 库进行时区处理
- 内部统一使用 UTC 时间存储
- 显示时根据用户配置或系统时区转换

#### 2.2 日期格式标准化

- [ ] 定义日期格式规范（ISO 8601 标准）
- [ ] 实现日期格式化工具函数
- [ ] 支持多种日期格式（完整日期、相对时间、自定义格式）
- [ ] 实现日期解析工具函数

**实现建议**：
- 存储格式：ISO 8601（如：`2025-12-23T10:30:00Z`）
- 显示格式：根据语言和地区自动选择（如：`2025-12-23`、`23/12/2025`）
- 使用 `chrono` 库进行日期处理

#### 2.3 本地化日期显示

- [ ] 实现日期本地化显示（根据语言和地区格式化）
- [ ] 实现相对时间显示（如：`2 hours ago`、`2小时前`）
- [ ] 实现日期范围显示（如：`Dec 23 - Dec 25`、`12月23日 - 12月25日`）
- [ ] 支持自定义日期格式

**实现建议**：
- 使用 `fluent` 或类似库进行日期本地化
- 相对时间使用 `humantime` 或 `timeago` 库
- 支持用户自定义日期格式

---

### 3. 国际化相关的代码规范和最佳实践

**当前状态**：完全缺失

**需要实现的功能**：

#### 3.1 Cursor Rules 国际化规则补充

- [ ] 在 `.cursorrules` 中添加国际化规则
- [ ] 定义文本外部化要求
- [ ] 定义多语言资源文件组织规范
- [ ] 定义时区和日期格式处理规范
- [ ] 定义国际化相关的代码审查检查清单

**实现建议**：
- 参考 `analysis/cursorrules-enhancement-analysis.md` 中的建议
- 在 `.cursorrules` 中添加国际化相关规则章节
- 同步更新 `docs/cursorrules.md` 中文版本

#### 3.2 代码规范

- [ ] 禁止硬编码文本（所有用户可见文本必须外部化）
- [ ] 定义文本键命名规范
- [ ] 定义日期时间处理规范
- [ ] 定义时区处理规范
- [ ] 添加国际化相关的 Clippy 检查规则

**实现建议**：
- 使用 Clippy 的 `clippy::unwrap_used` 等规则
- 添加自定义 lint 规则检查硬编码文本
- 在代码审查检查清单中添加国际化相关项

#### 3.3 测试规范

- [ ] 定义多语言测试规范（测试不同语言下的功能）
- [ ] 定义时区测试规范（测试不同时区下的日期显示）
- [ ] 实现测试工具函数（模拟不同语言和时区）
- [ ] 添加国际化相关的测试用例

**实现建议**：
- 为每种支持的语言添加测试用例
- 测试时区转换的准确性
- 测试日期格式化的正确性

---

## 📋 实施计划

### 阶段 1：基础架构搭建

- [ ] **任务1.1**：选择国际化库（`fluent-rs` 或 `gettext`）
  - 评估不同库的优缺点
  - 选择最适合项目的库
- [ ] **任务1.2**：定义资源文件目录结构
  - 创建 `locales/` 目录
  - 定义资源文件命名规范
- [ ] **任务1.3**：实现基础资源文件加载机制
  - 实现资源文件加载函数
  - 实现文本查找和替换函数

### 阶段 2：多语言支持实现

- [ ] **任务2.1**：提取现有硬编码文本
  - 扫描代码库中的硬编码文本
  - 提取到资源文件
- [ ] **任务2.2**：实现语言检测和切换机制
  - 实现语言检测函数
  - 实现语言切换函数
  - 实现语言设置持久化
- [ ] **任务2.3**：更新所有用户可见文本
  - 替换所有硬编码文本为资源文件引用
  - 测试多语言显示效果

### 阶段 3：时区和日期格式处理

- [ ] **任务3.1**：实现时区处理机制
  - 集成 `chrono-tz` 库
  - 实现时区检测和转换函数
- [ ] **任务3.2**：实现日期格式化机制
  - 实现日期格式化函数
  - 实现日期解析函数
- [ ] **任务3.3**：更新所有日期时间显示
  - 替换所有日期时间显示为本地化格式
  - 测试不同时区下的显示效果

### 阶段 4：规范和文档

- [ ] **任务4.1**：更新 Cursor Rules
  - 在 `.cursorrules` 中添加国际化规则
  - 同步更新 `docs/cursorrules.md`
- [ ] **任务4.2**：更新开发规范文档
  - 在 `docs/guidelines/development.md` 中添加国际化规范
  - 添加国际化相关的代码审查检查清单
- [ ] **任务4.3**：编写国际化使用指南
  - 创建 `docs/guidelines/internationalization.md`
  - 添加使用示例和最佳实践

---

## 📊 任务统计

| 状态 | 数量 | 说明 |
|-----|------|------|
| ✅ 已完成 | 0 个 | 暂无已完成项 |
| 🚧 进行中 | 0 个 | 暂无进行中项 |
| ⏳ 待实施 | 15+ 个 | 多语言支持、时区处理、日期格式化、规范文档等 |
| **总计** | **15+** | - |

---

## 🎯 优先级

### 高优先级（如果项目需要国际化支持）

1. **多语言支持规则**（文本外部化、资源文件组织、语言切换机制）
2. **时区和日期格式处理规则**（时区处理、日期格式标准化、本地化显示）

### 中优先级

3. **国际化相关的代码规范和最佳实践**
4. **Cursor Rules 国际化规则补充**

### 低优先级（当前项目可能不需要）

- 当前项目为 CLI 工具，主要面向开发者，可能不需要完整的国际化支持
- 如果未来需要国际化支持，可以按照本文档的计划实施

---

## 💡 实现建议

### 技术选型

1. **国际化库**：
   - `fluent-rs`：Mozilla 的 Fluent 国际化系统，功能强大，支持复杂语法
   - `gettext-rs`：传统的 gettext 系统，简单易用
   - 推荐：`fluent-rs`（功能更强大，更适合现代应用）

2. **日期时间库**：
   - `chrono`：Rust 标准日期时间库
   - `chrono-tz`：时区支持扩展
   - 推荐：`chrono` + `chrono-tz`

3. **相对时间库**：
   - `humantime`：简单易用
   - `timeago`：功能丰富
   - 推荐：`humantime`（简单够用）

### 实施建议

1. **渐进式实施**：
   - 先实现基础架构（阶段1）
   - 再逐步替换硬编码文本（阶段2）
   - 最后处理时区和日期格式（阶段3）

2. **向后兼容**：
   - 保持默认语言为英文（或当前语言）
   - 确保未配置语言时仍能正常工作

3. **性能考虑**：
   - 资源文件加载使用懒加载
   - 缓存已加载的资源文件
   - 避免频繁的语言切换

4. **测试策略**：
   - 为每种支持的语言添加测试用例
   - 测试时区转换的准确性
   - 测试日期格式化的正确性

---

## 📚 相关文档

- [`analysis/cursorrules-enhancement-analysis.md`](../../analysis/cursorrules-enhancement-analysis.md) - Cursor Rules 规则增强需求分析（包含国际化规则分析）
- [`.cursorrules`](../../.cursorrules) - Cursor AI 规则文件（英文版本）
- [`docs/cursorrules.md`](../cursorrules.md) - Cursor AI 规则文件（中文版本）
- [`docs/guidelines/development.md`](../guidelines/development.md) - 开发规范文档

---

## ✅ 检查清单

实施本需求时，请确保：

- [ ] 已选择并集成国际化库（`fluent-rs` 或 `gettext-rs`）
- [ ] 已定义资源文件目录结构和命名规范
- [ ] 已实现资源文件加载机制
- [ ] 已提取所有硬编码文本到资源文件
- [ ] 已实现语言检测和切换机制
- [ ] 已集成时区处理库（`chrono-tz`）
- [ ] 已实现日期格式化机制
- [ ] 已更新所有日期时间显示为本地化格式
- [ ] 已在 `.cursorrules` 中添加国际化规则
- [ ] 已更新开发规范文档
- [ ] 已添加国际化相关的测试用例
- [ ] 已编写国际化使用指南

---

**最后更新**: 2025-12-23

