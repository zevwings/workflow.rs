# 版本更新分支跳过 CI 检查方案

## 问题

`bump-version-*` 分支的 PR 只需要更新版本号（Cargo.toml 和 Cargo.lock），这些更改不需要重新运行完整的 CI 检查（lint、测试等），因为：
- 版本号更改不会影响代码逻辑
- 已经通过 CI 的代码在版本更新后仍然有效
- 可以加快版本更新流程

## 解决方案对比

### 方案1：在提交消息中使用 `[skip ci]`（最简单）

**优点**：
- ✅ 实现简单，只需修改提交消息
- ✅ 完全跳过所有 CI 检查
- ✅ 不需要修改工作流文件

**缺点**：
- ❌ 会跳过所有检查，包括可能需要的检查
- ❌ 如果将来需要为版本更新添加特定检查，无法实现

**实现**：
```bash
git commit -m "chore: bump version to ${NEW_VERSION} [skip ci]"
```

### 方案2：修改 CI 工作流，跳过 `bump-version-*` 分支（推荐 ⭐）

**优点**：
- ✅ 精确控制，只跳过特定分支
- ✅ 可以为版本更新添加特定的轻量级检查
- ✅ 不影响其他分支的 CI

**缺点**：
- ⚠️ 需要修改 `ci.yml` 工作流

**实现**：
在 `.github/workflows/ci.yml` 的每个 job 中添加条件：
```yaml
if: |
  !startsWith(github.head_ref, 'bump-version-') ||
  github.event_name != 'pull_request'
```

### 方案3：使用 GitHub API 创建通过的状态检查（最灵活 ⭐⭐）

**优点**：
- ✅ 不需要修改 CI 工作流
- ✅ 可以精确控制哪些检查跳过，哪些保留
- ✅ 可以为版本更新创建特定的检查

**缺点**：
- ⚠️ 需要额外的 API 调用
- ⚠️ 需要 `checks: write` 权限

**实现**：
在创建 PR 后，使用 API 创建通过的状态检查。

### 方案4：组合方案（最佳实践 ⭐⭐⭐）

结合方案1和方案3：
- 提交消息使用 `[skip ci]` 跳过自动 CI
- 使用 API 创建轻量级的版本更新检查

---

## 推荐实施方案

### 方案A：简单快速（方案1）

只需修改提交消息，添加 `[skip ci]`：

```bash
git commit -m "chore: bump version to ${NEW_VERSION} [skip ci]"
```

### 方案B：精确控制（方案2 - 推荐）

修改 `.github/workflows/ci.yml`，为每个 job 添加跳过条件。

### 方案C：完全自动化（方案3）

在创建 PR 后，立即创建通过的状态检查，避免等待 CI。

---

## 实施建议

**对于版本更新 PR，推荐使用方案B（修改 CI 工作流）**，因为：
1. 版本更新确实不需要重新运行所有检查
2. 可以保持 CI 工作流的清晰性
3. 如果将来需要为版本更新添加特定检查，可以轻松添加

**如果希望完全自动化且不修改 CI 工作流，使用方案C（API 创建检查）**。
