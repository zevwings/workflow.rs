# æ—¥å¿—å’Œè°ƒè¯•è§„èŒƒ

> æœ¬æ–‡æ¡£å®šä¹‰äº† Workflow CLI é¡¹ç›®çš„æ—¥å¿—å’Œè°ƒè¯•è§„èŒƒå’Œæœ€ä½³å®è·µï¼Œæ‰€æœ‰è´¡çŒ®è€…éƒ½åº”éµå¾ªè¿™äº›è§„èŒƒã€‚

---

## ğŸ“‹ ç›®å½•

- [æ¦‚è¿°](#-æ¦‚è¿°)
- [æ—¥å¿—ç³»ç»Ÿæ¶æ„](#-æ—¥å¿—ç³»ç»Ÿæ¶æ„)
- [æ—¥å¿—çº§åˆ«ä½¿ç”¨è§„åˆ™](#-æ—¥å¿—çº§åˆ«ä½¿ç”¨è§„åˆ™)
- [æ—¥å¿—é…ç½®](#-æ—¥å¿—é…ç½®)
- [æ•æ„Ÿä¿¡æ¯è¿‡æ»¤è§„åˆ™](#-æ•æ„Ÿä¿¡æ¯è¿‡æ»¤è§„åˆ™)
- [æ—¥å¿—è¾“å‡ºè§„åˆ™](#-æ—¥å¿—è¾“å‡ºè§„åˆ™)
- [æœ€ä½³å®è·µ](#-æœ€ä½³å®è·µ)
- [ç›¸å…³æ–‡æ¡£](#-ç›¸å…³æ–‡æ¡£)

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†æ—¥å¿—å’Œè°ƒè¯•è§„èŒƒï¼ŒåŒ…æ‹¬æ—¥å¿—ç³»ç»Ÿæ¶æ„ã€æ—¥å¿—çº§åˆ«ä½¿ç”¨è§„åˆ™ã€æ•æ„Ÿä¿¡æ¯è¿‡æ»¤è§„åˆ™å’Œæœ€ä½³å®è·µã€‚

### æ ¸å¿ƒåŸåˆ™

- **èŒè´£åˆ†ç¦»**ï¼šCommands å±‚å’Œ Lib å±‚ä½¿ç”¨ä¸åŒçš„æ—¥å¿—ç³»ç»Ÿ
- **æ•æ„Ÿä¿¡æ¯è¿‡æ»¤**ï¼šæ‰€æœ‰æ—¥å¿—è¾“å‡ºå‰å¿…é¡»è¿‡æ»¤æ•æ„Ÿä¿¡æ¯
- **æ—¥å¿—çº§åˆ«**ï¼šæ ¹æ®é‡è¦æ€§é€‰æ‹©åˆé€‚çš„æ—¥å¿—çº§åˆ«

### ä½¿ç”¨åœºæ™¯

- ç¼–å†™æ—¥å¿—ä»£ç æ—¶å‚è€ƒ
- è°ƒè¯•ä»£ç æ—¶ä½¿ç”¨
- ä»£ç å®¡æŸ¥æ—¶æ£€æŸ¥

---

## æ—¥å¿—ç³»ç»Ÿæ¶æ„

é¡¹ç›®é‡‡ç”¨**åˆ†ç¦»çš„æ—¥å¿—ç³»ç»Ÿè®¾è®¡**ï¼Œå®ç°äº†èŒè´£åˆ†ç¦»ï¼š

- **Commands å±‚**ï¼šä½¿ç”¨ `log_*!` å®è¿›è¡Œç”¨æˆ·å‹å¥½çš„æ§åˆ¶å°è¾“å‡ºï¼ˆå¸¦é¢œè‰²ã€Emojiï¼‰
- **Lib å±‚**ï¼šä½¿ç”¨ `trace_*!` å®è¿›è¡Œç»“æ„åŒ–æ—¥å¿—è®°å½•ï¼ˆé»˜è®¤ä¸è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå¯é…ç½®å¯ç”¨ï¼‰

### Commands å±‚æ—¥å¿—

Commands å±‚ä½¿ç”¨ `log_*!` å®ï¼Œç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œç”¨æˆ·å¯è§ï¼š

```rust
use workflow::{log_success, log_error, log_warning, log_info, log_debug};

// æˆåŠŸæ¶ˆæ¯ï¼ˆæ€»æ˜¯è¾“å‡ºï¼‰
log_success!("Operation completed");

// é”™è¯¯æ¶ˆæ¯ï¼ˆä»…åœ¨æ—¥å¿—çº§åˆ« >= ERROR æ—¶è¾“å‡ºï¼‰
log_error!("Operation failed: {}", error_msg);

// è­¦å‘Šæ¶ˆæ¯ï¼ˆä»…åœ¨æ—¥å¿—çº§åˆ« >= WARN æ—¶è¾“å‡ºï¼‰
log_warning!("Retrying operation");

// ä¿¡æ¯æ¶ˆæ¯ï¼ˆä»…åœ¨æ—¥å¿—çº§åˆ« >= INFO æ—¶è¾“å‡ºï¼‰
log_info!("Processing data");

// è°ƒè¯•æ¶ˆæ¯ï¼ˆä»…åœ¨æ—¥å¿—çº§åˆ« >= DEBUG æ—¶è¾“å‡ºï¼‰
log_debug!("Debug information: {}", data);
```

### Lib å±‚æ—¥å¿—

Lib å±‚ä½¿ç”¨ `trace_*!` å®ï¼Œé»˜è®¤è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ï¼Œä¸è¾“å‡ºåˆ°æ§åˆ¶å°ï¼š

```rust
use workflow::{trace_debug, trace_info, trace_warn, trace_error};

// è°ƒè¯•ä¿¡æ¯ï¼ˆè¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ï¼‰
trace_debug!("Processing data: {}", data);

// ä¿¡æ¯æ—¥å¿—ï¼ˆè¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ï¼‰
trace_info!("Operation completed");

// è­¦å‘Šæ—¥å¿—ï¼ˆè¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ï¼‰
trace_warn!("Retrying operation");

// é”™è¯¯æ—¥å¿—ï¼ˆè¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ï¼‰
trace_error!("Operation failed: {}", error);
```

**é‡è¦è§„åˆ™**ï¼š
- âŒ **ç¦æ­¢**åœ¨ Lib å±‚ä½¿ç”¨ `log_*!` å®ï¼ˆä¼šç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå½±å“ç”¨æˆ·ä½“éªŒï¼‰
- âœ… **å¿…é¡»**åœ¨ Lib å±‚ä½¿ç”¨ `trace_*!` å®ï¼ˆè¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ï¼‰

---

## æ—¥å¿—çº§åˆ«ä½¿ç”¨è§„åˆ™

### Commands å±‚æ—¥å¿—çº§åˆ«

- **`log_success!`**ï¼šæˆåŠŸæ¶ˆæ¯ï¼Œæ€»æ˜¯è¾“å‡ºï¼Œä¸å—æ—¥å¿—çº§åˆ«é™åˆ¶
- **`log_error!`**ï¼šç³»ç»Ÿé”™è¯¯ï¼Œéœ€è¦ç«‹å³å…³æ³¨ï¼Œä»…åœ¨æ—¥å¿—çº§åˆ« >= ERROR æ—¶è¾“å‡º
- **`log_warning!`**ï¼šè­¦å‘Šä¿¡æ¯ï¼Œå¯èƒ½çš„é—®é¢˜ï¼Œä»…åœ¨æ—¥å¿—çº§åˆ« >= WARN æ—¶è¾“å‡º
- **`log_info!`**ï¼šé‡è¦æ“ä½œä¿¡æ¯ï¼ˆå¦‚å‘½ä»¤æ‰§è¡Œã€é…ç½®åŠ è½½ï¼‰ï¼Œä»…åœ¨æ—¥å¿—çº§åˆ« >= INFO æ—¶è¾“å‡º
- **`log_debug!`**ï¼šè°ƒè¯•ä¿¡æ¯ï¼Œä»…åœ¨å¼€å‘æ—¶ä½¿ç”¨ï¼Œä»…åœ¨æ—¥å¿—çº§åˆ« >= DEBUG æ—¶è¾“å‡º
- **`log_message!`**ï¼šè¯´æ˜ä¿¡æ¯ï¼Œæ€»æ˜¯è¾“å‡ºï¼Œä¸å—æ—¥å¿—çº§åˆ«é™åˆ¶ï¼ˆç”¨äº setup/check ç­‰å‘½ä»¤ï¼‰

### Lib å±‚æ—¥å¿—çº§åˆ«

- **`trace_error!`**ï¼šç³»ç»Ÿé”™è¯¯ï¼Œéœ€è¦ç«‹å³å…³æ³¨
- **`trace_warn!`**ï¼šè­¦å‘Šä¿¡æ¯ï¼Œå¯èƒ½çš„é—®é¢˜
- **`trace_info!`**ï¼šé‡è¦æ“ä½œä¿¡æ¯ï¼ˆå¦‚ API è°ƒç”¨ã€æ–‡ä»¶æ“ä½œï¼‰
- **`trace_debug!`**ï¼šè°ƒè¯•ä¿¡æ¯ï¼Œä»…åœ¨å¼€å‘æ—¶ä½¿ç”¨
- **`trace!`**ï¼šè¯¦ç»†è·Ÿè¸ªä¿¡æ¯ï¼Œä»…åœ¨æ·±åº¦è°ƒè¯•æ—¶ä½¿ç”¨

---

## æ—¥å¿—é…ç½®

### æ—¥å¿—çº§åˆ«é…ç½®

æ—¥å¿—çº§åˆ«ä»é…ç½®æ–‡ä»¶ `~/.workflow/config/workflow.toml` ä¸­çš„ `log.level` å­—æ®µè¯»å–ï¼š

```toml
[log]
level = "info"  # å¯é€‰å€¼ï¼šoff, error, warn, info, debug, trace
enable_trace_console = false  # æ˜¯å¦åŒæ—¶è¾“å‡º trace_*! æ—¥å¿—åˆ°æ§åˆ¶å°
```

### æ—¥å¿—æ–‡ä»¶ä½ç½®

Lib å±‚çš„ `trace_*!` æ—¥å¿—é»˜è®¤è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ï¼š
- è·¯å¾„ï¼š`~/.workflow/logs/tracing/workflow-YYYY-MM-DD.log`
- æ ¼å¼ï¼šæŒ‰æ—¥æœŸåˆ†å‰²ï¼Œæ¯å¤©ä¸€ä¸ªæ–‡ä»¶
- å­˜å‚¨ï¼šå¼ºåˆ¶æœ¬åœ°å­˜å‚¨ï¼ˆä¸ä½¿ç”¨ iCloud åŒæ­¥ï¼‰

### åˆå§‹åŒ–

åœ¨ `main()` å‡½æ•°ä¸­åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿï¼š

```rust
use workflow::{LogLevel, Tracer};

fn main() -> Result<()> {
    // å®‰è£… color-eyreï¼ˆæœ€æ—©è°ƒç”¨ï¼‰
    color_eyre::install()?;

    // åˆå§‹åŒ–æ—¥å¿—çº§åˆ«ï¼ˆä»é…ç½®æ–‡ä»¶è¯»å–ï¼‰
    let config_level = Settings::get()
        .log
        .level
        .as_ref()
        .and_then(|s| s.parse::<LogLevel>().ok());
    LogLevel::init(config_level);

    // åˆå§‹åŒ– tracingï¼ˆä»é…ç½®æ–‡ä»¶è¯»å–ï¼‰
    Tracer::init();

    // ... å…¶ä»–åˆå§‹åŒ–ä»£ç 
}
```

---

## æ•æ„Ÿä¿¡æ¯è¿‡æ»¤è§„åˆ™

**é‡è¦**ï¼šæ‰€æœ‰æ—¥å¿—è¾“å‡ºå‰å¿…é¡»è¿‡æ»¤æ•æ„Ÿä¿¡æ¯ã€‚

### ä½¿ç”¨ `mask_sensitive_value` å‡½æ•°

```rust
use crate::mask_sensitive_value;

// âŒ ä¸å®‰å…¨
trace_info!("API token: {}", token);

// âœ… å®‰å…¨
trace_info!("API token: {}", mask_sensitive_value(token));
```

### ä½¿ç”¨ `Sensitive` trait

```rust
use crate::base::util::string::Sensitive;

// âŒ ä¸å®‰å…¨
log_info!("API token: {}", token);

// âœ… å®‰å…¨
log_info!("API token: {}", token.mask());
```

### æ•æ„Ÿä¿¡æ¯ç±»å‹

ä»¥ä¸‹ä¿¡æ¯å¿…é¡»è¿‡æ»¤ï¼š
- API Tokenï¼ˆGitHubã€Jiraã€LLM ç­‰ï¼‰
- å¯†ç å’Œå¯†é’¥
- ç”¨æˆ·è¾“å…¥ä¸­çš„æ•æ„Ÿä¿¡æ¯
- é…ç½®æ–‡ä»¶è·¯å¾„ä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚åŒ…å«ç”¨æˆ·åçš„è·¯å¾„ï¼‰

---

## æ—¥å¿—è¾“å‡ºè§„åˆ™

### Commands å±‚è§„åˆ™

- ä½¿ç”¨ `log_*!` å®ï¼Œç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œç”¨æˆ·å¯è§
- æˆåŠŸæ¶ˆæ¯å’Œè¯´æ˜ä¿¡æ¯æ€»æ˜¯è¾“å‡ºï¼Œä¸å—æ—¥å¿—çº§åˆ«é™åˆ¶
- å…¶ä»–æ¶ˆæ¯æ ¹æ®æ—¥å¿—çº§åˆ«å†³å®šæ˜¯å¦è¾“å‡º
- æ‰€æœ‰æ•æ„Ÿä¿¡æ¯å¿…é¡»è¿‡æ»¤

### Lib å±‚è§„åˆ™

- ä½¿ç”¨ `trace_*!` å®ï¼Œé»˜è®¤è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶
- ä¸è¾“å‡ºåˆ°æ§åˆ¶å°ï¼ˆé™¤éé…ç½® `enable_trace_console = true`ï¼‰
- ç¦æ­¢ä½¿ç”¨ `log_*!` å®ï¼ˆä¼šç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå½±å“ç”¨æˆ·ä½“éªŒï¼‰
- æ‰€æœ‰æ•æ„Ÿä¿¡æ¯å¿…é¡»è¿‡æ»¤

---

## æœ€ä½³å®è·µ

### 1. é€‰æ‹©åˆé€‚çš„æ—¥å¿—çº§åˆ«

```rust
// âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨åˆé€‚çš„æ—¥å¿—çº§åˆ«
trace_info!("API request sent");  // é‡è¦æ“ä½œ
trace_debug!("Request payload: {}", payload);  // è°ƒè¯•ä¿¡æ¯

// âŒ ä¸å¥½çš„åšæ³•ï¼šè¿‡åº¦ä½¿ç”¨ debug çº§åˆ«
trace_debug!("API request sent");  // åº”è¯¥æ˜¯ info çº§åˆ«
```

### 2. æä¾›æœ‰æ„ä¹‰çš„æ—¥å¿—æ¶ˆæ¯

```rust
// âœ… å¥½çš„åšæ³•ï¼šæä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯
trace_info!("Downloading file from {} to {}", url, path);

// âŒ ä¸å¥½çš„åšæ³•ï¼šæ—¥å¿—æ¶ˆæ¯ä¸æ¸…æ™°
trace_info!("Downloading");
```

### 3. è¿‡æ»¤æ•æ„Ÿä¿¡æ¯

```rust
// âœ… å¥½çš„åšæ³•ï¼šè¿‡æ»¤æ•æ„Ÿä¿¡æ¯
trace_info!("API token: {}", mask_sensitive_value(token));
trace_info!("User: {}", user.mask());

// âŒ ä¸å¥½çš„åšæ³•ï¼šç›´æ¥è¾“å‡ºæ•æ„Ÿä¿¡æ¯
trace_info!("API token: {}", token);
```

### 4. é¿å…è¿‡åº¦æ—¥å¿—è®°å½•

```rust
// âœ… å¥½çš„åšæ³•ï¼šåªåœ¨å…³é”®ç‚¹è®°å½•æ—¥å¿—
trace_info!("Starting operation");
let result = perform_operation()?;
trace_info!("Operation completed");

// âŒ ä¸å¥½çš„åšæ³•ï¼šè®°å½•è¿‡å¤šç»†èŠ‚
trace_debug!("Step 1");
trace_debug!("Step 2");
trace_debug!("Step 3");
// ... å¤ªå¤šæ—¥å¿—
```

---

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šæ—¥å¿—æœªè¾“å‡º

**ç—‡çŠ¶**ï¼šæ—¥å¿—æ¶ˆæ¯æœªæ˜¾ç¤º

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. æ£€æŸ¥æ—¥å¿—çº§åˆ«é…ç½®
2. ç¡®è®¤æ—¥å¿—çº§åˆ«æ˜¯å¦å…è®¸è¯¥æ¶ˆæ¯è¾“å‡º
3. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ä½ç½®å’Œæƒé™

### é—®é¢˜ 2ï¼šæ•æ„Ÿä¿¡æ¯æ³„éœ²

**ç—‡çŠ¶**ï¼šæ—¥å¿—ä¸­åŒ…å«æ•æ„Ÿä¿¡æ¯

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. ä½¿ç”¨ `mask_sensitive_value()` æˆ– `Sensitive` trait è¿‡æ»¤æ•æ„Ÿä¿¡æ¯
2. æ£€æŸ¥æ‰€æœ‰æ—¥å¿—è¾“å‡ºç‚¹
3. å®šæœŸå®¡æŸ¥æ—¥å¿—æ–‡ä»¶

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

### å¼€å‘è§„èŒƒ

- [é”™è¯¯å¤„ç†è§„èŒƒ](../error-handling.md) - é”™è¯¯å¤„ç†è§„èŒƒ

### æ¶æ„æ–‡æ¡£

- [Logger æ¨¡å—æ¶æ„æ–‡æ¡£](../../../architecture/logger.md) - è¯¦ç»†çš„æ—¥å¿—ç³»ç»Ÿæ¶æ„è¯´æ˜

### ä»£ç å®ç°

- `src/lib/base/logger/tracing.rs` - Tracing å°è£…å®ç°
- `src/lib/base/logger/console.rs` - æ§åˆ¶å°æ—¥å¿—è¾“å‡º
- `src/lib/base/logger/log_level.rs` - æ—¥å¿—çº§åˆ«ç®¡ç†

---

## âœ… æ£€æŸ¥æ¸…å•

ä½¿ç”¨æœ¬è§„èŒƒæ—¶ï¼Œè¯·ç¡®ä¿ï¼š

- [ ] Commands å±‚ä½¿ç”¨ `log_*!` å®
- [ ] Lib å±‚ä½¿ç”¨ `trace_*!` å®
- [ ] é€‰æ‹©åˆé€‚çš„æ—¥å¿—çº§åˆ«
- [ ] æ‰€æœ‰æ•æ„Ÿä¿¡æ¯å·²è¿‡æ»¤
- [ ] æ—¥å¿—æ¶ˆæ¯æ¸…æ™°æœ‰æ„ä¹‰

---

**æœ€åæ›´æ–°**: 2025-12-23

