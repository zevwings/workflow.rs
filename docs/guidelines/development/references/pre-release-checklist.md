# 发布前检查清单

> 本文档定义了 Workflow CLI 项目发布前的检查清单和最佳实践，所有发布前都应完成这些检查。

---

## 📋 目录

- [概述](#-概述)
- [代码质量检查](#-代码质量检查)
- [版本管理检查](#-版本管理检查)
- [文档检查](#-文档检查)
- [测试检查](#-测试检查)
- [构建检查](#-构建检查)
- [检查方法](#-检查方法)
- [相关文档](#-相关文档)

---

## 📋 概述

本文档定义了发布前的检查清单，确保发布版本的质量和完整性。

### 核心原则

- **全面检查**：发布前必须完成所有检查项
- **文档同步**：确保文档与代码实现一致
- **质量保障**：确保代码质量和测试覆盖

### 使用场景

- 发布新版本前使用
- 代码审查时参考
- 质量保障时使用

---

## 代码质量检查

- [ ] 代码已格式化（`cargo fmt`）
- [ ] 通过 Clippy 检查（`cargo clippy -- -D warnings`）
- [ ] 所有测试通过（`cargo test`）
- [ ] 没有引入新的警告
- [ ] 代码审查已完成

---

## 版本管理检查

- [ ] `Cargo.toml` 中的版本号已更新
- [ ] `CHANGELOG.md` 已更新，包含本次发布的所有变更
- [ ] 版本号格式符合语义化版本规范（如 `1.6.7`）
- [ ] 变更内容分类正确（Added、Changed、Fixed、Removed 等）

---

## 文档检查

### 架构文档与代码一致性

- [ ] 所有架构文档已与代码实现同步
  - [ ] 使用 [架构文档审查指南](./review-architecture-consistency.md) 进行全面检查
  - [ ] 检查范围：`docs/architecture/` 目录下的所有文档（约 30+ 个文档）
  - [ ] 模块结构与实际代码结构一致
  - [ ] API 接口描述与代码实现一致
  - [ ] 功能描述与实际实现一致
  - [ ] 配置项说明与代码结构一致
  - [ ] 依赖关系与实际代码依赖一致

### README.md 检查

- [ ] README.md 中的命令清单完整
- [ ] 所有命令都有说明和使用示例
- [ ] 版本号与 `Cargo.toml` 一致
- [ ] 所有文档链接有效

### 其他文档检查

- [ ] CHANGELOG.md 已更新
- [ ] 所有文档链接有效
- [ ] 文档索引（`docs/README.md`）已更新（如适用）

---

## 测试检查

- [ ] 所有单元测试通过
- [ ] 所有集成测试通过
- [ ] 补全脚本完整性测试通过（`cargo test --test completeness`）
- [ ] 测试覆盖率满足要求（> 80%，关键业务逻辑 > 90%）

---

## 构建检查

- [ ] 项目可以成功编译（`cargo build --release`）
- [ ] 所有平台构建通过（如适用）
- [ ] 二进制文件大小合理

---

## 检查方法

### 架构文档检查

使用架构文档审查指南进行全面检查：

```bash
# 参考架构文档审查指南
# docs/guidelines/development/references/review-architecture-consistency.md

# 快速检查命令示例：
# 1. 检查模块结构
MODULE=pr
find src/lib/$MODULE -name "*.rs" -type f | grep -v mod.rs | sort

# 2. 统计代码行数
find src/lib/$MODULE -name "*.rs" -type f | xargs wc -l | tail -1

# 3. 提取公共 API
grep -r "pub fn\|pub struct\|pub enum\|pub trait" src/lib/$MODULE/ | head -20
```

### 文档链接检查

```bash
# 检查文档中的链接（手动检查或使用工具）
# 确保所有内部链接指向的文件存在
# 确保所有外部链接可访问（可选）
```

---

## 检查要求

- **必须完成**：发布前必须完成所有架构文档检查
- **检查范围**：`docs/architecture/` 目录下的所有文档（约 30+ 个文档）
- **检查工具**：使用 [架构文档审查指南](./review-architecture-consistency.md) 进行全面检查
- **检查记录**：建议记录检查结果到 `docs/architecture/check-log.md`（如已创建）

---

## 🔍 故障排除

### 问题 1：架构文档不一致

**症状**：架构文档与代码实现不一致

**解决方案**：

1. 使用架构文档审查指南进行全面检查
2. 更新架构文档以反映代码实现
3. 记录检查结果到检查日志

### 问题 2：测试覆盖率不足

**症状**：测试覆盖率低于要求

**解决方案**：

1. 添加缺失的测试用例
2. 重点关注关键业务逻辑的测试覆盖
3. 使用 `cargo tarpaulin` 检查覆盖率

---

## 📚 相关文档

### 检查工作流

- [架构文档审查指南](./review-architecture-consistency.md) - 详细的架构文档检查方法和流程
- [文档审查指南](./review-document-completeness.md) - 完整的文档检查指南
- [深入检查指南](../workflows/review.md) - 综合深入检查流程

### 开发规范

- [代码审查规范](../code-review.md) - 代码审查规范
- [文档规范](./documentation.md) - 文档规范和文档同步要求

---

## ✅ 检查清单

使用本清单时，请确保：

- [ ] 代码质量检查完成
- [ ] 版本管理检查完成
- [ ] 文档检查完成
- [ ] 测试检查完成
- [ ] 构建检查完成

---

**最后更新**: 2025-12-23

