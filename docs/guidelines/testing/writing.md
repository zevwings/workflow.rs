# æµ‹è¯•ç¼–å†™è§„èŒƒ

> æœ¬æ–‡æ¡£å®šä¹‰æµ‹è¯•ç¼–å†™çš„å…·ä½“è§„èŒƒå’Œæœ€ä½³å®è·µã€‚

---

## ğŸ“‹ ç›®å½•

- [æµ‹è¯•ç¼–å†™è§„èŒƒ](#-æµ‹è¯•ç¼–å†™è§„èŒƒ)
- [ç¼–å†™æµ‹è¯•æœ€ä½³å®è·µ](#-ç¼–å†™æµ‹è¯•æœ€ä½³å®è·µ)
- [è¢«å¿½ç•¥æµ‹è¯•æ–‡æ¡£è§„èŒƒ](#-è¢«å¿½ç•¥æµ‹è¯•æ–‡æ¡£è§„èŒƒ)

---

## âœ… æµ‹è¯•ç¼–å†™è§„èŒƒ

### 1. æµ‹è¯•ç»“æ„

æ¯ä¸ªæµ‹è¯•åº”åŒ…å«ï¼š
- **Arrange**ï¼šå‡†å¤‡æµ‹è¯•æ•°æ®å’Œç¯å¢ƒ
- **Act**ï¼šæ‰§è¡Œè¢«æµ‹è¯•çš„åŠŸèƒ½
- **Assert**ï¼šéªŒè¯ç»“æœ

```rust
#[test]
fn test_parse_ticket_id() {
    // Arrange
    let input = "PROJ-123";

    // Act
    let result = parse_ticket_id(input);

    // Assert
    assert_eq!(result, Some("PROJ-123"));
}
```

### 2. é”™è¯¯å¤„ç†æµ‹è¯•

ä¸ºé”™è¯¯æƒ…å†µç¼–å†™æµ‹è¯•ï¼š

```rust
#[test]
fn test_parse_ticket_id_invalid() {
    assert_eq!(parse_ticket_id("invalid"), None);
    assert_eq!(parse_ticket_id(""), None);
}
```

### 3. è¾¹ç•Œæ¡ä»¶æµ‹è¯•

æµ‹è¯•è¾¹ç•Œæ¡ä»¶å’Œæç«¯æƒ…å†µï¼š

```rust
#[test]
fn test_parse_ticket_id_boundary() {
    // æœ€å°é•¿åº¦
    assert_eq!(parse_ticket_id("A-1"), Some("A-1"));
    // æœ€å¤§é•¿åº¦
    assert_eq!(parse_ticket_id("VERY-LONG-PROJECT-NAME-123"), Some("VERY-LONG-PROJECT-NAME-123"));
}
```

---

## âœï¸ ç¼–å†™æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‘½åè§„èŒƒ

**æè¿°æ€§å‘½å**ï¼š
- âœ… ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°ï¼Œè¯´æ˜æµ‹è¯•çš„å†…å®¹å’Œé¢„æœŸç»“æœ
- âœ… ä½¿ç”¨ `test_` å‰ç¼€æˆ– `#[test]` å±æ€§
- âœ… æµ‹è¯•åç§°åº”åŒ…å«ï¼šè¢«æµ‹è¯•çš„åŠŸèƒ½ã€è¾“å…¥æ¡ä»¶ã€é¢„æœŸç»“æœ

```rust
// âœ… å¥½çš„å‘½å
#[test]
fn test_parse_ticket_id_with_valid_input() {}

#[test]
fn test_parse_ticket_id_with_invalid_input_returns_none() {}

// âŒ ä¸å¥½çš„å‘½å
#[test]
fn test1() {}

#[test]
fn test_parse() {}
```

### 2. æµ‹è¯•ç»“æ„ï¼ˆAAA æ¨¡å¼ï¼‰

**Arrange-Act-Assert æ¨¡å¼**ï¼š
```rust
#[test]
fn test_example() {
    // Arrange: å‡†å¤‡æµ‹è¯•æ•°æ®å’Œç¯å¢ƒ
    let input = "PROJ-123";
    let expected = Some("PROJ-123");

    // Act: æ‰§è¡Œè¢«æµ‹è¯•çš„åŠŸèƒ½
    let result = parse_ticket_id(input);

    // Assert: éªŒè¯ç»“æœ
    assert_eq!(result, expected);
}
```

### 3. æµ‹è¯•ç‹¬ç«‹æ€§

**æ¯ä¸ªæµ‹è¯•åº”ç‹¬ç«‹**ï¼š
- âœ… æ¯ä¸ªæµ‹è¯•åº”ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•
- âœ… æ¯ä¸ªæµ‹è¯•åº”ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®å’Œç¯å¢ƒ
- âœ… æµ‹è¯•ä¹‹é—´ä¸åº”å…±äº«çŠ¶æ€

```rust
// âœ… å¥½çš„åšæ³•ï¼šæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹
#[test]
fn test_parse_ticket_id_1() {
    let result = parse_ticket_id("PROJ-123");
    assert_eq!(result, Some("PROJ-123"));
}

#[test]
fn test_parse_ticket_id_2() {
    let result = parse_ticket_id("PROJ-456");
    assert_eq!(result, Some("PROJ-456"));
}

// âŒ ä¸å¥½çš„åšæ³•ï¼šæµ‹è¯•ä¹‹é—´å…±äº«çŠ¶æ€
static mut COUNTER: i32 = 0;

#[test]
fn test_1() {
    unsafe { COUNTER += 1; }
    assert_eq!(unsafe { COUNTER }, 1);
}

#[test]
fn test_2() {
    unsafe { COUNTER += 1; }
    assert_eq!(unsafe { COUNTER }, 2);  // ä¾èµ– test_1
}
```

### 4. æµ‹è¯•è¦†ç›–åŸåˆ™

**æµ‹è¯•è¦†ç›–é‡ç‚¹**ï¼š
- âœ… **æˆåŠŸè·¯å¾„**ï¼šæµ‹è¯•æ­£å¸¸æµç¨‹
- âœ… **é”™è¯¯è·¯å¾„**ï¼šæµ‹è¯•é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶
- âœ… **è¾¹ç•Œæ¡ä»¶**ï¼šæµ‹è¯•è¾¹ç•Œå€¼å’Œæç«¯æƒ…å†µ
- âœ… **é›†æˆåœºæ™¯**ï¼šæµ‹è¯•æ¨¡å—é—´äº¤äº’

### 5. æµ‹è¯•æ•°æ®ç®¡ç†

**ä½¿ç”¨ Fixtures**ï¼š
```rust
// âœ… ä½¿ç”¨ fixtures ç›®å½•ä¸­çš„æµ‹è¯•æ•°æ®
use std::fs;

#[test]
fn test_parse_pr_response() {
    let data = fs::read_to_string("tests/fixtures/sample_github_pr.json")
        .expect("Failed to read fixture");
    // ä½¿ç”¨æµ‹è¯•æ•°æ®
}
```

**ä½¿ç”¨æµ‹è¯•æ•°æ®å·¥å‚**ï¼š
```rust
// âœ… ä½¿ç”¨æµ‹è¯•æ•°æ®å·¥å‚ç”Ÿæˆæµ‹è¯•æ•°æ®
use tests::common::test_data_factory::TestDataFactory;

#[test]
fn test_with_factory() {
    let pr = TestDataFactory::github_pr()
        .with_id(123)
        .with_title("Test PR")
        .build();
    // ä½¿ç”¨ç”Ÿæˆçš„æµ‹è¯•æ•°æ®
}
```

### 6. Mock ä½¿ç”¨åŸåˆ™

**ä½•æ—¶ä½¿ç”¨ Mock**ï¼š
- âœ… æµ‹è¯•éœ€è¦è°ƒç”¨å¤–éƒ¨ APIï¼ˆGitHubã€Jira ç­‰ï¼‰
- âœ… æµ‹è¯•éœ€è¦æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚å’Œå“åº”
- âœ… æµ‹è¯•éœ€è¦é¿å…ä¾èµ–å¤–éƒ¨æœåŠ¡
- âœ… æµ‹è¯•éœ€è¦æ¨¡æ‹Ÿé”™è¯¯æƒ…å†µ

**Mock ä½¿ç”¨è§„èŒƒ**ï¼š
```rust
// âœ… ä½¿ç”¨ MockServer åŒ…è£…å™¨
use crate::common::http_helpers::MockServer;

#[test]
fn test_api_call() {
    let mut mock_server = MockServer::new();
    mock_server.setup_github_base_url();

    // åˆ›å»º Mock
    let _mock = mock_server
        .server
        .as_mut()
        .mock("GET", "/api/endpoint")
        .with_status(200)
        .with_body(r#"{"result": "success"}"#)
        .create();

    // æ‰§è¡Œæµ‹è¯•
    // ...

    // MockServer ä¼šåœ¨ Drop æ—¶è‡ªåŠ¨æ¸…ç†ç¯å¢ƒå˜é‡
}
```

### 7. æ–­è¨€æœ€ä½³å®è·µ

**ä½¿ç”¨æ¸…æ™°çš„æ–­è¨€**ï¼š
```rust
// âœ… ä½¿ç”¨æè¿°æ€§çš„æ–­è¨€æ¶ˆæ¯
assert_eq!(result, expected, "Failed to parse ticket ID: {}", input);

// âœ… ä½¿ç”¨ä¸“é—¨çš„æ–­è¨€å·¥å…·
use pretty_assertions::assert_eq;  // æ˜¾ç¤ºå½©è‰² diff

// âŒ é¿å…æ¨¡ç³Šçš„æ–­è¨€
assert!(result.is_some());  // ä¸å¤Ÿæ¸…æ™°
```

### 8. æµ‹è¯•æ–‡æ¡£

**ä¸ºå¤æ‚æµ‹è¯•æ·»åŠ æ³¨é‡Š**ï¼š
```rust
#[test]
fn test_complex_scenario() {
    // æµ‹è¯•åœºæ™¯ï¼šå½“ç”¨æˆ·è¾“å…¥æ— æ•ˆçš„ ticket ID æ—¶ï¼Œ
    // ç³»ç»Ÿåº”è¯¥è¿”å› None å¹¶è®°å½•é”™è¯¯æ—¥å¿—

    let input = "INVALID";
    let result = parse_ticket_id(input);

    assert_eq!(result, None);
    // éªŒè¯é”™è¯¯æ—¥å¿—å·²è®°å½•
}
```

---

## ğŸš« è¢«å¿½ç•¥æµ‹è¯•æ–‡æ¡£è§„èŒƒ

å¯¹äºä½¿ç”¨ `#[ignore]` æ ‡è®°çš„æµ‹è¯•ï¼Œå¿…é¡»æ·»åŠ å®Œæ•´çš„æ–‡æ¡£æ³¨é‡Šã€‚

### ç»Ÿä¸€æ–‡æ¡£æ ¼å¼

æ‰€æœ‰è¢«å¿½ç•¥çš„æµ‹è¯•éƒ½åº”è¯¥åŒ…å«ä»¥ä¸‹5ä¸ªéƒ¨åˆ†çš„æ–‡æ¡£æ³¨é‡Šï¼š

```rust
/// æµ‹è¯•æ ‡é¢˜ï¼ˆç®€çŸ­æè¿°æµ‹è¯•å†…å®¹ï¼‰
///
/// ## æµ‹è¯•ç›®çš„
/// éªŒè¯/æµ‹è¯•...ï¼ˆè¯´æ˜æµ‹è¯•éªŒè¯ä»€ä¹ˆåŠŸèƒ½ï¼‰
///
/// ## ä¸ºä»€ä¹ˆè¢«å¿½ç•¥
/// - **ä¸»è¦åŸå› **: ...
/// - **æ¬¡è¦åŸå› **: ...
/// - **ä½¿ç”¨åœºæ™¯**: ...
///
/// ## å¦‚ä½•æ‰‹åŠ¨è¿è¡Œ
/// ```bash
/// cargo test test_function_name -- --ignored
/// ```
/// ï¼ˆå¦‚é€‚ç”¨ï¼‰é¢å¤–çš„è¿è¡Œè¯´æ˜æˆ–äº¤äº’æ­¥éª¤
///
/// ## æµ‹è¯•åœºæ™¯
/// 1. ...
/// 2. ...
/// 3. ...
///
/// ## é¢„æœŸè¡Œä¸º
/// - ...
/// - ...
#[test]
#[ignore] // ç®€çŸ­åŸå› 
fn test_function_name() {
    // æµ‹è¯•ä»£ç 
}
```

### å¸¸è§å¿½ç•¥åŸå› 

**1. ç”¨æˆ·äº¤äº’æµ‹è¯•**ï¼š
- **éœ€è¦ç”¨æˆ·äº¤äº’**: æµ‹è¯•éœ€è¦ç”¨æˆ·åœ¨ç»ˆç«¯ä¸­è¿›è¡Œäº¤äº’æ“ä½œ
- **CIç¯å¢ƒä¸æ”¯æŒ**: è‡ªåŠ¨åŒ–CIç¯å¢ƒæ— æ³•æä¾›äº¤äº’å¼è¾“å…¥

**2. ç½‘ç»œè¯·æ±‚æµ‹è¯•**ï¼š
- **éœ€è¦ç½‘ç»œè¿æ¥**: æµ‹è¯•éœ€è¦å®é™…çš„ç½‘ç»œè¿æ¥åˆ°å¤–éƒ¨API
- **éœ€è¦APIå¯†é’¥**: éœ€è¦æœ‰æ•ˆçš„APIå¯†é’¥æˆ–è®¤è¯å‡­æ®
- **CIæˆæœ¬è€ƒè™‘**: é¿å…åœ¨CIä¸­äº§ç”ŸAPIè°ƒç”¨è´¹ç”¨

**3. æ—¶é—´ç›¸å…³æµ‹è¯•**ï¼š
- **æ¶‰åŠçœŸå®æ—¶é—´å»¶è¿Ÿ**: æµ‹è¯•éœ€è¦ç­‰å¾…å®é™…çš„æ—¶é—´æµé€
- **æµ‹è¯•è¿è¡Œæ—¶é—´é•¿**: å®Œæ•´æµ‹è¯•éœ€è¦è¾ƒé•¿æ—¶é—´
- **CIæ—¶é—´é™åˆ¶**: é¿å…åœ¨CIä¸­å ç”¨è¿‡å¤šæ—¶é—´

**4. ä¿®æ”¹ç³»ç»Ÿé…ç½®çš„æµ‹è¯•**ï¼š
- **ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶**: æµ‹è¯•ä¼šä¿®æ”¹ç”¨æˆ·çš„é…ç½®æ–‡ä»¶
- **å®‰å…¨é£é™©**: é¿å…åœ¨CIæˆ–å¼€å‘ç¯å¢ƒä¸­æ„å¤–ä¿®æ”¹é…ç½®

è¯¦ç»†çš„è¢«å¿½ç•¥æµ‹è¯•è§„èŒƒè¯·å‚è€ƒ [è¢«å¿½ç•¥æµ‹è¯•è§„èŒƒ](./references/ignored-tests.md)ã€‚

---

## ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•ç»„ç»‡è§„èŒƒ](./organization.md) - æµ‹è¯•ç»„ç»‡ç»“æ„å’Œå‘½åçº¦å®š
- [æµ‹è¯•å‘½ä»¤å‚è€ƒ](./commands.md) - å¸¸ç”¨æµ‹è¯•å‘½ä»¤
- [æµ‹è¯•å·¥å…·æŒ‡å—](./references/tools.md) - æµ‹è¯•å·¥å…·ä½¿ç”¨
- [è¢«å¿½ç•¥æµ‹è¯•è§„èŒƒ](./references/ignored-tests.md) - è¢«å¿½ç•¥æµ‹è¯•çš„å®Œæ•´è§„èŒƒ

---

**æœ€åæ›´æ–°**: 2025-12-25

