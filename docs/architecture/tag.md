# Tag æ¨¡å—æ¶æ„æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

Tag æ¨¡å—æ˜¯ Workflow CLI çš„æ ¸å¿ƒæ¨¡å—ï¼Œæä¾›å®Œæ•´çš„ Git tag æ“ä½œåŠŸèƒ½ã€‚è¯¥æ¨¡å—é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ï¼š

- **Lib å±‚**ï¼ˆ`lib/git/tag.rs`ï¼‰ï¼šæä¾› Git tag æ“ä½œçš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…æ‹¬åˆ—å‡º tagã€åˆ é™¤ tagã€æ£€æŸ¥ tag å­˜åœ¨æ€§å’Œè·å– tag ä¿¡æ¯ç­‰åŠŸèƒ½
- **Commands å±‚**ï¼ˆ`commands/tag/`ï¼‰ï¼šæä¾› CLI å‘½ä»¤å°è£…ï¼Œå¤„ç†ç”¨æˆ·äº¤äº’ï¼ŒåŒ…æ‹¬ tag åˆ é™¤åŠŸèƒ½ï¼ˆæ”¯æŒæœ¬åœ°å’Œè¿œç¨‹ tag åˆ é™¤ï¼Œæ”¯æŒæ¨¡å¼åŒ¹é…å’Œäº¤äº’å¼é€‰æ‹©ï¼‰

Tag æ¨¡å—é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œä½¿ç”¨é›¶å¤§å°ç»“æ„ä½“ç»„ç»‡ç›¸å…³å‡½æ•°ï¼Œé€šè¿‡ç»Ÿä¸€çš„è¾…åŠ©å‡½æ•°å‡å°‘ä»£ç é‡å¤ã€‚

**æ¨¡å—ç»Ÿè®¡ï¼š**
- Lib å±‚ä»£ç è¡Œæ•°ï¼šçº¦ 286 è¡Œ
- Commands å±‚ä»£ç è¡Œæ•°ï¼šçº¦ 248 è¡Œ
- å‘½ä»¤æ•°é‡ï¼š1 ä¸ªï¼ˆdeleteï¼‰
- æ–‡ä»¶æ•°é‡ï¼šLib å±‚ 1 ä¸ªï¼ŒCommands å±‚ 2 ä¸ª
- ä¸»è¦ç»“æ„ä½“ï¼š`GitTag`ã€`TagInfo`

---

## ğŸ“ Lib å±‚æ¶æ„ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰

Tag æ¨¡å—ï¼ˆ`lib/git/tag.rs`ï¼‰æ˜¯ Workflow CLI çš„ Git æ“ä½œæ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›å®Œæ•´çš„ Git tag æ“ä½œåŠŸèƒ½ã€‚

### æ¨¡å—ç»“æ„

```
src/lib/git/
â”œâ”€â”€ mod.rs          # Git æ¨¡å—å£°æ˜å’Œå¯¼å‡º
â”œâ”€â”€ tag.rs          # Tag ç®¡ç†æ“ä½œ (286è¡Œ)
â””â”€â”€ helpers.rs      # Git æ“ä½œè¾…åŠ©å‡½æ•°ï¼ˆå…±äº«ï¼‰
```

### ä¾èµ–æ¨¡å—

- **`duct`**ï¼šå‘½ä»¤æ‰§è¡Œåº“ï¼ˆæ‰§è¡Œ Git å‘½ä»¤ï¼‰
- **`lib/git/helpers.rs`**ï¼šGit æ“ä½œè¾…åŠ©å‡½æ•°ï¼ˆ`cmd-_read`ã€`cmd-_run`ã€`check-_ref-_exists`ã€`check-_success`ï¼‰

### æ¨¡å—é›†æˆ

- **Tag å‘½ä»¤é›†æˆ** (`commands/tag/`)ï¼š
  - `GitTag::list-_all-_tags()` - è·å–æ‰€æœ‰ tag
  - `GitTag::get-_tag-_info()` - è·å– tag ä¿¡æ¯
  - `GitTag::delete-_local()` - åˆ é™¤æœ¬åœ° tag
  - `GitTag::delete-_remote()` - åˆ é™¤è¿œç¨‹ tag

- **ä»“åº“æ¸…ç†é›†æˆ** (`commands/repo/`)ï¼š
  - `GitTag::list-_local-_tags()` - è·å–æœ¬åœ° tag åˆ—è¡¨
  - `GitTag::is-_tag-_exists()` - æ£€æŸ¥ tag æ˜¯å¦å­˜åœ¨

---

## ğŸ—ï¸ Lib å±‚æ¶æ„è®¾è®¡

### è®¾è®¡åŸåˆ™

1. **æ¨¡å—åŒ–è®¾è®¡**ï¼šTag æ“ä½œé›†ä¸­åœ¨ç‹¬ç«‹çš„ç»“æ„ä½“ä¸­ï¼ŒèŒè´£æ¸…æ™°
2. **é›¶å¤§å°ç»“æ„ä½“**ï¼šä½¿ç”¨ unit struct ç»„ç»‡ç›¸å…³å‡½æ•°ï¼Œç¬¦åˆ Rust æœ€ä½³å®è·µ
3. **ç»Ÿä¸€è¾…åŠ©å‡½æ•°**ï¼šé€šè¿‡ `helpers.rs` æä¾›ç»Ÿä¸€çš„ Git å‘½ä»¤æ‰§è¡Œæ¥å£
4. **é”™è¯¯å¤„ç†ç»Ÿä¸€**ï¼šä½¿ç”¨ `anyhow::Result` å’Œ `context` æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
5. **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨ `TagInfo` ç»“æ„ä½“å°è£… tag ä¿¡æ¯

### æ ¸å¿ƒç»„ä»¶

#### 1. Tag ç®¡ç† (`tag.rs`)

**èŒè´£**ï¼šæä¾› tag ç›¸å…³çš„æ‰€æœ‰æ“ä½œ

- **`GitTag`**ï¼šTag ç®¡ç†ç»“æ„ä½“ï¼ˆé›¶å¤§å°ç»“æ„ä½“ï¼‰

**ä¸»è¦æ–¹æ³•**ï¼š
- `list-_local-_tags()` - åˆ—å‡ºæ‰€æœ‰æœ¬åœ° tag
- `list-_remote-_tags()` - åˆ—å‡ºæ‰€æœ‰è¿œç¨‹ tag
- `list-_all-_tags()` - åˆ—å‡ºæ‰€æœ‰ tagï¼ˆæœ¬åœ°å’Œè¿œç¨‹ï¼Œåˆå¹¶å»é‡ï¼‰
- `is-_tag-_exists()` - æ£€æŸ¥ tag æ˜¯å¦å­˜åœ¨ï¼ˆæœ¬åœ°æˆ–è¿œç¨‹ï¼‰
- `get-_tag-_info()` - è·å– tag ä¿¡æ¯ï¼ˆåç§°ã€commit hashã€å­˜åœ¨ä½ç½®ï¼‰
- `delete-_local()` - åˆ é™¤æœ¬åœ° tag
- `delete-_remote()` - åˆ é™¤è¿œç¨‹ tag
- `delete-_both()` - åˆ é™¤æœ¬åœ°å’Œè¿œç¨‹ tag

**å…³é”®ç‰¹æ€§**ï¼š
- æ”¯æŒåˆ—å‡ºæœ¬åœ°å’Œè¿œç¨‹ tag
- è‡ªåŠ¨åˆå¹¶æœ¬åœ°å’Œè¿œç¨‹ tag åˆ—è¡¨ï¼ˆå»é‡ï¼‰
- æ”¯æŒåˆ é™¤æœ¬åœ°å’Œè¿œç¨‹ tag
- è¿œç¨‹ tag åˆ é™¤æ”¯æŒä¸¤ç§æ–¹å¼ï¼ˆ`--delete` å’Œ `:refs/tags/` å›é€€ï¼‰

**ä½¿ç”¨åœºæ™¯**ï¼š
- Tag åˆ é™¤å‘½ä»¤ï¼šåˆ—å‡ºå’Œåˆ é™¤ tag
- ä»“åº“æ¸…ç†å‘½ä»¤ï¼šåˆ—å‡ºæœ¬åœ° tag ç”¨äºæ¸…ç†

#### 2. ç±»å‹å®šä¹‰

**`TagInfo`**ï¼šTag ä¿¡æ¯ç»“æ„ä½“

```rust
pub struct TagInfo {
    pub name: String,              // Tag åç§°
    pub commit-_hash: String,        // Tag æŒ‡å‘çš„ commit hash
    pub exists-_local: bool,        // Tag æ˜¯å¦åœ¨æœ¬åœ°å­˜åœ¨
    pub exists-_remote: bool,       // Tag æ˜¯å¦åœ¨è¿œç¨‹å­˜åœ¨
}
```

**è®¾è®¡ä¼˜åŠ¿**ï¼š
- å°è£… tag çš„å®Œæ•´ä¿¡æ¯
- ä¾¿äºä¼ é€’å’Œæ˜¾ç¤º tag ä¿¡æ¯
- ç±»å‹å®‰å…¨ï¼Œé¿å…å­—ç¬¦ä¸²æ‹¼æ¥é”™è¯¯

### è®¾è®¡æ¨¡å¼

#### 1. æ¨¡å—åŒ–è®¾è®¡æ¨¡å¼

ä½¿ç”¨é›¶å¤§å°ç»“æ„ä½“ï¼ˆunit structï¼‰ç»„ç»‡ç›¸å…³å‡½æ•°ï¼š

```rust
pub struct GitTag;  // é›¶å¤§å°ç»“æ„ä½“
impl GitTag {
    pub fn list-_local-_tags() -> Result<Vec<String>> { ... }
    // ...
}
```

**ä¼˜åŠ¿**ï¼š
- èŒè´£æ¸…æ™°ï¼Œç¬¦åˆå•ä¸€èŒè´£åŸåˆ™
- å‘½åç©ºé—´æ˜ç¡®ï¼ˆ`GitTag::list-_local-_tags()`ï¼‰
- æ˜“äºç»´æŠ¤å’Œæ‰©å±•

#### 2. è¾…åŠ©å‡½æ•°æ¨¡å¼

é€šè¿‡ `helpers.rs` æä¾›ç»Ÿä¸€çš„ Git å‘½ä»¤æ‰§è¡Œæ¥å£ï¼š

```rust
// ç»Ÿä¸€æ¥å£
cmd-_read(&["tag", "-l"])
cmd-_run(&["tag", "-d", tag-_name])
check-_ref-_exists(&format!("refs/tags/{}", tag-_name))
```

**ä¼˜åŠ¿**ï¼š
- å‡å°‘ä»£ç é‡å¤
- ç»Ÿä¸€é”™è¯¯å¤„ç†æ ¼å¼
- æé«˜ä»£ç å¯ç»´æŠ¤æ€§

#### 3. å›é€€æ¨¡å¼

`delete-_remote()` æ–¹æ³•å®ç°è‡ªåŠ¨å›é€€ï¼š

```rust
// ä¼˜å…ˆä½¿ç”¨ --delete æ–¹å¼
let result = cmd-_run(&["push", "origin", "--delete", tag-_name]);

if result.is-_err() {
    // å›é€€åˆ°ä½¿ç”¨ :refs/tags/ æ–¹å¼
    cmd-_run(&["push", "origin", &format!(":refs/tags/{}", tag-_name)])?;
}
```

**ä¼˜åŠ¿**ï¼š
- æ”¯æŒä¸åŒ Git ç‰ˆæœ¬å’Œè¿œç¨‹ä»“åº“é…ç½®
- è‡ªåŠ¨é€‚é…ä¸åŒç¯å¢ƒ
- æé«˜å…¼å®¹æ€§

### é”™è¯¯å¤„ç†

#### åˆ†å±‚é”™è¯¯å¤„ç†

1. **è¾…åŠ©å‡½æ•°å±‚**ï¼šç»Ÿä¸€é”™è¯¯ä¸Šä¸‹æ–‡
   ```rust
   cmd-_read(&["tag", "-l"])
       .wrap-_err("Failed to list local tags")
   ```

2. **ä¸šåŠ¡é€»è¾‘å±‚**ï¼šæ·»åŠ ä¸šåŠ¡ä¸Šä¸‹æ–‡
   ```rust
   GitTag::delete-_local(tag-_name)
       .wrap-_err-_with(|| format!("Failed to delete local tag: {}", tag-_name))
   ```

3. **å‘½ä»¤å±‚**ï¼šç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

#### å®¹é”™æœºåˆ¶

- **Tag ä¸å­˜åœ¨**ï¼šè¿”å›æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯
- **åˆ é™¤å¤±è´¥**ï¼šæä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®
- **è¿œç¨‹ tag åˆ é™¤å¤±è´¥**ï¼šè‡ªåŠ¨å›é€€åˆ°å¤‡ç”¨æ–¹æ³•

---

## ğŸ“ Commands å±‚æ¶æ„ï¼ˆå‘½ä»¤å°è£…ï¼‰

Tag å‘½ä»¤å±‚æ˜¯ Workflow CLI çš„å‘½ä»¤æ¥å£ï¼Œæä¾›å®‰å…¨çš„ tag åˆ é™¤åŠŸèƒ½ã€‚è¯¥å±‚é‡‡ç”¨å‘½ä»¤æ¨¡å¼è®¾è®¡ï¼Œé€šè¿‡è°ƒç”¨ `lib/git/` æ¨¡å—æä¾›çš„ API å®ç°ä¸šåŠ¡åŠŸèƒ½ã€‚

> **æ¶æ„è¯´æ˜**ï¼šæœ¬æ¨¡å—éµå¾ªé¡¹ç›®çš„ä¸‰å±‚æ¶æ„è®¾è®¡ï¼Œè¯¦è§ [architecture.md](./architecture.md#ä¸‰å±‚æ¶æ„è®¾è®¡)

### ç›¸å…³æ–‡ä»¶

#### CLI å…¥å£å±‚

Tag ç®¡ç†å‘½ä»¤ç°åœ¨ä½œä¸º `workflow` ä¸»å‘½ä»¤çš„å­å‘½ä»¤ï¼Œé€šè¿‡ `src/main.rs` ä¸­çš„ `Commands::Tag` æšä¸¾å®šä¹‰ã€‚

```
src/main.rs
```
- **èŒè´£**ï¼š`workflow` ä¸»å‘½ä»¤å…¥å£ï¼Œè´Ÿè´£å‘½ä»¤è¡Œå‚æ•°è§£æå’Œå‘½ä»¤åˆ†å‘
- **åŠŸèƒ½**ï¼šä½¿ç”¨ `clap` è§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œå°† `workflow tag` å­å‘½ä»¤åˆ†å‘åˆ°å¯¹åº”çš„å‘½ä»¤å¤„ç†å‡½æ•°

#### å‘½ä»¤å°è£…å±‚

```
src/commands/tag/
â”œâ”€â”€ mod.rs          # Tag å‘½ä»¤æ¨¡å—å£°æ˜
â””â”€â”€ delete.rs       # Tag åˆ é™¤å‘½ä»¤ï¼ˆ~248 è¡Œï¼‰
```

**èŒè´£**ï¼š
- è§£æå‘½ä»¤å‚æ•°
- å¤„ç†ç”¨æˆ·äº¤äº’ï¼ˆç¡®è®¤ã€é¢„è§ˆç­‰ï¼‰
- æ ¼å¼åŒ–è¾“å‡º
- è°ƒç”¨æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚ (`lib/git/`) çš„åŠŸèƒ½

### ä¾èµ–æ¨¡å—

å‘½ä»¤å±‚é€šè¿‡è°ƒç”¨ `lib/` æ¨¡å—æä¾›çš„ API å®ç°åŠŸèƒ½ï¼Œå…·ä½“å®ç°ç»†èŠ‚è¯·å‚è€ƒç›¸å…³æ¨¡å—æ–‡æ¡£ï¼š
- **`lib/git/`**ï¼šGit æ“ä½œï¼ˆ`GitTag`ï¼‰
  - `GitTag::list-_all-_tags()` - è·å–æ‰€æœ‰ tagï¼ˆæœ¬åœ°å’Œè¿œç¨‹ï¼‰
  - `GitTag::get-_tag-_info()` - è·å– tag ä¿¡æ¯
  - `GitTag::delete-_local()` - åˆ é™¤æœ¬åœ° tag
  - `GitTag::delete-_remote()` - åˆ é™¤è¿œç¨‹ tag
- **`lib/base/dialog/`**ï¼šå¯¹è¯æ¡†ï¼ˆ`ConfirmDialog`ã€`MultiSelectDialog`ï¼‰

---

## ğŸ”„ é›†æˆå…³ç³»

### Lib å±‚å’Œ Commands å±‚çš„åä½œ

Tag æ¨¡å—é‡‡ç”¨æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼ŒLib å±‚å’Œ Commands å±‚é€šè¿‡ä»¥ä¸‹æ–¹å¼åä½œï¼š

1. **Tag æ“ä½œ**ï¼šCommands å±‚è°ƒç”¨ `GitTag` çš„æ–¹æ³•è¿›è¡Œ tag æ“ä½œ
2. **Tag åˆ—è¡¨**ï¼šCommands å±‚ä½¿ç”¨ `GitTag::list-_all-_tags()` è·å–æ‰€æœ‰ tag
3. **Tag ä¿¡æ¯**ï¼šCommands å±‚ä½¿ç”¨ `GitTag::get-_tag-_info()` è·å– tag è¯¦ç»†ä¿¡æ¯
4. **ç”¨æˆ·äº¤äº’**ï¼šCommands å±‚è´Ÿè´£æ ¼å¼åŒ–è¾“å‡ºå’Œç”¨æˆ·æç¤º

### è°ƒç”¨æµç¨‹

#### æ•´ä½“æ¶æ„æµç¨‹

```
è°ƒç”¨è€…ï¼ˆå‘½ä»¤å±‚æˆ–å…¶ä»–æ¨¡å—ï¼‰
  â†“
lib/git/tag.rs (æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚)
  â”œâ”€â”€ GitTag::list-_local-_tags()      # åˆ—å‡ºæœ¬åœ° tag
  â”œâ”€â”€ GitTag::list-_remote-_tags()     # åˆ—å‡ºè¿œç¨‹ tag
  â”œâ”€â”€ GitTag::list-_all-_tags()        # åˆ—å‡ºæ‰€æœ‰ tag
  â”œâ”€â”€ GitTag::is-_tag-_exists()        # æ£€æŸ¥ tag æ˜¯å¦å­˜åœ¨
  â”œâ”€â”€ GitTag::get-_tag-_info()         # è·å– tag ä¿¡æ¯
  â”œâ”€â”€ GitTag::delete-_local()         # åˆ é™¤æœ¬åœ° tag
  â””â”€â”€ GitTag::delete-_remote()         # åˆ é™¤è¿œç¨‹ tag
  â†“
helpers.rs (è¾…åŠ©å‡½æ•°å±‚)
  â”œâ”€â”€ cmd-_read()
  â”œâ”€â”€ cmd-_run()
  â”œâ”€â”€ check-_ref-_exists()
  â””â”€â”€ check-_success()
  â†“
duct::cmd (å‘½ä»¤æ‰§è¡Œå±‚)
  â””â”€â”€ git å‘½ä»¤
```

#### å‘½ä»¤åˆ†å‘æµç¨‹

```
src/main.rs::main()
  â†“
Cli::parse() (è§£æå‘½ä»¤è¡Œå‚æ•°)
  â†“
match cli.subcommand {
  TagSubcommand::Delete { tag-_name, local, remote, pattern, dry-_run, force } => TagDeleteCommand::execute()
}
```

---

## ğŸ“‹ Commands å±‚å‘½ä»¤è¯¦æƒ…

### Tag åˆ é™¤å‘½ä»¤ (`delete.rs`)

Tag åˆ é™¤å‘½ä»¤æä¾›å®‰å…¨çš„ tag åˆ é™¤åŠŸèƒ½ï¼š

1. **å¤šç§é€‰æ‹©æ–¹å¼**ï¼š
   - ç›´æ¥æŒ‡å®š tag åç§°
   - ä½¿ç”¨æ¨¡å¼åŒ¹é…ï¼ˆ`--pattern`ï¼Œæ”¯æŒ shell é€šé…ç¬¦ï¼š`*`ã€`?`ï¼‰
   - äº¤äº’å¼é€‰æ‹©ï¼ˆä¸æä¾›å‚æ•°æ—¶ï¼‰

2. **åˆ é™¤èŒƒå›´æ§åˆ¶**ï¼š
   - `--local`ï¼šåªåˆ é™¤æœ¬åœ° tag
   - `--remote`ï¼šåªåˆ é™¤è¿œç¨‹ tag
   - é»˜è®¤ï¼šåˆ é™¤æœ¬åœ°å’Œè¿œç¨‹ tagï¼ˆå¦‚æœå­˜åœ¨ï¼‰

3. **å®‰å…¨æœºåˆ¶**ï¼š
   - é¢„è§ˆæ¨¡å¼ï¼šæ˜¾ç¤ºå°†è¦åˆ é™¤çš„ tag åˆ—è¡¨ï¼ˆtag åç§°ã€commit hashã€å­˜åœ¨ä½ç½®ï¼‰
   - Dry-run æ¨¡å¼ï¼šåªé¢„è§ˆï¼Œä¸å®é™…åˆ é™¤
   - ç¡®è®¤æœºåˆ¶ï¼šåˆ é™¤å‰éœ€è¦ç”¨æˆ·ç¡®è®¤ï¼ˆé™¤éä½¿ç”¨ `--force`ï¼‰

4. **äº¤äº’å¼é€‰æ‹©**ï¼š
   - ä½¿ç”¨ `MultiSelectDialog` æ”¯æŒå¤šé€‰
   - æ˜¾ç¤º tag ä¿¡æ¯ï¼ˆåç§°ã€commit hashã€å­˜åœ¨ä½ç½®ï¼‰
   - æ ¼å¼ï¼š`<tag-_name> (commit: <hash>, local/remote/both)`

5. **æ¨¡å¼åŒ¹é…**ï¼š
   - æ”¯æŒ shell é€šé…ç¬¦ï¼š`*`ï¼ˆåŒ¹é…ä»»æ„å­—ç¬¦ï¼‰ã€`?`ï¼ˆåŒ¹é…å•ä¸ªå­—ç¬¦ï¼‰ã€`.`ï¼ˆè½¬ä¹‰ä¸ºå­—é¢é‡ï¼‰
   - è‡ªåŠ¨è½¬æ¢ä¸ºæ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…
   - ç¤ºä¾‹ï¼š`--pattern "v1.*"` åŒ¹é…æ‰€æœ‰ä»¥ `v1.` å¼€å¤´çš„ tag

**å…³é”®æ­¥éª¤**ï¼š
1. ä½¿ç”¨ `GitTag::list-_all-_tags()` è·å–æ‰€æœ‰ tagï¼ˆæœ¬åœ°å’Œè¿œç¨‹ï¼‰
2. ç¡®å®šè¦åˆ é™¤çš„ tag åˆ—è¡¨ï¼ˆæ¨¡å¼åŒ¹é…/æŒ‡å®šåç§°/äº¤äº’å¼é€‰æ‹©ï¼‰
3. ä½¿ç”¨ `GitTag::get-_tag-_info()` è·å–æ¯ä¸ª tag çš„è¯¦ç»†ä¿¡æ¯
4. æ˜¾ç¤ºé¢„è§ˆï¼ˆtag åç§°ã€commit hashã€å­˜åœ¨ä½ç½®ï¼‰
5. Dry-run æ¨¡å¼ï¼ˆå¦‚æœå¯ç”¨ï¼Œåªé¢„è§ˆä¸æ‰§è¡Œï¼‰
6. ç¡®è®¤åˆ é™¤ï¼ˆé™¤éä½¿ç”¨ forceï¼‰
7. æ‰§è¡Œåˆ é™¤ï¼ˆæ ¹æ® `--local` å’Œ `--remote` å‚æ•°ç¡®å®šåˆ é™¤èŒƒå›´ï¼‰
8. æ˜¾ç¤ºç»“æœ

---

## ğŸ”„ è°ƒç”¨æµç¨‹ä¸æ•°æ®æµ

### å…¸å‹è°ƒç”¨ç¤ºä¾‹

#### 1. åˆ—å‡ºæ‰€æœ‰ Tag

```
GitTag::list-_all-_tags()
  â†“
GitTag::list-_local-_tags()  # è·å–æœ¬åœ° tag
GitTag::list-_remote-_tags() # è·å–è¿œç¨‹ tag
  â†“
helpers::cmd-_read()  # æ‰§è¡Œ git tag -l
helpers::cmd-_read()  # æ‰§è¡Œ git ls-remote --tags
  â†“
åˆå¹¶å»é‡ï¼Œæ„å»º TagInfo åˆ—è¡¨
```

#### 2. åˆ é™¤ Tag

```
GitTag::delete-_local(tag-_name)
  â†“
helpers::cmd-_run()  # æ‰§è¡Œ git tag -d <tag-_name>
```

```
GitTag::delete-_remote(tag-_name)
  â†“
helpers::cmd-_run()  # æ‰§è¡Œ git push origin --delete <tag-_name>
  â†“
å¦‚æœå¤±è´¥ï¼Œå›é€€åˆ° git push origin :refs/tags/<tag-_name>
```

#### 3. è·å– Tag ä¿¡æ¯

```
GitTag::get-_tag-_info(tag-_name)
  â†“
GitTag::is-_tag-_exists(tag-_name)  # æ£€æŸ¥å­˜åœ¨æ€§
  â†“
helpers::cmd-_read()  # è·å– commit hashï¼ˆgit rev-parse æˆ– git ls-remoteï¼‰
  â†“
æ„å»º TagInfo ç»“æ„ä½“
```

### æ•°æ®æµ

#### åˆ é™¤ Tag æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥ (workflow tag delete [TAG_NAME] [--local] [--remote] [--pattern PATTERN] [--dry-run] [--force])
  â†“
è·å–æ‰€æœ‰ tagï¼ˆGitTag::list-_all-_tags()ï¼‰
  â†“
ç¡®å®šè¦åˆ é™¤çš„ tag åˆ—è¡¨ï¼ˆæ¨¡å¼åŒ¹é…/æŒ‡å®šåç§°/äº¤äº’å¼é€‰æ‹©ï¼‰
  â†“
è·å– tag ä¿¡æ¯ï¼ˆGitTag::get-_tag-_info()ï¼‰
  â†“
æ˜¾ç¤ºé¢„è§ˆ
  â†“
Dry-run æ¨¡å¼ï¼ˆå¦‚æœå¯ç”¨ï¼‰
  â†“
ç¡®è®¤åˆ é™¤ï¼ˆé™¤éä½¿ç”¨ forceï¼‰
  â†“
æ‰§è¡Œåˆ é™¤ï¼ˆGitTag::delete-_local() / GitTag::delete-_remote()ï¼‰
  â†“
æ˜¾ç¤ºç»“æœ
```

---

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### Delete å‘½ä»¤

```bash
# åˆ é™¤æŒ‡å®š tagï¼ˆæœ¬åœ°å’Œè¿œç¨‹ï¼‰
workflow tag delete v1.0.0

# åªåˆ é™¤æœ¬åœ° tag
workflow tag delete v1.0.0 --local

# åªåˆ é™¤è¿œç¨‹ tag
workflow tag delete v1.0.0 --remote

# ä½¿ç”¨æ¨¡å¼åŒ¹é…åˆ é™¤å¤šä¸ª tag
workflow tag delete --pattern "v1.*"

# é¢„è§ˆæ¨¡å¼ï¼ˆä¸å®é™…åˆ é™¤ï¼‰
workflow tag delete v1.0.0 --dry-run

# å¼ºåˆ¶åˆ é™¤ï¼ˆè·³è¿‡ç¡®è®¤ï¼‰
workflow tag delete v1.0.0 --force

# äº¤äº’å¼é€‰æ‹©ï¼ˆä¸æä¾›å‚æ•°ï¼‰
workflow tag delete
```

### åŸºæœ¬ä½¿ç”¨ï¼ˆLib å±‚ï¼‰

```rust
use workflow::git::GitTag;

// åˆ—å‡ºæ‰€æœ‰æœ¬åœ° tag
let local-_tags = GitTag::list-_local-_tags()?;

// åˆ—å‡ºæ‰€æœ‰è¿œç¨‹ tag
let remote-_tags = GitTag::list-_remote-_tags()?;

// åˆ—å‡ºæ‰€æœ‰ tagï¼ˆæœ¬åœ°å’Œè¿œç¨‹ï¼Œåˆå¹¶å»é‡ï¼‰
let all-_tags = GitTag::list-_all-_tags()?;

// æ£€æŸ¥ tag æ˜¯å¦å­˜åœ¨
let (exists-_local, exists-_remote) = GitTag::is-_tag-_exists("v1.0.0")?;

// è·å– tag ä¿¡æ¯
let tag-_info = GitTag::get-_tag-_info("v1.0.0")?;
println!("Tag: {}, Commit: {}", tag-_info.name, tag-_info.commit-_hash);

// åˆ é™¤æœ¬åœ° tag
GitTag::delete-_local("v1.0.0")?;

// åˆ é™¤è¿œç¨‹ tag
GitTag::delete-_remote("v1.0.0")?;

// åˆ é™¤æœ¬åœ°å’Œè¿œç¨‹ tag
GitTag::delete-_both("v1.0.0")?;
```

### æ‰¹é‡æ“ä½œ

```rust
use workflow::git::GitTag;

// åˆ—å‡ºæ‰€æœ‰ tag
let all-_tags = GitTag::list-_all-_tags()?;

// è¿‡æ»¤éœ€è¦åˆ é™¤çš„ tagï¼ˆä¾‹å¦‚ï¼šæ‰€æœ‰ v1.x ç‰ˆæœ¬çš„ tagï¼‰
let tags-_to-_delete: Vec<String> = all-_tags
    .iter()
    .filter(|tag| tag.name.starts-_with("v1."))
    .map(|tag| tag.name.clone())
    .collect();

// æ‰¹é‡åˆ é™¤
for tag-_name in tags-_to-_delete {
    if let Err(e) = GitTag::delete-_both(&tag-_name) {
        eprintln!("Failed to delete tag {}: {}", tag-_name, e);
    }
}
```

---

## ğŸ“ æ‰©å±•æ€§

### æ·»åŠ æ–°çš„ Tag æ“ä½œ

1. åœ¨ `tag.rs` ä¸­æ·»åŠ æ–¹æ³•
2. ä½¿ç”¨ `helpers.rs` ä¸­çš„è¾…åŠ©å‡½æ•°
3. æ·»åŠ æ–‡æ¡£æ³¨é‡Š
4. åœ¨ `mod.rs` ä¸­å¯¼å‡ºï¼ˆå¦‚éœ€è¦ï¼‰

**ç¤ºä¾‹**ï¼š
```rust
// tag.rs
impl GitTag {
    pub fn create-_tag(tag-_name: &str, message: Option<&str>) -> Result<()> {
        let mut args = vec!["tag"];

        if let Some(msg) = message {
            args.push("-a");
            args.push(tag-_name);
            args.push("-m");
            args.push(msg);
        } else {
            args.push(tag-_name);
        }

        helpers::cmd-_run(&args)
            .wrap-_err-_with(|| format!("Failed to create tag: {}", tag-_name))
    }
}
```

### æ·»åŠ æ–°çš„ Tag ä¿¡æ¯å­—æ®µ

1. åœ¨ `TagInfo` ç»“æ„ä½“ä¸­æ·»åŠ æ–°å­—æ®µ
2. æ›´æ–°ç›¸å…³æ–¹æ³•ä»¥å¡«å……æ–°å­—æ®µ

### æ·»åŠ æ–°çš„å‘½ä»¤

1. åœ¨ `tag/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„å‘½ä»¤æ–‡ä»¶
2. åœ¨ `src/lib/cli/tag.rs` ä¸­æ·»åŠ æ–°çš„å­å‘½ä»¤æšä¸¾
3. åœ¨ `src/main.rs` ä¸­æ·»åŠ å‘½ä»¤åˆ†å‘é€»è¾‘
4. åœ¨ `lib/git/tag.rs` ä¸­æ·»åŠ å¯¹åº”çš„ Git æ“ä½œæ–¹æ³•ï¼ˆå¦‚éœ€è¦ï¼‰

---

## ğŸ” é”™è¯¯å¤„ç†

### åˆ†å±‚é”™è¯¯å¤„ç†

1. **CLI å±‚**ï¼šå‚æ•°éªŒè¯é”™è¯¯
   - `clap` è‡ªåŠ¨å¤„ç†å‚æ•°éªŒè¯å’Œé”™è¯¯æç¤º

2. **å‘½ä»¤å±‚**ï¼šç”¨æˆ·äº¤äº’é”™è¯¯ã€ä¸šåŠ¡é€»è¾‘é”™è¯¯
   - Tag ä¸å­˜åœ¨ï¼šè®°å½•è­¦å‘Šï¼Œç»§ç»­å¤„ç†å…¶ä»– tag
   - åˆ é™¤å¤±è´¥ï¼šè®°å½•è­¦å‘Šï¼Œç»§ç»­å¤„ç†å…¶ä»– tag

3. **åº“å±‚**ï¼šGit æ“ä½œé”™è¯¯ã€æ–‡ä»¶æ“ä½œé”™è¯¯
   - é€šè¿‡ `GitTag` API è¿”å›çš„é”™è¯¯ä¿¡æ¯
   - Git æ“ä½œå¤±è´¥ã€æ–‡ä»¶è¯»å†™é”™è¯¯ç­‰

### å®¹é”™æœºåˆ¶

- **Tag ä¸å­˜åœ¨**ï¼šè®°å½•è­¦å‘Šï¼Œç»§ç»­å¤„ç†å…¶ä»– tag
- **åˆ é™¤å¤±è´¥**ï¼šè®°å½•è­¦å‘Šï¼Œç»§ç»­å¤„ç†å…¶ä»– tag
- **æ¨¡å¼åŒ¹é…å¤±è´¥**ï¼šè¿”å›é”™è¯¯ï¼Œæç¤ºç”¨æˆ·æ£€æŸ¥æ¨¡å¼æ ¼å¼

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä¸»æ¶æ„æ–‡æ¡£](./architecture.md)
- [Git æ¨¡å—æ¶æ„æ–‡æ¡£](./git.md) - Git æ“ä½œç›¸å…³

---

## âœ… æ€»ç»“

Tag æ¨¡å—é‡‡ç”¨æ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡ï¼š

1. **æ¨¡å—åŒ–ç»“æ„**ï¼šTag æ“ä½œé›†ä¸­åœ¨ç‹¬ç«‹çš„ç»“æ„ä½“ä¸­ï¼ŒèŒè´£æ¸…æ™°
2. **ç»Ÿä¸€è¾…åŠ©å‡½æ•°**ï¼šé€šè¿‡ `helpers.rs` æä¾›ç»Ÿä¸€çš„å‘½ä»¤æ‰§è¡Œæ¥å£
3. **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨ `TagInfo` ç»“æ„ä½“å°è£… tag ä¿¡æ¯
4. **é”™è¯¯å¤„ç†ç»Ÿä¸€**ï¼šä½¿ç”¨ `anyhow::Result` å’Œ `context` æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
5. **æ˜“äºæ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ä¾¿äºæ·»åŠ æ–°åŠŸèƒ½
6. **å®Œæ•´åŠŸèƒ½**ï¼šæ”¯æŒåˆ—å‡ºã€æ£€æŸ¥ã€åˆ é™¤æœ¬åœ°å’Œè¿œç¨‹ tag
7. **å®‰å…¨åˆ é™¤**ï¼šæ”¯æŒæœ¬åœ°å’Œè¿œç¨‹ tag åˆ é™¤ï¼Œæä¾›å®Œæ•´çš„é¢„è§ˆå’Œç¡®è®¤æœºåˆ¶
8. **çµæ´»é€‰æ‹©**ï¼šæ”¯æŒç›´æ¥æŒ‡å®šã€æ¨¡å¼åŒ¹é…å’Œäº¤äº’å¼é€‰æ‹©

**è®¾è®¡ä¼˜åŠ¿**ï¼š
- âœ… **èŒè´£æ¸…æ™°**ï¼šæ¯ä¸ªæ–¹æ³•è´Ÿè´£å•ä¸€åŠŸèƒ½é¢†åŸŸ
- âœ… **ä»£ç å¤ç”¨**ï¼šç»Ÿä¸€çš„è¾…åŠ©å‡½æ•°å‡å°‘é‡å¤ä»£ç 
- âœ… **æ˜“äºç»´æŠ¤**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œä½è€¦åˆ
- âœ… **ç±»å‹å®‰å…¨**ï¼šç»“æ„ä½“ä¿è¯ç±»å‹å®‰å…¨
- âœ… **å…¼å®¹æ€§å¥½**ï¼šè‡ªåŠ¨å›é€€æœºåˆ¶æ”¯æŒä¸åŒ Git ç‰ˆæœ¬å’Œé…ç½®
- âœ… **å®‰å…¨æ€§**ï¼šå¤šé‡ç¡®è®¤æœºåˆ¶ï¼Œé˜²æ­¢è¯¯åˆ é‡è¦ tag
- âœ… **çµæ´»æ€§**ï¼šæ”¯æŒå¤šç§é€‰æ‹©æ–¹å¼å’Œåˆ é™¤èŒƒå›´æ§åˆ¶
- âœ… **ç”¨æˆ·å‹å¥½**ï¼šæ¸…æ™°çš„é¢„è§ˆå’Œç¡®è®¤æç¤ºï¼Œè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

é€šè¿‡æ¨¡å—åŒ–è®¾è®¡å’Œç»Ÿä¸€è¾…åŠ©å‡½æ•°ï¼Œå®ç°äº†ä»£ç å¤ç”¨ã€æ˜“äºç»´æŠ¤å’Œæ‰©å±•çš„ç›®æ ‡ã€‚å‘½ä»¤å±‚ä¸“æ³¨äºç”¨æˆ·äº¤äº’å’Œè¾“å‡ºæ ¼å¼åŒ–ï¼Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ç”± Lib å±‚æä¾›ï¼Œå®ç°äº†æ¸…æ™°çš„èŒè´£åˆ†ç¦»ã€‚

---

**æœ€åæ›´æ–°**: 2025-12-16

