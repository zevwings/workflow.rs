# Indicator æ¨¡å—æ¶æ„æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿° Workflow CLI çš„ Indicator æ¨¡å—æ¶æ„ï¼ŒåŒ…æ‹¬ï¼š
- Spinner - ç”¨äºä¸ç¡®å®šè¿›åº¦çš„é•¿æ—¶é—´è¿è¡Œæ“ä½œ
- Progress - ç”¨äºæœ‰æ˜ç¡®è¿›åº¦çš„æ“ä½œï¼ˆå¦‚ä¸‹è½½ã€ä¸Šä¼ ç­‰ï¼‰

è¯¥æ¨¡å—æä¾›ç»Ÿä¸€çš„è¿›åº¦æŒ‡ç¤ºå™¨åŠŸèƒ½ï¼Œä½¿ç”¨ `indicatif` ä½œä¸ºåç«¯å®ç°ã€‚æä¾›ç®€æ´çš„ APIï¼Œæ”¯æŒè‡ªåŠ¨ç®¡ç†å’Œæ‰‹åŠ¨ç®¡ç†ä¸¤ç§ä½¿ç”¨æ–¹å¼ã€‚

**æ³¨æ„**ï¼šæœ¬æ¨¡å—æ˜¯åŸºç¡€è®¾æ–½æ¨¡å—ï¼Œè¢«æ•´ä¸ªé¡¹ç›®å¹¿æ³›ä½¿ç”¨ã€‚æ‰€æœ‰éœ€è¦æ˜¾ç¤ºè¿›åº¦çš„é•¿æ—¶é—´è¿è¡Œæ“ä½œéƒ½ä½¿ç”¨è¿™äº›æŒ‡ç¤ºå™¨ç»„ä»¶ã€‚

**æ¨¡å—ç»Ÿè®¡ï¼š**
- æ€»ä»£ç è¡Œæ•°ï¼šçº¦ 450+ è¡Œ
- æ–‡ä»¶æ•°é‡ï¼š3 ä¸ªæ ¸å¿ƒæ–‡ä»¶
- ä¸»è¦ç»„ä»¶ï¼š2 ä¸ªæŒ‡ç¤ºå™¨ç±»å‹ï¼ˆSpinner, Progressï¼‰
- ä¾èµ–åº“ï¼š`indicatif`ï¼ˆè¿›åº¦æ¡å’Œ spinnerï¼‰

---

## ğŸ“ æ¨¡å—ç»“æ„

### æ ¸å¿ƒæ¨¡å—æ–‡ä»¶

```
src/lib/base/indicator/
â”œâ”€â”€ mod.rs      # æ¨¡å—å£°æ˜å’Œå¯¼å‡º (13è¡Œ)
â”œâ”€â”€ spinner.rs  # Spinner å®ç° (196è¡Œ)
â””â”€â”€ progress.rs # Progress å®ç° (258è¡Œ)
```

### ä¾èµ–æ¨¡å—

- **`indicatif` crate**ï¼šæä¾›è¿›åº¦æ¡å’Œ spinner åŠŸèƒ½
- **`std::time::Duration`**ï¼šæ—¶é—´å¤„ç†

### æ¨¡å—é›†æˆ

Indicator æ¨¡å—è¢«æ‰€æœ‰éœ€è¦æ˜¾ç¤ºè¿›åº¦çš„å‘½ä»¤å¹¿æ³›ä½¿ç”¨ï¼š

- **PR å‘½ä»¤**ï¼šä½¿ç”¨ `Spinner` æ˜¾ç¤ºåˆ›å»º PRã€åŒæ­¥ PR ç­‰æ“ä½œçš„è¿›åº¦
- **Jira å‘½ä»¤**ï¼šä½¿ç”¨ `Spinner` æ˜¾ç¤ºä¸‹è½½é™„ä»¶ã€æ¸…ç†æ—¥å¿—ç­‰æ“ä½œçš„è¿›åº¦
- **Lifecycle å‘½ä»¤**ï¼šä½¿ç”¨ `Progress` æ˜¾ç¤ºä¸‹è½½å’Œå®‰è£…è¿›åº¦
- **Log å‘½ä»¤**ï¼šä½¿ç”¨ `Spinner` æ˜¾ç¤ºä¸‹è½½æ—¥å¿—ã€æœç´¢æ—¥å¿—ç­‰æ“ä½œçš„è¿›åº¦
- **HTTP å®¢æˆ·ç«¯**ï¼šä½¿ç”¨ `Progress` æ˜¾ç¤ºä¸‹è½½è¿›åº¦

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### è®¾è®¡åŸåˆ™

1. **ç»Ÿä¸€æ¥å£**ï¼šæ‰€æœ‰æŒ‡ç¤ºå™¨ä½¿ç”¨ç›¸ä¼¼çš„æ–¹æ³•ï¼ˆ`new()`, `finish()`, `update-_message()`ï¼‰
2. **è‡ªåŠ¨ç®¡ç†**ï¼šæä¾›ä¾¿æ·æ–¹æ³•è‡ªåŠ¨ç®¡ç†æŒ‡ç¤ºå™¨ç”Ÿå‘½å‘¨æœŸ
3. **çµæ´»ä½¿ç”¨**ï¼šæ”¯æŒæ‰‹åŠ¨ç®¡ç†å’Œè‡ªåŠ¨ç®¡ç†ä¸¤ç§æ–¹å¼
4. **ç”¨æˆ·ä½“éªŒ**ï¼šæä¾›æ¸…æ™°çš„è¿›åº¦åé¦ˆ

### æ ¸å¿ƒç»„ä»¶

#### 1. Spinner - ä¸ç¡®å®šè¿›åº¦æŒ‡ç¤ºå™¨

ç”¨äºæ˜¾ç¤ºé•¿æ—¶é—´è¿è¡Œæ“ä½œçš„è¿›åº¦æŒ‡ç¤ºå™¨ï¼Œé€‚ç”¨äºæ— æ³•ç¡®å®šæ€»è¿›åº¦çš„æƒ…å†µã€‚

**ä¸»è¦æ–¹æ³•**ï¼š
- `new(message)` - åˆ›å»ºæ–°çš„ spinner å¹¶ç«‹å³å¼€å§‹æ˜¾ç¤º
- `update-_message(message)` - æ›´æ–°æ˜¾ç¤ºçš„æ¶ˆæ¯
- `finish()` - å®Œæˆå¹¶æ¸…é™¤ spinner
- `finish-_with-_message(message)` - å®Œæˆå¹¶æ˜¾ç¤ºå®Œæˆæ¶ˆæ¯
- `with(message, operation)` - ä½¿ç”¨ spinner æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼ˆè‡ªåŠ¨ç®¡ç†ï¼‰
- `with-_output(message, operation)` - ä½¿ç”¨ spinner æ‰§è¡Œä¼šäº§ç”Ÿè¾“å‡ºçš„æ“ä½œ

**ç‰¹æ€§**ï¼š
- è‡ªåŠ¨å¼€å§‹æ˜¾ç¤º
- æ”¯æŒæ¶ˆæ¯æ›´æ–°
- æ”¯æŒè‡ªåŠ¨ç®¡ç†ï¼ˆä¾¿æ·æ–¹æ³•ï¼‰
- æ”¯æŒå¤„ç†å­è¿›ç¨‹è¾“å‡ºï¼ˆ`with-_output` æ–¹æ³•ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```rust
use workflow::base::indicator::Spinner;

// æ–¹å¼ 1ï¼šæ‰‹åŠ¨ç®¡ç†
let spinner = Spinner::new("Creating PR...");
// æ‰§è¡Œè€—æ—¶æ“ä½œ
spinner.finish();

// æ–¹å¼ 2ï¼šè‡ªåŠ¨ç®¡ç†ï¼ˆæ¨èï¼‰
let result = Spinner::with("Creating PR...", || {
    provider.create-_pull-_request(...)
})?;

// æ–¹å¼ 3ï¼šå¤„ç†ä¼šäº§ç”Ÿè¾“å‡ºçš„æ“ä½œ
Spinner::with-_output("Pushing to remote...", || {
    GitBranch::push(&current-_branch, false)
})?;
log-_success!("Pushed to remote successfully");
```

**è®¾è®¡è¯´æ˜**ï¼š

- `with()` æ–¹æ³•ï¼šè‡ªåŠ¨åˆ›å»º spinnerï¼Œæ‰§è¡Œæ“ä½œï¼Œç„¶åæ¸…ç† spinnerã€‚é€‚ç”¨äºä¸äº§ç”Ÿè¾“å‡ºçš„æ“ä½œã€‚
- `with-_output()` æ–¹æ³•ï¼šå…ˆæ˜¾ç¤º spinner æ¶ˆæ¯ï¼ˆ250msï¼‰ï¼Œç„¶åå®Œæˆ spinnerï¼Œå†æ‰§è¡Œæ“ä½œã€‚è¿™æ ·å¯ä»¥é¿å…å­è¿›ç¨‹çš„è¾“å‡ºä¸ spinner åŠ¨ç”»æ··åˆã€‚é€‚ç”¨äºæ‰§è¡Œä¼šäº§ç”Ÿ stdout/stderr è¾“å‡ºçš„æ“ä½œï¼ˆå¦‚ `git push`ï¼‰ã€‚

#### 2. Progress - ç¡®å®šè¿›åº¦æŒ‡ç¤ºå™¨

ç”¨äºæ˜¾ç¤ºæœ‰æ˜ç¡®è¿›åº¦çš„æ“ä½œï¼ˆå¦‚ä¸‹è½½æ–‡ä»¶ã€å¤„ç†å¤šä¸ªé¡¹ç›®ç­‰ï¼‰ã€‚

**ä¸»è¦æ–¹æ³•**ï¼š
- `new(total, message)` - åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›åº¦æ¡ï¼ˆå·²çŸ¥æ€»æ•°ï¼‰
- `new-_download(total-_bytes, message)` - åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›åº¦æ¡ï¼ˆç”¨äºä¸‹è½½ï¼Œæ˜¾ç¤ºå­—èŠ‚æ•°ï¼‰
- `new-_unknown(message)` - åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›åº¦æ¡ï¼ˆæœªçŸ¥æ€»æ•°ï¼Œä½¿ç”¨ spinner æ¨¡å¼ï¼‰
- `inc(delta)` - å¢åŠ è¿›åº¦ï¼ˆæŒ‰å•ä½æ•°ï¼‰
- `inc-_bytes(delta)` - å¢åŠ è¿›åº¦ï¼ˆæŒ‰å­—èŠ‚æ•°ï¼‰
- `set-_position(pos)` - è®¾ç½®å½“å‰ä½ç½®
- `update-_message(message)` - æ›´æ–°æ˜¾ç¤ºçš„æ¶ˆæ¯
- `finish()` - å®Œæˆå¹¶æ¸…é™¤è¿›åº¦æ¡
- `finish-_ref()` - å®Œæˆå¹¶æ¸…é™¤è¿›åº¦æ¡ï¼ˆä¸éœ€è¦ moveï¼Œç”¨äº Mutex ä¸­ï¼‰
- `finish-_with-_message(message)` - å®Œæˆå¹¶æ˜¾ç¤ºå®Œæˆæ¶ˆæ¯

**ç‰¹æ€§**ï¼š
- æ”¯æŒå·²çŸ¥æ€»æ•°å’ŒæœªçŸ¥æ€»æ•°ä¸¤ç§æ¨¡å¼
- æ”¯æŒä¸‹è½½æ¨¡å¼ï¼ˆæ˜¾ç¤ºå­—èŠ‚æ•°å’Œé€Ÿåº¦ï¼‰
- æ”¯æŒè¿›åº¦æ›´æ–°
- æ”¯æŒæ¶ˆæ¯æ›´æ–°

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```rust
use workflow::base::indicator::Progress;

// æ–¹å¼ 1ï¼šå·²çŸ¥æ€»æ•°
let progress = Progress::new(100, "Downloading files...");
for i in 0..100 {
    // å¤„ç†é¡¹ç›®
    progress.inc(1);
}
progress.finish();

// æ–¹å¼ 2ï¼šä¸‹è½½æ¨¡å¼ï¼ˆæ˜¾ç¤ºå­—èŠ‚æ•°ï¼‰
let progress = Progress::new-_download(1024 * 1024, "Downloading...");
progress.inc-_bytes(1024);
progress.finish();

// æ–¹å¼ 3ï¼šæœªçŸ¥æ€»æ•°ï¼ˆä½¿ç”¨ spinner æ¨¡å¼ï¼‰
let progress = Progress::new-_unknown("Downloading...");
// æ‰§è¡Œæ“ä½œ
progress.finish();
```

**è¿›åº¦æ¡æ ·å¼**ï¼š

å·²çŸ¥æ€»æ•°æ¨¡å¼ï¼š
```
â ‹ [00:01] [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 50/100 (50%) Downloading files...
```

ä¸‹è½½æ¨¡å¼ï¼š
```
â ‹ [00:01] [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 512KB/1MB (512KB/s, ETA: 1s) Downloading...
```

æœªçŸ¥æ€»æ•°æ¨¡å¼ï¼š
```
â ‹ [00:01] Downloading...
```

### è®¾è®¡æ¨¡å¼

#### è‡ªåŠ¨ç®¡ç†è®¾è®¡

æä¾›ä¾¿æ·æ–¹æ³•è‡ªåŠ¨ç®¡ç†æŒ‡ç¤ºå™¨ç”Ÿå‘½å‘¨æœŸï¼š

```rust
// Spinner è‡ªåŠ¨ç®¡ç†
let result = Spinner::with("Creating PR...", || {
    provider.create-_pull-_request(...)
})?;

// Progress éœ€è¦æ‰‹åŠ¨ç®¡ç†ï¼ˆå› ä¸ºéœ€è¦æ›´æ–°è¿›åº¦ï¼‰
let progress = Progress::new(100, "Processing...");
for item in items {
    process-_item(item);
    progress.inc(1);
}
progress.finish();
```

**ä¼˜åŠ¿**ï¼š
- ç®€åŒ–ä»£ç 
- è‡ªåŠ¨æ¸…ç†èµ„æº
- å‡å°‘é”™è¯¯ï¼ˆä¸ä¼šå¿˜è®°è°ƒç”¨ `finish()`ï¼‰

#### é”™è¯¯å¤„ç†ç­–ç•¥

æŒ‡ç¤ºå™¨æœ¬èº«ä¸å¤„ç†é”™è¯¯ï¼Œé”™è¯¯ç”±è°ƒç”¨è€…å¤„ç†ï¼š

```rust
let result = Spinner::with("Creating PR...", || {
    provider.create-_pull-_request(...)
})?;
// å¦‚æœæ“ä½œå¤±è´¥ï¼Œspinner ä¼šè‡ªåŠ¨æ¸…ç†
```

**ä¼˜åŠ¿**ï¼š
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ–¹å¼
- ä½¿ç”¨ `?` æ“ä½œç¬¦ç®€åŒ–é”™è¯¯ä¼ æ’­
- è‡ªåŠ¨æ¸…ç†èµ„æº

---

## ğŸ”„ è°ƒç”¨æµç¨‹ä¸æ•°æ®æµ

### æ•´ä½“æ¶æ„æµç¨‹

```
åº”ç”¨å±‚ï¼ˆå‘½ä»¤ã€æ¨¡å—ï¼‰
  â†“
Indicator APIï¼ˆSpinner, Progressï¼‰
  â†“
indicatif åº“ï¼ˆåº•å±‚è¿›åº¦æ˜¾ç¤ºï¼‰
  â†“
ç»ˆç«¯è¾“å‡º
```

### æ•°æ®æµ

#### Spinner æµç¨‹

```
Spinner::new("message")
  â†“
ç«‹å³å¼€å§‹æ˜¾ç¤ºåŠ¨ç”»
  â†“
æ‰§è¡Œæ“ä½œï¼ˆæ‰‹åŠ¨æˆ–é€šè¿‡ with()ï¼‰
  â†“
finish() æˆ– finish-_with-_message()
  â†“
æ¸…é™¤æ˜¾ç¤º
```

#### Progress æµç¨‹

```
Progress::new(total, "message")
  â†“
å¼€å§‹æ˜¾ç¤ºè¿›åº¦æ¡
  â†“
inc(delta) æˆ– set-_position(pos)  // æ›´æ–°è¿›åº¦
  â†“
update-_message("new message")  // å¯é€‰ï¼šæ›´æ–°æ¶ˆæ¯
  â†“
finish() æˆ– finish-_with-_message()
  â†“
æ¸…é™¤æ˜¾ç¤º
```

### ä¸å…¶ä»–æ¨¡å—çš„é›†æˆ

Indicator æ¨¡å—æ˜¯åŸºç¡€è®¾æ–½æ¨¡å—ï¼Œè¢«æ•´ä¸ªé¡¹ç›®å¹¿æ³›ä½¿ç”¨ï¼š

- **CLI å‘½ä»¤å±‚**ï¼šæ‰€æœ‰éœ€è¦æ˜¾ç¤ºè¿›åº¦çš„å‘½ä»¤ä½¿ç”¨æŒ‡ç¤ºå™¨
- **HTTP å®¢æˆ·ç«¯**ï¼šä½¿ç”¨ `Progress` æ˜¾ç¤ºä¸‹è½½è¿›åº¦
- **Git æ“ä½œ**ï¼šä½¿ç”¨ `Spinner` æ˜¾ç¤º Git æ“ä½œè¿›åº¦
- **Jira æ“ä½œ**ï¼šä½¿ç”¨ `Spinner` æ˜¾ç¤º Jira API è°ƒç”¨è¿›åº¦
- **PR æ“ä½œ**ï¼šä½¿ç”¨ `Spinner` æ˜¾ç¤º PR åˆ›å»ºã€åŒæ­¥ç­‰æ“ä½œè¿›åº¦

**ä¾èµ–å…³ç³»**ï¼š

```
indicator (åŸºç¡€è®¾æ–½)
  â†“
æ‰€æœ‰ä¸šåŠ¡æ¨¡å—ï¼ˆcommands, lib/*ï¼‰
```

---

## ğŸ“ æ‰©å±•æ€§

### æ·»åŠ æ–°çš„æŒ‡ç¤ºå™¨ç±»å‹

1. åœ¨ `indicator/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æ¨¡å—æ–‡ä»¶ï¼ˆå¦‚ `gauge.rs`ï¼‰
2. å®ç°æŒ‡ç¤ºå™¨ç»“æ„ä½“å’Œç›¸å…³æ–¹æ³•
3. åœ¨ `mod.rs` ä¸­å£°æ˜æ¨¡å—å¹¶é‡æ–°å¯¼å‡º
4. åœ¨ `src/lib/base/mod.rs` ä¸­æ·»åŠ åˆ°å…¨å±€å¯¼å‡ºï¼ˆå¦‚æœéœ€è¦ï¼‰

### è‡ªå®šä¹‰è¿›åº¦æ¡æ ·å¼

å¯ä»¥é€šè¿‡ä¿®æ”¹ `ProgressStyle` æ¥è‡ªå®šä¹‰è¿›åº¦æ¡æ ·å¼ï¼š

```rust
let pb = ProgressBar::new(total);
pb.set-_style(
    ProgressStyle::default-_bar()
        .template("{spinner:.green} [{elapsed-_precise}] [{wide-_bar:.cyan/blue}] {pos}/{len} ({percent}%) {msg}")
        .unwrap()
        .progress-_chars("#>-"),
);
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ€»ä½“æ¶æ„æ–‡æ¡£](../architecture.md)
- [TOOLS æ¨¡å—æ¶æ„æ–‡æ¡£](./tools.md)
- [Dialog æ¨¡å—æ¶æ„æ–‡æ¡£](./DIALOG_architecture.md)

---

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### Spinner ä½¿ç”¨

```rust
use workflow::base::indicator::Spinner;

// æ‰‹åŠ¨ç®¡ç†
let spinner = Spinner::new("Creating PR...");
// æ‰§è¡Œæ“ä½œ
spinner.finish();

// è‡ªåŠ¨ç®¡ç†
let result = Spinner::with("Creating PR...", || {
    provider.create-_pull-_request(...)
})?;

// å¤„ç†ä¼šäº§ç”Ÿè¾“å‡ºçš„æ“ä½œ
Spinner::with-_output("Pushing to remote...", || {
    GitBranch::push(&current-_branch, false)
})?;
log-_success!("Pushed to remote successfully");
```

### Progress ä½¿ç”¨

```rust
use workflow::base::indicator::Progress;

// å·²çŸ¥æ€»æ•°
let progress = Progress::new(100, "Downloading files...");
for i in 0..100 {
    progress.inc(1);
}
progress.finish();

// ä¸‹è½½æ¨¡å¼
let progress = Progress::new-_download(1024 * 1024, "Downloading...");
progress.inc-_bytes(1024);
progress.finish();

// æœªçŸ¥æ€»æ•°
let progress = Progress::new-_unknown("Downloading...");
progress.finish();
```

---

## âœ… æ€»ç»“

Indicator æ¨¡å—ä¸ºæ•´ä¸ªé¡¹ç›®æä¾›ç»Ÿä¸€çš„è¿›åº¦æŒ‡ç¤ºå™¨åŠŸèƒ½ï¼š

1. **Spinner**ï¼šä¸ç¡®å®šè¿›åº¦æŒ‡ç¤ºå™¨ï¼Œæ”¯æŒè‡ªåŠ¨ç®¡ç†å’Œæ‰‹åŠ¨ç®¡ç†
2. **Progress**ï¼šç¡®å®šè¿›åº¦æŒ‡ç¤ºå™¨ï¼Œæ”¯æŒå·²çŸ¥æ€»æ•°ã€ä¸‹è½½æ¨¡å¼å’ŒæœªçŸ¥æ€»æ•°æ¨¡å¼

**è®¾è®¡ä¼˜åŠ¿**ï¼š
- âœ… **æ˜“ç”¨æ€§**ï¼šç®€æ´çš„ APIï¼Œæ”¯æŒè‡ªåŠ¨ç®¡ç†
- âœ… **çµæ´»æ€§**ï¼šæ”¯æŒæ‰‹åŠ¨ç®¡ç†å’Œè‡ªåŠ¨ç®¡ç†ä¸¤ç§æ–¹å¼
- âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šæä¾›æ¸…æ™°çš„è¿›åº¦åé¦ˆ
- âœ… **èµ„æºç®¡ç†**ï¼šè‡ªåŠ¨æ¸…ç†èµ„æºï¼Œå‡å°‘é”™è¯¯
- âœ… **é€‚åº”æ€§**ï¼šæ”¯æŒå¤„ç†å­è¿›ç¨‹è¾“å‡ºï¼ˆ`with-_output` æ–¹æ³•ï¼‰

---

**æœ€åæ›´æ–°**: 2025-12-16
