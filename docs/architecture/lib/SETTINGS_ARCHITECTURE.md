# Settings æ¨¡å—æ¶æ„æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿° Workflow CLI çš„ Settings æ¨¡å—æ¶æ„ï¼ŒåŒ…æ‹¬ï¼š
- TOML é…ç½®æ–‡ä»¶çš„åŠ è½½å’Œç®¡ç†
- é…ç½®ç»“æ„ä½“å®šä¹‰ï¼ˆJiraã€GitHubã€æ—¥å¿—ã€LLMã€Codeupï¼‰
- è·¯å¾„ç®¡ç†ï¼ˆé…ç½®æ–‡ä»¶è·¯å¾„ã€å®‰è£…è·¯å¾„ã€Shell è·¯å¾„ï¼‰
- é»˜è®¤å€¼ç®¡ç†
- é…ç½®éªŒè¯åŠŸèƒ½

è¯¥æ¨¡å—ä¸ºæ•´ä¸ªåº”ç”¨æä¾›ç»Ÿä¸€çš„é…ç½®ç®¡ç†åŸºç¡€è®¾æ–½ï¼Œæ‰€æœ‰æ¨¡å—éƒ½é€šè¿‡ `Settings::get()` è·å–é…ç½®ã€‚

**æ¨¡å—ç»Ÿè®¡ï¼š**
- æ€»ä»£ç è¡Œæ•°ï¼šçº¦ 800 è¡Œ
- æ–‡ä»¶æ•°é‡ï¼š4 ä¸ªæ ¸å¿ƒæ–‡ä»¶
- ä¸»è¦ç»„ä»¶ï¼š3 ä¸ªï¼ˆSettings, Paths, defaultsï¼‰
- é…ç½®æ–‡ä»¶ï¼šworkflow.toml, llm.toml

---

## ğŸ“ æ¨¡å—ç»“æ„

### æ ¸å¿ƒæ¨¡å—æ–‡ä»¶

```
src/lib/base/settings/
â”œâ”€â”€ mod.rs          # æ¨¡å—å£°æ˜å’Œå¯¼å‡º (11è¡Œ)
â”œâ”€â”€ settings.rs     # Settings ç»“æ„ä½“å’Œé…ç½®åŠ è½½ (440è¡Œ)
â”œâ”€â”€ paths.rs        # è·¯å¾„ç®¡ç† (297è¡Œ)
â””â”€â”€ defaults.rs     # é»˜è®¤å€¼è¾…åŠ©å‡½æ•° (52è¡Œ)
```

### ä¾èµ–æ¨¡å—

- **`lib/base/http/`**ï¼šHTTP å®¢æˆ·ç«¯ï¼ˆç”¨äºé…ç½®éªŒè¯ï¼‰
- **`lib/jira/`**ï¼šJira ç±»å‹å®šä¹‰ï¼ˆç”¨äºé…ç½®éªŒè¯ï¼‰
- **`lib/pr/`**ï¼šGitHub å®¢æˆ·ç«¯ï¼ˆç”¨äºé…ç½®éªŒè¯ï¼‰
- **`lib/base/util/`**ï¼šå·¥å…·å‡½æ•°ï¼ˆæ—¥å¿—å®ã€æ•æ„Ÿå€¼æ©ç ï¼‰

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### è®¾è®¡åŸåˆ™

1. **å•ä¾‹æ¨¡å¼**ï¼šä½¿ç”¨ `OnceLock` å®ç°çº¿ç¨‹å®‰å…¨çš„å…¨å±€å•ä¾‹ï¼Œé…ç½®åªåŠ è½½ä¸€æ¬¡
2. **é»˜è®¤å€¼ä¼˜å…ˆ**ï¼šé…ç½®æ–‡ä»¶ä¸å­˜åœ¨æˆ–å­—æ®µç¼ºå¤±æ—¶ä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸ä¸­æ–­ç¨‹åºè¿è¡Œ
3. **ç»Ÿä¸€è·¯å¾„ç®¡ç†**ï¼šæ‰€æœ‰è·¯å¾„é€šè¿‡ `Paths` ç»Ÿä¸€ç®¡ç†ï¼Œé¿å…ç¡¬ç¼–ç 
4. **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨ Rust ç±»å‹ç³»ç»Ÿä¿è¯é…ç½®ç»“æ„ä½“çš„ç±»å‹å®‰å…¨
5. **é…ç½®éªŒè¯**ï¼šæä¾›é…ç½®éªŒè¯åŠŸèƒ½ï¼Œç¡®ä¿é…ç½®æ­£ç¡®æ€§

### æ ¸å¿ƒç»„ä»¶

#### 1. Settingsï¼ˆé…ç½®ç»“æ„ä½“ï¼‰

**èŒè´£**ï¼šå®šä¹‰æ‰€æœ‰é…ç½®ç»“æ„ä½“å’Œé…ç½®åŠ è½½é€»è¾‘

**ä½ç½®**ï¼š`src/lib/base/settings/settings.rs`

**ä¸»è¦ç»“æ„ä½“**ï¼š
- `Settings` - ä¸»é…ç½®ç»“æ„ä½“ï¼ˆåŒ…å«æ‰€æœ‰å­é…ç½®ï¼‰
- `JiraSettings` - Jira é…ç½®
- `GitHubSettings` - GitHub é…ç½®ï¼ˆæ”¯æŒå¤šè´¦å·ï¼‰
- `GitHubAccount` - GitHub è´¦å·é…ç½®
- `LogSettings` - æ—¥å¿—é…ç½®
- `LLMSettings` - LLM é…ç½®
- `CodeupSettings` - Codeup é…ç½®

**å…³é”®æ–¹æ³•**ï¼š
- `Settings::get()` - è·å–ç¼“å­˜çš„å…¨å±€å•ä¾‹ï¼ˆæ¨èä½¿ç”¨ï¼‰
- `Settings::load()` - ä» TOML æ–‡ä»¶åŠ è½½é…ç½®
- `Settings::verify()` - éªŒè¯å¹¶æ˜¾ç¤ºæ‰€æœ‰é…ç½®

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… **å•ä¾‹æ¨¡å¼**ï¼šä½¿ç”¨ `OnceLock` å®ç°çº¿ç¨‹å®‰å…¨çš„å…¨å±€å•ä¾‹
- âœ… **è‡ªåŠ¨åŠ è½½**ï¼šé¦–æ¬¡è°ƒç”¨æ—¶è‡ªåŠ¨ä» TOML æ–‡ä»¶åŠ è½½
- âœ… **é»˜è®¤å€¼æ”¯æŒ**ï¼šä½¿ç”¨ `#[serde(default)]` å’Œ `Default` trait
- âœ… **é…ç½®éªŒè¯**ï¼šæä¾› Jira å’Œ GitHub é…ç½®éªŒè¯åŠŸèƒ½
- âœ… **æƒé™æ£€æŸ¥**ï¼šUnix ç³»ç»Ÿä¸‹æ£€æŸ¥é…ç½®æ–‡ä»¶æƒé™ï¼ˆå»ºè®® 600ï¼‰

#### 2. Pathsï¼ˆè·¯å¾„ç®¡ç†å™¨ï¼‰

**èŒè´£**ï¼šç»Ÿä¸€ç®¡ç†æ‰€æœ‰è·¯å¾„ä¿¡æ¯

**ä½ç½®**ï¼š`src/lib/base/settings/paths.rs`

**è·¯å¾„åˆ†ç±»**ï¼š
- **é…ç½®è·¯å¾„**ï¼šé…ç½®æ–‡ä»¶ç›®å½•å’Œæ–‡ä»¶è·¯å¾„
- **å®‰è£…è·¯å¾„**ï¼šäºŒè¿›åˆ¶æ–‡ä»¶å’Œè¡¥å…¨è„šæœ¬è·¯å¾„
- **Shell è·¯å¾„**ï¼šShell é…ç½®æ–‡ä»¶å’Œ completion ç›®å½•

**å…³é”®æ–¹æ³•**ï¼š
- **é…ç½®è·¯å¾„**ï¼š
  - `config_dir()` - è·å–é…ç½®ç›®å½•ï¼ˆ`~/.workflow/config/`ï¼‰
  - `workflow_config()` - è·å–ä¸»é…ç½®æ–‡ä»¶è·¯å¾„
  - `llm_config()` - è·å– LLM é…ç½®æ–‡ä»¶è·¯å¾„
  - `jira_status_config()` - è·å– Jira çŠ¶æ€é…ç½®æ–‡ä»¶è·¯å¾„
  - `jira_users_config()` - è·å– Jira ç”¨æˆ·é…ç½®æ–‡ä»¶è·¯å¾„
  - `workflow_dir()` - è·å–å·¥ä½œæµç›®å½•ï¼ˆ`~/.workflow/`ï¼‰
  - `work_history_dir()` - è·å–å·¥ä½œå†å²è®°å½•ç›®å½•
- **å®‰è£…è·¯å¾„**ï¼š
  - `command_names()` - è·å–æ‰€æœ‰å‘½ä»¤åç§°
  - `binary_install_dir()` - è·å–äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ç›®å½•
  - `binary_paths()` - è·å–æ‰€æœ‰äºŒè¿›åˆ¶æ–‡ä»¶å®Œæ•´è·¯å¾„
  - `completion_dir()` - è·å– completion ç›®å½•è·¯å¾„
- **Shell è·¯å¾„**ï¼š
  - `config_file(shell)` - è·å– Shell é…ç½®æ–‡ä»¶è·¯å¾„

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… **è‡ªåŠ¨åˆ›å»ºç›®å½•**ï¼šè·¯å¾„ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»º
- âœ… **æƒé™ç®¡ç†**ï¼šUnix ç³»ç»Ÿä¸‹è‡ªåŠ¨è®¾ç½®ç›®å½•æƒé™ï¼ˆ700ï¼‰
- âœ… **å¤š Shell æ”¯æŒ**ï¼šæ”¯æŒ zshã€bashã€fishã€powershellã€elvish
- âœ… **è·¯å¾„ç»Ÿä¸€ç®¡ç†**ï¼šæ‰€æœ‰è·¯å¾„é›†ä¸­ç®¡ç†ï¼Œé¿å…ç¡¬ç¼–ç 

#### 3. defaultsï¼ˆé»˜è®¤å€¼æ¨¡å—ï¼‰

**èŒè´£**ï¼šæä¾›é…ç½®ç»“æ„ä½“çš„é»˜è®¤å€¼å®ç°å’Œè¾…åŠ©å‡½æ•°

**ä½ç½®**ï¼š`src/lib/base/settings/defaults.rs`

**ä¸»è¦å‡½æ•°**ï¼š
- `default_log_folder()` - é»˜è®¤æ—¥å¿—æ–‡ä»¶å¤¹åç§°ï¼ˆ"logs"ï¼‰
- `default_download_base_dir()` - é»˜è®¤ä¸‹è½½åŸºç¡€ç›®å½•
- `default_download_base_dir_option()` - é»˜è®¤ä¸‹è½½åŸºç¡€ç›®å½•ï¼ˆOption ç±»å‹ï¼‰
- `default_log_settings()` - é»˜è®¤ LogSettings å®ä¾‹
- `default_response_format()` - é»˜è®¤ LLM å“åº”æ ¼å¼è·¯å¾„
- `default_llm_provider()` - é»˜è®¤ LLM Providerï¼ˆ"openai"ï¼‰
- `default_llm_model(provider)` - æ ¹æ® Provider è·å–é»˜è®¤æ¨¡å‹

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… **é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰é»˜è®¤å€¼é›†ä¸­åœ¨ä¸€ä¸ªæ¨¡å—
- âœ… **Provider ç‰¹å®šé»˜è®¤å€¼**ï¼šLLM æ¨¡å‹æ ¹æ® Provider æä¾›ä¸åŒé»˜è®¤å€¼

---

## ğŸ”„ è°ƒç”¨æµç¨‹

### æ•´ä½“æ¶æ„æµç¨‹

```
åº”ç”¨å¯åŠ¨æˆ–é¦–æ¬¡ä½¿ç”¨
  â†“
Settings::get() (è·å–å…¨å±€å•ä¾‹)
  â†“
Settings::load() (ä» TOML æ–‡ä»¶åŠ è½½)
  â”œâ”€ Paths::workflow_config() (è·å–é…ç½®æ–‡ä»¶è·¯å¾„)
  â”œâ”€ æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
  â”œâ”€ è¯»å– TOML æ–‡ä»¶å†…å®¹
  â”œâ”€ è§£æä¸º Settings ç»“æ„ä½“
  â””â”€ ä½¿ç”¨é»˜è®¤å€¼å¡«å……ç¼ºå¤±å­—æ®µ
  â†“
ç¼“å­˜åˆ° OnceLockï¼ˆå•ä¾‹ï¼‰
  â†“
è¿”å› Settings å¼•ç”¨
```

### é…ç½®åŠ è½½æµç¨‹

```
Settings::load()
  â†“
1. Paths::workflow_config()              # è·å–é…ç½®æ–‡ä»¶è·¯å¾„
  â†“
2. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
  â”œâ”€ ä¸å­˜åœ¨ â†’ è¿”å›é»˜è®¤å€¼
  â””â”€ å­˜åœ¨ â†’ ç»§ç»­
  â†“
3. æ£€æŸ¥æ–‡ä»¶æƒé™ï¼ˆUnix ç³»ç»Ÿï¼‰
  â”œâ”€ æƒé™è¿‡å®½ â†’ è­¦å‘Š
  â””â”€ ç»§ç»­
  â†“
4. è¯»å–æ–‡ä»¶å†…å®¹
  â”œâ”€ è¯»å–å¤±è´¥ â†’ è¿”å›é»˜è®¤å€¼
  â””â”€ æˆåŠŸ â†’ ç»§ç»­
  â†“
5. è§£æ TOML
  â”œâ”€ è§£æå¤±è´¥ â†’ è¿”å›é»˜è®¤å€¼
  â””â”€ æˆåŠŸ â†’ ä½¿ç”¨ #[serde(default)] å¡«å……ç¼ºå¤±å­—æ®µ
  â†“
6. è¿”å› Settings å®ä¾‹
```

### é…ç½®éªŒè¯æµç¨‹

```
Settings::verify()
  â†“
1. print_log()                            # æ˜¾ç¤ºæ—¥å¿—é…ç½®
2. print_llm()                            # æ˜¾ç¤º LLM é…ç½®
3. verify_codeup()                        # æ˜¾ç¤º Codeup é…ç½®
4. verify_jira()                          # éªŒè¯ Jira é…ç½®
  â”œâ”€ æ£€æŸ¥é…ç½®æ˜¯å¦å®Œæ•´
  â”œâ”€ å‘é€ HTTP è¯·æ±‚éªŒè¯
  â””â”€ æ˜¾ç¤ºéªŒè¯ç»“æœ
5. verify_github()                        # éªŒè¯ GitHub é…ç½®
  â”œâ”€ éå†æ‰€æœ‰è´¦å·
  â”œâ”€ ä½¿ç”¨ API Token éªŒè¯æ¯ä¸ªè´¦å·
  â””â”€ æ˜¾ç¤ºéªŒè¯ç»“æœ
```

---

## ğŸ“¦ æ¨¡å—èŒè´£

### Settings

**èŒè´£**ï¼šé…ç½®ç»“æ„ä½“å®šä¹‰å’Œé…ç½®åŠ è½½

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- å®šä¹‰æ‰€æœ‰é…ç½®ç»“æ„ä½“ï¼ˆJiraã€GitHubã€æ—¥å¿—ã€LLMã€Codeupï¼‰
- ä» TOML æ–‡ä»¶åŠ è½½é…ç½®
- æä¾›å…¨å±€å•ä¾‹è®¿é—®
- é…ç½®éªŒè¯åŠŸèƒ½

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ‰€æœ‰éœ€è¦è¯»å–é…ç½®çš„æ¨¡å—éƒ½ä½¿ç”¨ `Settings::get()`
- é…ç½®éªŒè¯å‘½ä»¤ä½¿ç”¨ `Settings::verify()`

### Paths

**èŒè´£**ï¼šç»Ÿä¸€ç®¡ç†æ‰€æœ‰è·¯å¾„ä¿¡æ¯

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- é…ç½®æ–‡ä»¶è·¯å¾„ç®¡ç†
- å®‰è£…è·¯å¾„ç®¡ç†
- Shell è·¯å¾„ç®¡ç†
- è‡ªåŠ¨åˆ›å»ºç›®å½•å’Œè®¾ç½®æƒé™

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ‰€æœ‰éœ€è¦è·å–è·¯å¾„çš„æ¨¡å—éƒ½ä½¿ç”¨ `Paths::xxx()`
- é…ç½®æ–‡ä»¶è¯»å†™æ—¶è·å–è·¯å¾„
- å®‰è£…/æ›´æ–°æ—¶è·å–å®‰è£…è·¯å¾„

### defaults

**èŒè´£**ï¼šæä¾›é»˜è®¤å€¼å®ç°

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- é…ç½®ç»“æ„ä½“çš„é»˜è®¤å€¼å‡½æ•°
- Provider ç‰¹å®šçš„é»˜è®¤å€¼ï¼ˆå¦‚ LLM æ¨¡å‹ï¼‰

**ä½¿ç”¨åœºæ™¯**ï¼š
- é…ç½®ç»“æ„ä½“ä½¿ç”¨ `#[serde(default = "default_xxx")]` æ—¶è°ƒç”¨
- é…ç½®ç¼ºå¤±æ—¶ä½¿ç”¨é»˜è®¤å€¼

---

## ğŸ”— ä¸å…¶ä»–æ¨¡å—çš„é›†æˆ

### ä½¿ç”¨åœºæ™¯

- **é…ç½®è¯»å–**ï¼šæ‰€æœ‰æ¨¡å—é€šè¿‡ `Settings::get()` è·å–é…ç½®
- **é…ç½®éªŒè¯**ï¼šä½¿ç”¨ `Settings::verify()` éªŒè¯é…ç½®æ­£ç¡®æ€§
- **è·¯å¾„è·å–**ï¼šä½¿ç”¨ `Paths::workflow_config()` ç­‰è·å–é…ç½®æ–‡ä»¶è·¯å¾„

### LLM æ¨¡å—

- **`lib/base/llm/`**ï¼šLLM å®¢æˆ·ç«¯
  - `Settings::get().llm` - è·å– LLM é…ç½®
  - `Paths::llm_config()` - è·å– LLM é…ç½®æ–‡ä»¶è·¯å¾„

### Jira æ¨¡å—

- **`lib/jira/`**ï¼šJira å®¢æˆ·ç«¯
  - `Settings::get().jira` - è·å– Jira é…ç½®
  - `Paths::jira_status_config()` - è·å– Jira çŠ¶æ€é…ç½®æ–‡ä»¶è·¯å¾„
  - `Paths::jira_users_config()` - è·å– Jira ç”¨æˆ·é…ç½®æ–‡ä»¶è·¯å¾„

### PR æ¨¡å—

- **`lib/pr/`**ï¼šPR å¹³å°æŠ½è±¡
  - `Settings::get().github` - è·å– GitHub é…ç½®
  - `Settings::get().codeup` - è·å– Codeup é…ç½®

### Shell æ¨¡å—

- **`lib/base/shell/`**ï¼šShell é…ç½®ç®¡ç†
  - `Paths::config_file(shell)` - è·å– Shell é…ç½®æ–‡ä»¶è·¯å¾„
  - `Paths::completion_dir()` - è·å– completion ç›®å½•è·¯å¾„

### Completion æ¨¡å—

- **`lib/completion/`**ï¼šCompletion ç®¡ç†
  - `Paths::completion_dir()` - è·å– completion ç›®å½•è·¯å¾„

### Rollback æ¨¡å—

- **`lib/rollback/`**ï¼šå›æ»šç®¡ç†
  - `Paths::completion_dir()` - è·å– completion ç›®å½•è·¯å¾„ï¼ˆç”¨äºå¤‡ä»½ï¼‰

---

## ğŸ¯ è®¾è®¡æ¨¡å¼

### 1. å•ä¾‹æ¨¡å¼

é€šè¿‡ `OnceLock` å®ç°çº¿ç¨‹å®‰å…¨çš„å…¨å±€å•ä¾‹ï¼š

```rust
pub fn get() -> &'static Settings {
    static SETTINGS: OnceLock<Settings> = OnceLock::new();
    SETTINGS.get_or_init(Self::load)
}
```

**ä¼˜åŠ¿**ï¼š
- é…ç½®åªåŠ è½½ä¸€æ¬¡ï¼Œæé«˜æ€§èƒ½
- çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å®‰å…¨ä½¿ç”¨
- ç»Ÿä¸€ç®¡ç†ï¼Œæ‰€æœ‰æ¨¡å—ä½¿ç”¨åŒä¸€ä¸ªé…ç½®å®ä¾‹

### 2. é»˜è®¤å€¼æ¨¡å¼

ä½¿ç”¨ `#[serde(default)]` å’Œ `Default` trait æä¾›é»˜è®¤å€¼ï¼š

```rust
#[derive(Debug, Clone, Default, Serialize, Deserialize)]
pub struct Settings {
    #[serde(default)]
    pub jira: JiraSettings,
    // ...
}
```

**ä¼˜åŠ¿**ï¼š
- é…ç½®æ–‡ä»¶ä¸å­˜åœ¨æˆ–å­—æ®µç¼ºå¤±æ—¶ä½¿ç”¨é»˜è®¤å€¼
- ä¸ä¸­æ–­ç¨‹åºè¿è¡Œ
- æä¾›åˆç†çš„é»˜è®¤å€¼ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

### 3. è·¯å¾„ç»Ÿä¸€ç®¡ç†æ¨¡å¼

é€šè¿‡ `Paths` ç»“æ„ä½“ç»Ÿä¸€ç®¡ç†æ‰€æœ‰è·¯å¾„ï¼š

```rust
pub struct Paths;

impl Paths {
    pub fn workflow_config() -> Result<PathBuf> { ... }
    pub fn completion_dir() -> Result<PathBuf> { ... }
    // ...
}
```

**ä¼˜åŠ¿**ï¼š
- é¿å…ç¡¬ç¼–ç è·¯å¾„
- é›†ä¸­ç®¡ç†ï¼Œæ˜“äºç»´æŠ¤
- è‡ªåŠ¨åˆ›å»ºç›®å½•å’Œè®¾ç½®æƒé™

---

## ğŸ” é”™è¯¯å¤„ç†

### åˆ†å±‚é”™è¯¯å¤„ç†

1. **è·¯å¾„è·å–å¤±è´¥**ï¼š
   - `HOME` ç¯å¢ƒå˜é‡æœªè®¾ç½®ï¼šè¿”å›é”™è¯¯
   - ç›®å½•åˆ›å»ºå¤±è´¥ï¼šè¿”å›é”™è¯¯

2. **é…ç½®æ–‡ä»¶è¯»å–å¤±è´¥**ï¼š
   - æ–‡ä»¶ä¸å­˜åœ¨ï¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸æŠ¥é”™
   - è¯»å–å¤±è´¥ï¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸æŠ¥é”™
   - è§£æå¤±è´¥ï¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸æŠ¥é”™

3. **é…ç½®éªŒè¯å¤±è´¥**ï¼š
   - Jira éªŒè¯å¤±è´¥ï¼šæ˜¾ç¤ºè­¦å‘Šï¼Œä¸ä¸­æ–­æµç¨‹
   - GitHub éªŒè¯å¤±è´¥ï¼šæ˜¾ç¤ºè­¦å‘Šï¼Œä¸ä¸­æ–­æµç¨‹

### å®¹é”™æœºåˆ¶

- **é…ç½®æ–‡ä»¶ä¸å­˜åœ¨**ï¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸æŠ¥é”™
- **å­—æ®µç¼ºå¤±**ï¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸æŠ¥é”™
- **TOML è§£æå¤±è´¥**ï¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸æŠ¥é”™
- **é…ç½®éªŒè¯å¤±è´¥**ï¼šæ˜¾ç¤ºè­¦å‘Šï¼Œä¸ä¸­æ–­æµç¨‹

---

## ğŸ“Š æ•°æ®æµ

### é…ç½®åŠ è½½æ•°æ®æµ

```
workflow.toml (TOML æ–‡ä»¶)
  â†“
fs::read_to_string() (è¯»å–æ–‡ä»¶)
  â†“
toml::from_str() (è§£æ TOML)
  â†“
Settings ç»“æ„ä½“ï¼ˆä½¿ç”¨ #[serde(default)] å¡«å……ç¼ºå¤±å­—æ®µï¼‰
  â†“
OnceLock ç¼“å­˜ï¼ˆå•ä¾‹ï¼‰
  â†“
Settings::get() (è¿”å›å¼•ç”¨)
```

### é…ç½®éªŒè¯æ•°æ®æµ

```
Settings::verify()
  â†“
æ˜¾ç¤ºé…ç½®ï¼ˆprint_log, print_llm, verify_codeupï¼‰
  â†“
éªŒè¯ Jiraï¼ˆverify_jiraï¼‰
  â”œâ”€ HttpClient::global() (å‘é€ HTTP è¯·æ±‚)
  â””â”€ æ˜¾ç¤ºéªŒè¯ç»“æœ
  â†“
éªŒè¯ GitHubï¼ˆverify_githubï¼‰
  â”œâ”€ GitHub::get_user_info() (éªŒè¯æ¯ä¸ªè´¦å·)
  â””â”€ æ˜¾ç¤ºéªŒè¯ç»“æœ
```

---

## ğŸ“ æ‰©å±•æ€§

### æ·»åŠ æ–°é…ç½®é¡¹

1. åœ¨ `settings.rs` ä¸­æ·»åŠ æ–°çš„é…ç½®ç»“æ„ä½“ï¼ˆå¦‚ `NewSettings`ï¼‰
2. åœ¨ `Settings` ç»“æ„ä½“ä¸­æ·»åŠ æ–°å­—æ®µï¼ˆä½¿ç”¨ `#[serde(default)]`ï¼‰
3. åœ¨ `defaults.rs` ä¸­æ·»åŠ é»˜è®¤å€¼å‡½æ•°ï¼ˆå¦‚éœ€è¦ï¼‰
4. åœ¨ `Settings::verify()` ä¸­æ·»åŠ éªŒè¯é€»è¾‘ï¼ˆå¦‚éœ€è¦ï¼‰

**ç¤ºä¾‹**ï¼š
```rust
// settings.rs
#[derive(Debug, Clone, Default, Serialize, Deserialize)]
pub struct NewSettings {
    pub key: Option<String>,
}

#[derive(Debug, Clone, Default, Serialize, Deserialize)]
pub struct Settings {
    // ...
    #[serde(default)]
    pub new: NewSettings,
}
```

### æ·»åŠ æ–°è·¯å¾„

1. åœ¨ `paths.rs` çš„ `Paths` å®ç°ä¸­æ·»åŠ æ–°æ–¹æ³•
2. ä½¿ç”¨ `config_dir()` æˆ– `workflow_dir()` ä½œä¸ºåŸºç¡€è·¯å¾„
3. è‡ªåŠ¨åˆ›å»ºç›®å½•å’Œè®¾ç½®æƒé™ï¼ˆå¦‚éœ€è¦ï¼‰

**ç¤ºä¾‹**ï¼š
```rust
impl Paths {
    pub fn new_config_file() -> Result<PathBuf> {
        Ok(Self::config_dir()?.join("new-config.toml"))
    }
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä¸»æ¶æ„æ–‡æ¡£](../ARCHITECTURE.md)
- [é…ç½®ç®¡ç†å‘½ä»¤æ¨¡å—æ¶æ„æ–‡æ¡£](../commands/CONFIG_COMMAND_ARCHITECTURE.md) - å‘½ä»¤å±‚å¦‚ä½•ä½¿ç”¨ Settings æ¨¡å—
- [LLM æ¨¡å—æ¶æ„æ–‡æ¡£](./LLM_ARCHITECTURE.md) - LLM æ¨¡å—å¦‚ä½•ä½¿ç”¨ Settings
- [Jira æ¨¡å—æ¶æ„æ–‡æ¡£](./JIRA_ARCHITECTURE.md) - Jira æ¨¡å—å¦‚ä½•ä½¿ç”¨ Settings
- [Shell æ¨¡å—æ¶æ„æ–‡æ¡£](./SHELL_ARCHITECTURE.md) - Shell æ¨¡å—å¦‚ä½•ä½¿ç”¨ Paths

---

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨

```rust
use workflow::base::settings::Settings;

// è·å–å…¨å±€é…ç½®ï¼ˆæ¨èï¼‰
let settings = Settings::get();

// è·å– Jira é…ç½®
if let Some(email) = &settings.jira.email {
    println!("Jira email: {}", email);
}

// è·å– GitHub å½“å‰è´¦å·
if let Some(account) = settings.github.get_current_account() {
    println!("GitHub account: {}", account.name);
}

// è·å– LLM é…ç½®
println!("LLM provider: {}", settings.llm.provider);
```

### ä½¿ç”¨ Paths

```rust
use workflow::base::settings::Paths;

// è·å–é…ç½®æ–‡ä»¶è·¯å¾„
let config_path = Paths::workflow_config()?;

// è·å– completion ç›®å½•
let completion_dir = Paths::completion_dir()?;

// è·å– Shell é…ç½®æ–‡ä»¶è·¯å¾„
use clap_complete::shells::Shell;
let zshrc = Paths::config_file(&Shell::Zsh)?;
```

### é…ç½®éªŒè¯

```rust
use workflow::base::settings::Settings;

// åŠ è½½é…ç½®ï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰
let settings = Settings::load();

// éªŒè¯é…ç½®
settings.verify()?;
```

---

## âœ… æ€»ç»“

Settings æ¨¡å—é‡‡ç”¨æ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡ï¼š

1. **å•ä¾‹æ¨¡å¼**ï¼š`Settings::get()` å®ç°çº¿ç¨‹å®‰å…¨çš„å…¨å±€å•ä¾‹
2. **é»˜è®¤å€¼æ”¯æŒ**ï¼šä½¿ç”¨ `#[serde(default)]` å’Œ `Default` trait
3. **è·¯å¾„ç»Ÿä¸€ç®¡ç†**ï¼š`Paths` ç»Ÿä¸€ç®¡ç†æ‰€æœ‰è·¯å¾„
4. **é…ç½®éªŒè¯**ï¼šæä¾› Jira å’Œ GitHub é…ç½®éªŒè¯åŠŸèƒ½
5. **æ˜“äºæ‰©å±•**ï¼šæ·»åŠ æ–°é…ç½®é¡¹åªéœ€æ‰©å±•ç»“æ„ä½“

**è®¾è®¡ä¼˜åŠ¿**ï¼š
- âœ… **é«˜æ€§èƒ½**ï¼šå•ä¾‹æ¨¡å¼ï¼Œé…ç½®åªåŠ è½½ä¸€æ¬¡
- âœ… **å®¹é”™æ€§**ï¼šé…ç½®æ–‡ä»¶ä¸å­˜åœ¨æˆ–å­—æ®µç¼ºå¤±æ—¶ä½¿ç”¨é»˜è®¤å€¼
- âœ… **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨ Rust ç±»å‹ç³»ç»Ÿä¿è¯ç±»å‹å®‰å…¨
- âœ… **ç»Ÿä¸€ç®¡ç†**ï¼šæ‰€æœ‰è·¯å¾„é›†ä¸­ç®¡ç†ï¼Œé¿å…ç¡¬ç¼–ç 
- âœ… **æ˜“äºæ‰©å±•**ï¼šæ·»åŠ æ–°é…ç½®é¡¹åªéœ€æ‰©å±•ç»“æ„ä½“

é€šè¿‡å•ä¾‹æ¨¡å¼ã€é»˜è®¤å€¼æ”¯æŒå’Œè·¯å¾„ç»Ÿä¸€ç®¡ç†ï¼Œå®ç°äº†é«˜æ€§èƒ½ã€å®¹é”™æ€§å’Œæ˜“äºç»´æŠ¤çš„ç›®æ ‡ã€‚

