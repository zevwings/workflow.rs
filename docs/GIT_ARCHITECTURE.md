# Git æ¨¡å—æ¶æ„æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

Git æ¨¡å—æ˜¯ Workflow CLI çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œæä¾›å®Œæ•´çš„ Git ä»“åº“æ“ä½œåŠŸèƒ½ï¼ŒåŒ…æ‹¬æäº¤ç®¡ç†ã€åˆ†æ”¯ç®¡ç†ã€ä»“åº“æ£€æµ‹ã€æš‚å­˜ç®¡ç†ã€Pre-commit hooks æ”¯æŒå’Œé…ç½®ç®¡ç†ã€‚è¯¥æ¨¡å—é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ¯ä¸ªåŠŸèƒ½é¢†åŸŸæœ‰ç‹¬ç«‹çš„ç»“æ„ä½“ï¼Œé€šè¿‡ç»Ÿä¸€çš„è¾…åŠ©å‡½æ•°å‡å°‘ä»£ç é‡å¤ã€‚

**æ¨¡å—ç»Ÿè®¡ï¼š**
- æ€»ä»£ç è¡Œæ•°ï¼šçº¦ 1350 è¡Œ
- æ–‡ä»¶æ•°é‡ï¼š8 ä¸ª
- ä¸»è¦ç»“æ„ä½“ï¼š6 ä¸ªï¼ˆGitBranch, GitCommit, GitRepo, GitStash, GitConfig, GitPreCommitï¼‰
- è¾…åŠ©æ¨¡å—ï¼š1 ä¸ªï¼ˆhelpers.rsï¼‰

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

### æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚

```
src/lib/git/
â”œâ”€â”€ mod.rs          # Git æ¨¡å—å£°æ˜å’Œå¯¼å‡º (38è¡Œ)
â”œâ”€â”€ branch.rs       # åˆ†æ”¯ç®¡ç†æ“ä½œ (613è¡Œ)
â”œâ”€â”€ commit.rs       # æäº¤ç›¸å…³æ“ä½œ (172è¡Œ)
â”œâ”€â”€ repo.rs         # ä»“åº“æ£€æµ‹å’Œç±»å‹è¯†åˆ« (132è¡Œ)
â”œâ”€â”€ stash.rs        # æš‚å­˜ç®¡ç† (102è¡Œ)
â”œâ”€â”€ config.rs       # Git é…ç½®ç®¡ç† (67è¡Œ)
â”œâ”€â”€ pre_commit.rs   # Pre-commit hooks æ”¯æŒ (107è¡Œ)
â”œâ”€â”€ helpers.rs       # Git æ“ä½œè¾…åŠ©å‡½æ•° (115è¡Œ)
â””â”€â”€ types.rs        # ç±»å‹å®šä¹‰ (15è¡Œ)
```

### ä¾èµ–æ¨¡å—

- **`lib/pr/`**ï¼šPR åŠŸèƒ½ï¼ˆä½¿ç”¨ Git æ“ä½œè¿›è¡Œåˆ†æ”¯ç®¡ç†ï¼‰
- **`commands/pr/`**ï¼šPR å‘½ä»¤ï¼ˆä½¿ç”¨ Git æ“ä½œï¼‰
- **`commands/check.rs`**ï¼šç¯å¢ƒæ£€æŸ¥å‘½ä»¤ï¼ˆä½¿ç”¨ Git çŠ¶æ€æ£€æŸ¥ï¼‰
- **`commands/setup.rs`**ï¼šåˆå§‹åŒ–è®¾ç½®å‘½ä»¤ï¼ˆä½¿ç”¨ Git é…ç½®ï¼‰

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### è®¾è®¡åŸåˆ™

1. **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¯ä¸ªåŠŸèƒ½é¢†åŸŸæœ‰ç‹¬ç«‹çš„ç»“æ„ä½“ï¼ŒèŒè´£æ¸…æ™°
2. **é›¶å¤§å°ç»“æ„ä½“**ï¼šä½¿ç”¨ unit struct ç»„ç»‡ç›¸å…³å‡½æ•°ï¼Œç¬¦åˆ Rust æœ€ä½³å®è·µ
3. **ç»Ÿä¸€è¾…åŠ©å‡½æ•°**ï¼šé€šè¿‡ `helpers.rs` æä¾›ç»Ÿä¸€çš„ Git å‘½ä»¤æ‰§è¡Œæ¥å£
4. **é”™è¯¯å¤„ç†ç»Ÿä¸€**ï¼šä½¿ç”¨ `anyhow::Result` å’Œ `context` æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
5. **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨æšä¸¾ç±»å‹ï¼ˆ`RepoType`, `MergeStrategy`ï¼‰æé«˜ç±»å‹å®‰å…¨æ€§

### æ ¸å¿ƒç»„ä»¶

#### 1. åˆ†æ”¯ç®¡ç† (`branch.rs`)

**èŒè´£**ï¼šæä¾›åˆ†æ”¯ç›¸å…³çš„æ‰€æœ‰æ“ä½œ

**ä¸»è¦æ–¹æ³•**ï¼š
- `current_branch()` - è·å–å½“å‰åˆ†æ”¯å
- `is_branch_exists()` - æ£€æŸ¥åˆ†æ”¯æ˜¯å¦å­˜åœ¨ï¼ˆæœ¬åœ°æˆ–è¿œç¨‹ï¼‰
- `has_local_branch()` - æ£€æŸ¥æœ¬åœ°åˆ†æ”¯æ˜¯å¦å­˜åœ¨
- `has_remote_branch()` - æ£€æŸ¥è¿œç¨‹åˆ†æ”¯æ˜¯å¦å­˜åœ¨
- `checkout_branch()` - åˆ›å»ºæˆ–åˆ‡æ¢åˆ°åˆ†æ”¯
- `get_default_branch()` - è·å–é»˜è®¤åˆ†æ”¯
- `get_all_branches()` - è·å–æ‰€æœ‰åˆ†æ”¯ï¼ˆæœ¬åœ°å’Œè¿œç¨‹ï¼‰
- `extract_base_branch_names()` - æå–åˆ†æ”¯åŸºç¡€åç§°ï¼ˆå»æ‰å‰ç¼€ï¼‰
- `is_branch_ahead()` - æ£€æŸ¥åˆ†æ”¯æ˜¯å¦é¢†å…ˆäºæŒ‡å®šåˆ†æ”¯
- `pull()` - ä»è¿œç¨‹æ‹‰å–åˆ†æ”¯
- `push()` - æ¨é€åˆ°è¿œç¨‹ä»“åº“
- `delete()` - åˆ é™¤æœ¬åœ°åˆ†æ”¯
- `delete_remote()` - åˆ é™¤è¿œç¨‹åˆ†æ”¯
- `merge_branch()` - åˆå¹¶åˆ†æ”¯
- `has_merge_conflicts()` - æ£€æŸ¥æ˜¯å¦æœ‰åˆå¹¶å†²çª

**å…³é”®ç‰¹æ€§**ï¼š
- æ”¯æŒ `git switch` å’Œ `git checkout` çš„è‡ªåŠ¨å›é€€
- å¤šç§åˆå¹¶ç­–ç•¥ï¼ˆMerge, Squash, FastForwardOnlyï¼‰
- æ™ºèƒ½çš„é»˜è®¤åˆ†æ”¯æ£€æµ‹ï¼ˆæ”¯æŒå¤šç§æ–¹æ³•ï¼‰

#### 2. æäº¤ç®¡ç† (`commit.rs`)

**èŒè´£**ï¼šæä¾›æäº¤ç›¸å…³çš„æ“ä½œ

**ä¸»è¦æ–¹æ³•**ï¼š
- `status()` - æ£€æŸ¥ Git çŠ¶æ€
- `has_commit()` - æ£€æŸ¥æ˜¯å¦æœ‰æœªæäº¤çš„æ›´æ”¹
- `has_staged()` - æ£€æŸ¥æ˜¯å¦æœ‰æš‚å­˜çš„æ–‡ä»¶
- `add_all()` - æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒº
- `commit()` - æäº¤æ›´æ”¹ï¼ˆæ”¯æŒ pre-commit hooksï¼‰
- `get_diff()` - è·å– Git ä¿®æ”¹å†…å®¹ï¼ˆå·¥ä½œåŒºå’Œæš‚å­˜åŒºï¼‰

**å…³é”®ç‰¹æ€§**ï¼š
- è‡ªåŠ¨æš‚å­˜æ‰€æœ‰æ›´æ”¹
- é›†æˆ pre-commit hooks æ”¯æŒ
- æä¾› diff å†…å®¹ç”¨äº LLM ç”Ÿæˆ

#### 3. ä»“åº“æ£€æµ‹ (`repo.rs`)

**èŒè´£**ï¼šæä¾›ä»“åº“æ£€æµ‹å’Œç±»å‹è¯†åˆ«

**ä¸»è¦æ–¹æ³•**ï¼š
- `is_git_repo()` - æ£€æŸ¥æ˜¯å¦åœ¨ Git ä»“åº“ä¸­
- `detect_repo_type()` - æ£€æµ‹è¿œç¨‹ä»“åº“ç±»å‹ï¼ˆGitHubã€Codeup ç­‰ï¼‰
- `get_remote_url()` - è·å–è¿œç¨‹ä»“åº“ URL
- `get_git_dir()` - è·å– Git ç›®å½•è·¯å¾„
- `fetch()` - ä»è¿œç¨‹è·å–æ›´æ–°
- `prune_remote()` - æ¸…ç†è¿œç¨‹åˆ†æ”¯å¼•ç”¨

**å…³é”®ç‰¹æ€§**ï¼š
- æ”¯æŒ GitHub å’Œ Codeup ä»“åº“ç±»å‹è¯†åˆ«
- æ”¯æŒ SSH Host åˆ«åè¯†åˆ«

#### 4. æš‚å­˜ç®¡ç† (`stash.rs`)

**èŒè´£**ï¼šæä¾› stash ç›¸å…³æ“ä½œ

**ä¸»è¦æ–¹æ³•**ï¼š
- `stash_push()` - ä¿å­˜æœªæäº¤çš„ä¿®æ”¹åˆ° stash
- `stash_pop()` - æ¢å¤ stash ä¸­çš„ä¿®æ”¹
- `has_unmerged()` - æ£€æŸ¥æ˜¯å¦æœ‰æœªåˆå¹¶çš„æ–‡ä»¶ï¼ˆå†²çªï¼‰

**å…³é”®ç‰¹æ€§**ï¼š
- è‡ªåŠ¨æ£€æµ‹åˆå¹¶å†²çª
- æä¾›è¯¦ç»†çš„å†²çªè§£å†³æç¤º

#### 5. é…ç½®ç®¡ç† (`config.rs`)

**èŒè´£**ï¼šæä¾› Git é…ç½®ç®¡ç†

**ä¸»è¦æ–¹æ³•**ï¼š
- `set_global_user()` - è®¾ç½® Git å…¨å±€é…ç½®ï¼ˆemail å’Œ nameï¼‰
- `get_global_user()` - è¯»å– Git å…¨å±€é…ç½®

#### 6. Pre-commit Hooks (`pre_commit.rs`)

**èŒè´£**ï¼šæä¾› pre-commit hooks æ”¯æŒ

**ä¸»è¦æ–¹æ³•**ï¼š
- `has_pre_commit()` - æ£€æŸ¥æ˜¯å¦å­˜åœ¨ pre-commit hooks
- `run_pre_commit()` - æ‰§è¡Œ pre-commit hooks

**å…³é”®ç‰¹æ€§**ï¼š
- æ”¯æŒ Git hooks å’Œ pre-commit å·¥å…·
- è‡ªåŠ¨æ£€æµ‹å¤šç§ pre-commit é…ç½®æ–¹å¼

#### 7. è¾…åŠ©å‡½æ•° (`helpers.rs`)

**èŒè´£**ï¼šæä¾›é€šç”¨çš„ Git å‘½ä»¤æ‰§è¡Œè¾…åŠ©å‡½æ•°

**ä¸»è¦å‡½æ•°**ï¼š
- `cmd_read()` - æ‰§è¡Œ Git å‘½ä»¤å¹¶è¯»å–è¾“å‡º
- `cmd_run()` - æ‰§è¡Œ Git å‘½ä»¤ï¼ˆä¸è¯»å–è¾“å‡ºï¼‰
- `check_success()` - é™é»˜æ‰§è¡Œå¹¶æ£€æŸ¥æ˜¯å¦æˆåŠŸ
- `check_ref_exists()` - æ£€æŸ¥ Git å¼•ç”¨æ˜¯å¦å­˜åœ¨
- `switch_or_checkout()` - å°è¯• git switchï¼Œå¤±è´¥æ—¶å›é€€åˆ° git checkout
- `remove_branch_prefix()` - ç§»é™¤åˆ†æ”¯åç§°çš„å‰ç¼€

**å¸¸é‡**ï¼š
- `COMMON_DEFAULT_BRANCHES` - å¸¸è§é»˜è®¤åˆ†æ”¯åå¸¸é‡

**è®¾è®¡ä¼˜åŠ¿**ï¼š
- ç»Ÿä¸€é”™è¯¯å¤„ç†æ ¼å¼
- å‡å°‘ä»£ç é‡å¤ï¼ˆçº¦ 120-150 è¡Œï¼‰
- æé«˜ä»£ç å¯ç»´æŠ¤æ€§

#### 8. ç±»å‹å®šä¹‰ (`types.rs`)

**èŒè´£**ï¼šå®šä¹‰ Git ç›¸å…³ç±»å‹

**ç±»å‹**ï¼š
- `RepoType` - ä»“åº“ç±»å‹æšä¸¾ï¼ˆGitHub, Codeup, Unknownï¼‰

---

## ğŸ”„ è°ƒç”¨æµç¨‹

### æ•´ä½“æ¶æ„æµç¨‹

```
ç”¨æˆ·è¾“å…¥
  â†“
commands/*.rs (å‘½ä»¤å°è£…å±‚)
  â†“
lib/git/*.rs (æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚)
  â”œâ”€â”€ GitBranch::xxx()    # åˆ†æ”¯æ“ä½œ
  â”œâ”€â”€ GitCommit::xxx()     # æäº¤æ“ä½œ
  â”œâ”€â”€ GitRepo::xxx()       # ä»“åº“æ£€æµ‹
  â”œâ”€â”€ GitStash::xxx()      # æš‚å­˜æ“ä½œ
  â”œâ”€â”€ GitConfig::xxx()     # é…ç½®ç®¡ç†
  â””â”€â”€ GitPreCommit::xxx()  # Pre-commit hooks
  â†“
helpers.rs (è¾…åŠ©å‡½æ•°å±‚)
  â”œâ”€â”€ cmd_read()
  â”œâ”€â”€ cmd_run()
  â””â”€â”€ check_success()
  â†“
duct::cmd (å‘½ä»¤æ‰§è¡Œå±‚)
  â””â”€â”€ git å‘½ä»¤
```

### å…¸å‹è°ƒç”¨ç¤ºä¾‹

#### 1. åˆ›å»º PR æ—¶çš„ Git æ“ä½œ

```
commands/pr/create.rs
  â†“
GitBranch::checkout_branch(branch_name)
  â†“
helpers::switch_or_checkout()  # å°è¯• git switchï¼Œå¤±è´¥æ—¶å›é€€
  â†“
helpers::cmd_run()  # æ‰§è¡Œ git å‘½ä»¤
  â†“
GitCommit::commit(commit_title, true)
  â†“
GitPreCommit::run_pre_commit()  # å¦‚æœå­˜åœ¨ pre-commit hooks
  â†“
GitCommit::add_all()  # æš‚å­˜æ‰€æœ‰æ–‡ä»¶
  â†“
helpers::cmd_run()  # æ‰§è¡Œ git commit
  â†“
GitBranch::push(branch_name, true)
  â†“
helpers::cmd_run()  # æ‰§è¡Œ git push
```

#### 2. åˆå¹¶ PR æ—¶çš„ Git æ“ä½œ

```
commands/pr/merge.rs
  â†“
GitRepo::detect_repo_type()  # æ£€æµ‹ä»“åº“ç±»å‹
  â†“
GitBranch::current_branch()  # è·å–å½“å‰åˆ†æ”¯
  â†“
GitBranch::get_default_branch()  # è·å–é»˜è®¤åˆ†æ”¯
  â†“
GitBranch::merge_branch(source_branch, strategy)
  â†“
GitBranch::has_merge_conflicts()  # æ£€æŸ¥å†²çª
  â†“
GitBranch::checkout_branch(default_branch)  # åˆ‡æ¢åˆ°é»˜è®¤åˆ†æ”¯
  â†“
GitBranch::delete(branch_name, false)  # åˆ é™¤æœ¬åœ°åˆ†æ”¯
```

#### 3. ç¯å¢ƒæ£€æŸ¥æ—¶çš„ Git æ“ä½œ

```
commands/check.rs
  â†“
GitRepo::is_git_repo()  # æ£€æŸ¥æ˜¯å¦åœ¨ Git ä»“åº“ä¸­
  â†“
helpers::check_success()  # é™é»˜æ£€æŸ¥
  â†“
GitCommit::status()  # æ£€æŸ¥ Git çŠ¶æ€
  â†“
helpers::cmd_read()  # è¯»å– git status è¾“å‡º
```

---

## ğŸ“¦ æ¨¡å—èŒè´£

### GitBranch

**èŒè´£**ï¼šåˆ†æ”¯ç®¡ç†æ“ä½œ

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- åˆ†æ”¯æŸ¥è¯¢ï¼ˆå½“å‰åˆ†æ”¯ã€åˆ†æ”¯å­˜åœ¨æ€§ã€é»˜è®¤åˆ†æ”¯ï¼‰
- åˆ†æ”¯æ“ä½œï¼ˆåˆ›å»ºã€åˆ‡æ¢ã€åˆ é™¤ï¼‰
- åˆ†æ”¯åˆå¹¶ï¼ˆæ”¯æŒå¤šç§åˆå¹¶ç­–ç•¥ï¼‰
- åˆ†æ”¯æ¨é€å’Œæ‹‰å–
- å†²çªæ£€æµ‹

**ä½¿ç”¨åœºæ™¯**ï¼š
- PR åˆ›å»ºæ—¶åˆ›å»ºå’Œåˆ‡æ¢åˆ†æ”¯
- PR åˆå¹¶æ—¶åˆå¹¶åˆ†æ”¯å’Œæ¸…ç†
- åˆ†æ”¯åˆ—è¡¨æŸ¥è¯¢

### GitCommit

**èŒè´£**ï¼šæäº¤ç®¡ç†æ“ä½œ

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- çŠ¶æ€æ£€æŸ¥ï¼ˆå·¥ä½œåŒºã€æš‚å­˜åŒºï¼‰
- æ–‡ä»¶æš‚å­˜ï¼ˆaddï¼‰
- æäº¤æ“ä½œï¼ˆæ”¯æŒ pre-commit hooksï¼‰
- Diff è·å–ï¼ˆç”¨äº LLM ç”Ÿæˆï¼‰

**ä½¿ç”¨åœºæ™¯**ï¼š
- PR åˆ›å»ºæ—¶æäº¤æ›´æ”¹
- PR æ›´æ–°æ—¶æäº¤æ›´æ”¹
- ç¯å¢ƒæ£€æŸ¥æ—¶æ£€æŸ¥çŠ¶æ€

### GitRepo

**èŒè´£**ï¼šä»“åº“æ£€æµ‹å’Œç±»å‹è¯†åˆ«

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- Git ä»“åº“æ£€æµ‹
- è¿œç¨‹ä»“åº“ç±»å‹è¯†åˆ«ï¼ˆGitHubã€Codeupï¼‰
- è¿œç¨‹ URL è·å–
- è¿œç¨‹æ›´æ–°è·å–

**ä½¿ç”¨åœºæ™¯**ï¼š
- PR æ“ä½œå‰æ£€æµ‹ä»“åº“ç±»å‹
- ç¯å¢ƒæ£€æŸ¥æ—¶éªŒè¯ Git ä»“åº“
- è‡ªåŠ¨è¯†åˆ«å¹³å°ç±»å‹

### GitStash

**èŒè´£**ï¼šæš‚å­˜ç®¡ç†

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ä¿å­˜æœªæäº¤çš„ä¿®æ”¹
- æ¢å¤æš‚å­˜çš„ä¿®æ”¹
- å†²çªæ£€æµ‹

**ä½¿ç”¨åœºæ™¯**ï¼š
- PR é›†æˆåˆ†æ”¯æ—¶ä¿å­˜å·¥ä½œåŒºæ›´æ”¹
- åˆ‡æ¢åˆ†æ”¯å‰ä¿å­˜æ›´æ”¹

### GitConfig

**èŒè´£**ï¼šGit é…ç½®ç®¡ç†

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- è®¾ç½®å…¨å±€ç”¨æˆ·é…ç½®ï¼ˆemailã€nameï¼‰
- è¯»å–å…¨å±€ç”¨æˆ·é…ç½®

**ä½¿ç”¨åœºæ™¯**ï¼š
- åˆå§‹åŒ–è®¾ç½®æ—¶é…ç½® Git ç”¨æˆ·ä¿¡æ¯
- æ£€æŸ¥ Git é…ç½®

### GitPreCommit

**èŒè´£**ï¼šPre-commit hooks æ”¯æŒ

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- æ£€æµ‹ pre-commit hooks æ˜¯å¦å­˜åœ¨
- æ‰§è¡Œ pre-commit hooks

**ä½¿ç”¨åœºæ™¯**ï¼š
- æäº¤å‰è‡ªåŠ¨æ‰§è¡Œ hooks
- æ”¯æŒ Git hooks å’Œ pre-commit å·¥å…·

---

## ğŸ”— ä¸å…¶ä»–æ¨¡å—çš„é›†æˆ

### PR æ¨¡å—é›†æˆ

- **åˆ›å»º PR æ—¶**ï¼š
  - `GitBranch::checkout_branch()` - åˆ›å»ºæˆ–åˆ‡æ¢åˆ†æ”¯
  - `GitCommit::commit()` - æäº¤æ›´æ”¹
  - `GitBranch::push()` - æ¨é€åˆ°è¿œç¨‹
  - `GitRepo::detect_repo_type()` - æ£€æµ‹ä»“åº“ç±»å‹

- **åˆå¹¶ PR æ—¶**ï¼š
  - `GitBranch::merge_branch()` - åˆå¹¶åˆ†æ”¯
  - `GitBranch::checkout_branch()` - åˆ‡æ¢åˆ°é»˜è®¤åˆ†æ”¯
  - `GitBranch::delete()` - åˆ é™¤æœ¬åœ°åˆ†æ”¯

- **é›†æˆåˆ†æ”¯æ—¶**ï¼š
  - `GitStash::stash_push()` - ä¿å­˜å·¥ä½œåŒºæ›´æ”¹
  - `GitBranch::merge_branch()` - åˆå¹¶åˆ†æ”¯
  - `GitStash::stash_pop()` - æ¢å¤å·¥ä½œåŒºæ›´æ”¹

### ç¯å¢ƒæ£€æŸ¥æ¨¡å—é›†æˆ

- **`commands/check.rs`**ï¼š
  - `GitRepo::is_git_repo()` - æ£€æŸ¥æ˜¯å¦åœ¨ Git ä»“åº“ä¸­
  - `GitCommit::status()` - æ£€æŸ¥ Git çŠ¶æ€

### é…ç½®æ¨¡å—é›†æˆ

- **`commands/setup.rs`**ï¼š
  - `GitConfig::set_global_user()` - è®¾ç½® Git å…¨å±€é…ç½®

---

## ğŸ¯ è®¾è®¡æ¨¡å¼

### 1. æ¨¡å—åŒ–è®¾è®¡æ¨¡å¼

æ¯ä¸ªåŠŸèƒ½é¢†åŸŸæœ‰ç‹¬ç«‹çš„ç»“æ„ä½“ï¼Œä½¿ç”¨é›¶å¤§å°ç»“æ„ä½“ï¼ˆunit structï¼‰ç»„ç»‡ç›¸å…³å‡½æ•°ï¼š

```rust
pub struct GitBranch;  // é›¶å¤§å°ç»“æ„ä½“
impl GitBranch {
    pub fn current_branch() -> Result<String> { ... }
    // ...
}
```

**ä¼˜åŠ¿**ï¼š
- èŒè´£æ¸…æ™°ï¼Œç¬¦åˆå•ä¸€èŒè´£åŸåˆ™
- å‘½åç©ºé—´æ˜ç¡®ï¼ˆ`GitBranch::current_branch()`ï¼‰
- æ˜“äºç»´æŠ¤å’Œæ‰©å±•

### 2. è¾…åŠ©å‡½æ•°æ¨¡å¼

é€šè¿‡ `helpers.rs` æä¾›ç»Ÿä¸€çš„ Git å‘½ä»¤æ‰§è¡Œæ¥å£ï¼š

```rust
// ç»Ÿä¸€æ¥å£
cmd_read(&["branch", "--show-current"])
cmd_run(&["add", "--all"])
check_success(&["diff", "--quiet"])
```

**ä¼˜åŠ¿**ï¼š
- å‡å°‘ä»£ç é‡å¤ï¼ˆçº¦ 120-150 è¡Œï¼‰
- ç»Ÿä¸€é”™è¯¯å¤„ç†æ ¼å¼
- æé«˜ä»£ç å¯ç»´æŠ¤æ€§

### 3. ç­–ç•¥æ¨¡å¼

é€šè¿‡æšä¸¾ç±»å‹å®ç°ä¸åŒçš„ç­–ç•¥ï¼š

```rust
pub enum MergeStrategy {
    Merge,           // æ™®é€šåˆå¹¶
    Squash,          // Squash åˆå¹¶
    FastForwardOnly, // åªå…è®¸ fast-forward
}
```

### 4. å›é€€æ¨¡å¼

`switch_or_checkout()` å‡½æ•°å®ç°è‡ªåŠ¨å›é€€ï¼š

```rust
// ä¼˜å…ˆä½¿ç”¨ git switchï¼Œå¤±è´¥æ—¶å›é€€åˆ° git checkout
switch_or_checkout(
    &["switch", branch_name],
    &["checkout", branch_name],
    error_msg,
)?;
```

**ä¼˜åŠ¿**ï¼š
- æ”¯æŒæ–°æ—§ Git ç‰ˆæœ¬
- è‡ªåŠ¨é€‚é…ä¸åŒç¯å¢ƒ

---

## ğŸ” é”™è¯¯å¤„ç†

### åˆ†å±‚é”™è¯¯å¤„ç†

1. **è¾…åŠ©å‡½æ•°å±‚**ï¼šç»Ÿä¸€é”™è¯¯ä¸Šä¸‹æ–‡
   ```rust
   cmd_read(&["branch", "--show-current"])
       .context("Failed to get current branch")
   ```

2. **ä¸šåŠ¡é€»è¾‘å±‚**ï¼šæ·»åŠ ä¸šåŠ¡ä¸Šä¸‹æ–‡
   ```rust
   GitBranch::checkout_branch(branch_name)
       .with_context(|| format!("Failed to checkout branch: {}", branch_name))
   ```

3. **å‘½ä»¤å±‚**ï¼šç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

### å®¹é”™æœºåˆ¶

- **Git å‘½ä»¤å¤±è´¥**ï¼šæä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®
- **åˆå¹¶å†²çª**ï¼šæ£€æµ‹å†²çªå¹¶æä¾›è¯¦ç»†çš„è§£å†³æ­¥éª¤
- **Pre-commit hooks å¤±è´¥**ï¼šæä¾›æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯
- **ä»“åº“ç±»å‹æœªçŸ¥**ï¼šè¿”å› `RepoType::Unknown`ï¼Œä¸ä¸­æ–­æµç¨‹

---

## ğŸ“Š æ•°æ®æµ

### åˆ†æ”¯æ“ä½œæ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥ï¼ˆåˆ†æ”¯åï¼‰
  â†“
GitBranch::checkout_branch()
  â†“
æ£€æŸ¥åˆ†æ”¯å­˜åœ¨æ€§ï¼ˆæœ¬åœ°/è¿œç¨‹ï¼‰
  â†“
switch_or_checkout()  # å°è¯• git switchï¼Œå¤±è´¥æ—¶å›é€€
  â†“
helpers::cmd_run()  # æ‰§è¡Œ git å‘½ä»¤
  â†“
è¿”å›ç»“æœ
```

### æäº¤æ“ä½œæ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥ï¼ˆæäº¤æ¶ˆæ¯ï¼‰
  â†“
GitCommit::commit()
  â†“
æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
  â†“
GitCommit::add_all()  # æš‚å­˜æ‰€æœ‰æ–‡ä»¶
  â†“
GitPreCommit::run_pre_commit()  # å¦‚æœå­˜åœ¨ hooks
  â†“
helpers::cmd_run()  # æ‰§è¡Œ git commit
  â†“
è¿”å›ç»“æœ
```

---

## ğŸ“ æ‰©å±•æ€§

### æ·»åŠ æ–°çš„ Git æ“ä½œ

1. åœ¨å¯¹åº”çš„æ¨¡å—æ–‡ä»¶ä¸­æ·»åŠ æ–¹æ³•
2. ä½¿ç”¨ `helpers.rs` ä¸­çš„è¾…åŠ©å‡½æ•°
3. æ·»åŠ æ–‡æ¡£æ³¨é‡Š
4. åœ¨ `mod.rs` ä¸­å¯¼å‡ºï¼ˆå¦‚éœ€è¦ï¼‰

### æ·»åŠ æ–°çš„ä»“åº“ç±»å‹

1. åœ¨ `types.rs` ä¸­æ·»åŠ æ–°çš„ `RepoType` å˜ä½“
2. åœ¨ `repo.rs` çš„ `parse_repo_type_from_url()` ä¸­æ·»åŠ è¯†åˆ«é€»è¾‘

### æ·»åŠ æ–°çš„åˆå¹¶ç­–ç•¥

1. åœ¨ `branch.rs` ä¸­æ·»åŠ æ–°çš„ `MergeStrategy` å˜ä½“
2. åœ¨ `merge_branch()` æ–¹æ³•ä¸­æ·»åŠ å¯¹åº”çš„å¤„ç†é€»è¾‘

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä¸»æ¶æ„æ–‡æ¡£](./ARCHITECTURE.md)
- [PR æ¨¡å—æ¶æ„æ–‡æ¡£](./PR_ARCHITECTURE.md) - PR æ¨¡å—å¦‚ä½•ä½¿ç”¨ Git æ“ä½œ
- [ç¯å¢ƒæ£€æŸ¥æ¨¡å—æ¶æ„æ–‡æ¡£](./CHECK_ARCHITECTURE.md) - ç¯å¢ƒæ£€æŸ¥å¦‚ä½•ä½¿ç”¨ Git çŠ¶æ€

---

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨

```rust
use workflow::git::{GitBranch, GitCommit, GitRepo, GitStash};

// è·å–å½“å‰åˆ†æ”¯
let branch = GitBranch::current_branch()?;

// æ£€æŸ¥åˆ†æ”¯æ˜¯å¦å­˜åœ¨
let (local, remote) = GitBranch::is_branch_exists("feature/new")?;

// åˆ›å»ºæˆ–åˆ‡æ¢åˆ†æ”¯
GitBranch::checkout_branch("feature/new")?;

// æäº¤æ›´æ”¹
GitCommit::commit("Fix bug", false)?;

// æ¨é€åˆ°è¿œç¨‹
GitBranch::push("feature/new", true)?;

// æ£€æµ‹ä»“åº“ç±»å‹
let repo_type = GitRepo::detect_repo_type()?;

// ä¿å­˜å·¥ä½œåŒºæ›´æ”¹
GitStash::stash_push(Some("WIP: working on feature"))?;
```

### åˆå¹¶åˆ†æ”¯

```rust
use workflow::git::{GitBranch, MergeStrategy};

// æ™®é€šåˆå¹¶
GitBranch::merge_branch("feature/new", MergeStrategy::Merge)?;

// Squash åˆå¹¶
GitBranch::merge_branch("feature/new", MergeStrategy::Squash)?;

// åªå…è®¸ fast-forward
GitBranch::merge_branch("feature/new", MergeStrategy::FastForwardOnly)?;
```

### æ£€æŸ¥å†²çª

```rust
use workflow::git::GitBranch;

// æ£€æŸ¥æ˜¯å¦æœ‰åˆå¹¶å†²çª
if GitBranch::has_merge_conflicts()? {
    // å¤„ç†å†²çª
}
```

---

## âœ… æ€»ç»“

Git æ¨¡å—é‡‡ç”¨æ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡ï¼š

1. **æ¨¡å—åŒ–ç»“æ„**ï¼šæ¯ä¸ªåŠŸèƒ½é¢†åŸŸæœ‰ç‹¬ç«‹çš„ç»“æ„ä½“ï¼ŒèŒè´£æ¸…æ™°
2. **ç»Ÿä¸€è¾…åŠ©å‡½æ•°**ï¼šé€šè¿‡ `helpers.rs` æä¾›ç»Ÿä¸€çš„å‘½ä»¤æ‰§è¡Œæ¥å£
3. **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨æšä¸¾ç±»å‹æé«˜ç±»å‹å®‰å…¨æ€§
4. **é”™è¯¯å¤„ç†ç»Ÿä¸€**ï¼šä½¿ç”¨ `anyhow::Result` å’Œ `context` æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
5. **æ˜“äºæ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ä¾¿äºæ·»åŠ æ–°åŠŸèƒ½

é€šè¿‡æ¨¡å—åŒ–è®¾è®¡å’Œç»Ÿä¸€è¾…åŠ©å‡½æ•°ï¼Œå®ç°äº†ä»£ç å¤ç”¨ã€æ˜“äºç»´æŠ¤å’Œæ‰©å±•çš„ç›®æ ‡ã€‚

